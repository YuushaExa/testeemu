var EJS=function(i){window.EJS_MODULES=i;var n={},o=[];function a(e){if(n[e])return n[e].exports;o.push(e);var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}return window.getUsedModules=function(){return o.sort(function(e,t){return t<e?1:-1})},window.getUnusedModules=function(){for(var e=[],t=getUsedModules(),n=0;n<i.length;n++)null===i[n]||t.includes(n)||e.push(n);return e},Array.isArray,a.m=i,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=161)}([function(e){e.exports=function(e,t,n){console.warn(e),e&&e.response&&0===e.response.status?t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;"><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors">'+n.localization("CORS Error")+"</a></strong>":t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+n.localization("Network Error")+"</strong>"}},null,null,null,null,null,function(e){function t(){if(!(navigator.getGamepads||navigator.webkitGetGamepads))throw new Error("get gamepads not found!");if(this.rAF=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.requestAnimationFrame,!this.rAF)throw new Error("request animation frame was not found!");this.loop()}t.prototype={gamepads:[],rAF:null,getGamepads:function(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]},loop:async function(){this.updateGamepadState(),this.rAF.call(null,this.loop.bind(this))},updateGamepadState:function(){for(var n=this.getGamepads(),i=0;i<n.length;i++)if(n[i]){for(var e=!1,o=0;o<this.gamepads.length;o++)if(this.gamepads[o]&&this.gamepads[o].index===n[i].index){if(e=!0,"function"==typeof this.onaxischanged)for(var t,a=0;a<this.gamepads[o].axes.length;a++)n[i].axes[a]===this.gamepads[o].axes[a]||(t=function(){switch(a){case 0:return"LEFT_STICK_X";case 1:return"LEFT_STICK_Y";case 2:return"RIGHT_STICK_X";case 3:return"RIGHT_STICK_Y";default:return""}}())&&this.onaxischanged({axis:t,value:n[i].axes[a],index:i,gamepadIndex:n[i].index});for(a=0;a<this.gamepads[o].buttons.length;a++){let e=1==this.gamepads[o].buttons[a],t=("object"==typeof this.gamepads[o].buttons[a]&&(e=this.gamepads[o].buttons[a].pressed),1==n[i].buttons[a]);"object"==typeof n[i].buttons[a]&&(t=n[i].buttons[a].pressed),e!==t&&(t?"function"==typeof this.onbuttondown&&this.onbuttondown({index:a,gamepadIndex:n[i].index}):"function"==typeof this.onbuttonup&&this.onbuttonup({index:a,gamepadIndex:n[i].index}))}this.gamepads[o]=n[i]}e||(this.gamepads.push(n[i]),"function"==typeof this.onconnected&&this.onconnected())}for(o=0;o<this.gamepads.length;o++)if(this.gamepads[o]){for(var s=!1,i=0;i<n.length;i++)n[i]&&this.gamepads[o].index===n[i].index&&(s=!0);s||(this.gamepads.splice(o,1),o--,"function"==typeof this.ondisconnected&&this.ondisconnected())}},on:function(e,t){this["on"+e.toLowerCase()]=t}},e.exports=t},null,null,null,null,function(e,t,n){function i(i,o){try{i=new URL(i)}catch(e){}return i&&!["http:","https:"].includes(i.protocol)?new Promise(async function(e,t){if("HEAD"===o.method)e({headers:{}});else{try{var n=await fetch(i);if(o.type&&"arraybuffer"===o.type.toLowerCase())n=await n.arrayBuffer();else{n=await n.text();try{n=JSON.parse(n)}catch(e){}}}catch(e){t(e)}e({data:n,headers:{}})}}):new Promise(function(t,e){var n=new XMLHttpRequest;n.onload=function(){if(n.readyState===n.DONE){var e=n.response;try{e=JSON.parse(e)}catch(e){}t({data:e,headers:{"content-length":n.getResponseHeader("content-length"),"content-type":n.getResponseHeader("content-type"),"last-modified":n.getResponseHeader("last-modified")}})}},n.responseType=o.type,n.onerror=e,n.open(o.method,i,!0),n.send()})}e.exports={a:{get:async function(e,t){t=t&&t.responseType?t&&t.responseType:"text";return i(e,{method:"GET",type:t})},head:async function(e,t){t=t&&t.responseType?t&&t.responseType:"text";return i(e,{method:"HEAD",type:t})}}}},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t,n){var i;!function(){"use strict";void 0!==(i="function"==typeof(i=function(){function u(e){throw e}function f(){}function e(e,t){for(var n in void 0===t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={}),o)this[n]=(void 0!==e[n]?e:o)[n];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var i="object"==typeof window?window:self,t=this.implementationPreference.filter(function(e){return e in i});this.implementation=t[0],this.idb=i[this.implementation],this.keyRange=i.IDBKeyRange||i.webkitIDBKeyRange||i.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()}var o={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:u,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},t={constructor:e,version:"1.7.2",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),o=!1;e.onerror=function(e){var t;("error"in(t=e).target?"VersionError"==t.target.error.name:"errorCode"in t.target&&12==t.target.errorCode)?this.onError(new Error("The version number provided is lower than the existing one.")):(e=e.target.error||(t="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion,"errorCode"in e.target&&(t+=" with error code "+e.target.errorCode),new Error(t)),this.onError(e))}.bind(this),e.onsuccess=function(e){var i;o||(this.db?this.onStoreReady():(this.db=e.target.result,"string"!=typeof this.db.version?this.db.objectStoreNames.contains(this.storeName)?(e=this.db.transaction([this.storeName],this.consts.READ_ONLY),this.store=e.objectStore(this.storeName),i=Array.prototype.slice.call(this.getIndexList()),this.indexes.forEach(function(e){var t,n=e.name;if(!n)return o=!0,void this.onError(new Error("Cannot create index: No index name given."));this.normalizeIndexData(e),this.hasIndex(n)?(t=this.store.index(n),this.indexComplies(t,e)||(o=!0,this.onError(new Error('Cannot modify index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),i.splice(i.indexOf(n),1)):(o=!0,this.onError(new Error('Cannot create new index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))},this),i.length&&(o=!0,this.onError(new Error('Cannot delete index(es) "'+i.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),o||this.onStoreReady()):this.onError(new Error("Object store couldn't be created.")):this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."))))}.bind(this),e.onupgradeneeded=function(e){this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName)?this.store=e.target.transaction.objectStore(this.storeName):(e={autoIncrement:this.autoIncrement},null!==this.keyPath&&(e.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,e));var i=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var t,n=e.name;n||(o=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(n)?(t=this.store.index(n),this.indexComplies(t,e)||(this.store.deleteIndex(n),this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),i.splice(i.indexOf(n),1)):this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this),i.length&&i.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(e,t){var n;this.idb.deleteDatabase?(this.db.close(),(n=this.idb.deleteDatabase(this.dbName)).onsuccess=e,n.onerror=t):t(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(e,t,n,i){null!==this.keyPath&&(i=n,n=t,t=e),i=i||u,n=n||f;var o=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);return s.oncomplete=function(){(o?n:i)(a)},s.onabort=i,s.onerror=i,(t=null!==this.keyPath?(this._addIdPropertyIfNeeded(t),s.objectStore(this.storeName).put(t)):s.objectStore(this.storeName).put(t,e)).onsuccess=function(e){o=!0,a=e.target.result},t.onerror=i,s},get:function(e,t,n){n=n||u,t=t||f;var i=!1,o=null,a=this.db.transaction([this.storeName],this.consts.READ_ONLY),e=(a.oncomplete=function(){(i?t:n)(o)},a.onabort=n,a.onerror=n,a.objectStore(this.storeName).get(e));return e.onsuccess=function(e){i=!0,o=e.target.result},e.onerror=n,a},remove:function(e,t,n){n=n||u,t=t||f;var i=!1,o=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE),e=(a.oncomplete=function(){(i?t:n)(o)},a.onabort=n,a.onerror=n,a.objectStore(this.storeName).delete(e));return e.onsuccess=function(e){i=!0,o=e.target.result},e.onerror=n,a},batch:function(e,t,a){if(a=a||u,t=t||f,"[object Array]"!=Object.prototype.toString.call(e))a(new Error("dataArray argument must be of type Array."));else if(0===e.length)return t(!0);function s(){0!=--n||l||(i=l=!0)}var n=e.length,l=!1,i=!1,r=this.db.transaction([this.storeName],this.consts.READ_WRITE);r.oncomplete=function(){(i?t:a)(i)},r.onabort=a,r.onerror=a;return e.forEach(function(e){function t(e){r.abort(),l||(l=!0,a(e,i,o))}var n,i=e.type,o=e.key,e=e.value;"remove"==i?((n=r.objectStore(this.storeName).delete(o)).onsuccess=s,n.onerror=t):"put"==i&&((n=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),r.objectStore(this.storeName).put(e)):r.objectStore(this.storeName).put(e,o)).onsuccess=s,n.onerror=t)},this),r},putBatch:function(e,t,n){e=e.map(function(e){return{type:"put",value:e}});return this.batch(e,t,n)},upsertBatch:function(t,e,n,i){"function"==typeof e&&(i=n=e,e={}),i=i||u,n=n||f,e=e||{},"[object Array]"!=Object.prototype.toString.call(t)&&i(new Error("dataArray argument must be of type Array."));function o(e){t[c++][a]=e.target.result,0!=--s||l||(r=l=!0)}var a=e.keyField||this.keyPath,s=t.length,l=!1,r=!1,c=0,d=this.db.transaction([this.storeName],this.consts.READ_WRITE);d.oncomplete=function(){r?n(t):i(!1)},d.onabort=i,d.onerror=i;return t.forEach(function(e){var t=e.key,e=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),d.objectStore(this.storeName).put(e)):d.objectStore(this.storeName).put(e,t);e.onsuccess=o,e.onerror=function(e){d.abort(),l||(l=!0,i(e))}},this),d},removeBatch:function(e,t,n){e=e.map(function(e){return{type:"remove",key:e}});return this.batch(e,t,n)},getBatch:function(e,t,n,i){if(n=n||u,t=t||f,i=i||"sparse","[object Array]"!=Object.prototype.toString.call(e))n(new Error("keyArray argument must be of type Array."));else if(0===e.length)return t([]);function o(e){e.target.result||"dense"==i?a.push(e.target.result):"sparse"==i&&a.length++,0==--s&&(l=!0,r=a)}var a=[],s=e.length,l=!1,r=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){(l?t:n)(r)},c.onabort=n,c.onerror=n;return e.forEach(function(e){e=c.objectStore(this.storeName).get(e);e.onsuccess=o,e.onerror=function(e){n(r=e),c.abort()}},this),c},getAll:function(e,t){t=t||u,e=e||f;var n=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=n.objectStore(this.storeName);return i.getAll?this._getAllNative(n,i,e,t):this._getAllCursor(n,i,e,t),n},_getAllNative:function(e,t,n,i){var o=!1,a=null,e=(e.oncomplete=function(){(o?n:i)(a)},e.onabort=i,e.onerror=i,t.getAll());e.onsuccess=function(e){o=!0,a=e.target.result},e.onerror=i},_getAllCursor:function(e,t,n,i){var o=[],a=!1,s=null,e=(e.oncomplete=function(){(a?n:i)(s)},e.onabort=i,e.onerror=i,t.openCursor());e.onsuccess=function(e){e=e.target.result;e?(o.push(e.value),e.continue()):(a=!0,s=o)},e.onError=i},clear:function(e,t){t=t||u,e=e||f;var n=!1,i=null,o=this.db.transaction([this.storeName],this.consts.READ_WRITE),a=(o.oncomplete=function(){(n?e:t)(i)},o.onabort=t,o.onerror=t,o.objectStore(this.storeName).clear());return a.onsuccess=function(e){n=!0,i=e.target.result},a.onerror=t,o},_addIdPropertyIfNeeded:function(e){void 0===e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount+++Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(a,s){return["keyPath","unique","multiEntry"].every(function(e){if("multiEntry"==e&&void 0===a[e]&&!1===s[e])return!0;if("keyPath"!=e||"[object Array]"!=Object.prototype.toString.call(s[e]))return s[e]==a[e];var t=s.keyPath,n=a.keyPath;if("string"==typeof n)return t.toString()==n;if("function"!=typeof n.contains&&"function"!=typeof n.indexOf)return!1;if(n.length!==t.length)return!1;for(var i=0,o=t.length;i<o;i++)if(!(n.contains&&n.contains(t[i])||n.indexOf(-1!==t[i])))return!1;return!0})},iterate:function(n,i){var e="desc"==(i=l({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:u,limit:1/0,offset:0,allowItemRejection:!1},i||{})).order.toLowerCase()?"PREV":"NEXT",o=(i.filterDuplicates&&(e+="_NO_DUPLICATE"),!1),a=this.db.transaction([this.storeName],this.consts[i.writeAccess?"READ_WRITE":"READ_ONLY"]),t=a.objectStore(this.storeName),s=(i.index&&(t=t.index(i.index)),0),t=(a.oncomplete=function(){o?i.onEnd?i.onEnd():n(null):i.onError(null)},a.onabort=i.onError,a.onerror=i.onError,t.openCursor(i.keyRange,this.consts[e]));return t.onerror=i.onError,t.onsuccess=function(e){var t,e=e.target.result;e?i.offset?(e.advance(i.offset),i.offset=0):(t=n(e.value,e,a),i.allowItemRejection&&!1===t||s++,i.autoContinue&&(s+i.offset<i.limit?e.continue():o=!0)):o=!0},a},query:function(e,n){var i=[],o=0;return(n=n||{}).autoContinue=!0,n.writeAccess=!1,n.allowItemRejection=!!n.filter,n.onEnd=function(){e(i,o)},this.iterate(function(e){o++;var t=!n.filter||n.filter(e);return!1!==t&&i.push(e),t},n)},count:function(e,t){var n=(t=l({index:null,keyRange:null},t||{})).onError||u,i=!1,o=null,a=this.db.transaction([this.storeName],this.consts.READ_ONLY),s=(a.oncomplete=function(){(i?e:n)(o)},a.onabort=n,a.onerror=n,a.objectStore(this.storeName)),s=(s=t.index?s.index(t.index):s).count(t.keyRange);return s.onsuccess=function(e){i=!0,o=e.target.result},s.onError=n,a},makeKeyRange:function(e){var t,n=void 0!==e.lower,i=void 0!==e.upper;switch(!0){case void 0!==e.only:t=this.keyRange.only(e.only);break;case n&&i:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case n:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case i:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}},a={};function l(e,t){var n,i;for(n in t)(i=t[n])!==a[n]&&i!==e[n]&&(e[n]=i);return e}return e.prototype=t,e.version=t.version,e})?i.call(t,n,t,e):i)&&(e.exports=i)}()},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t,n){var i;!function(){"use strict";var a={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var i=typeof n;if("string"==i||"number"==i)e.push(this&&this[n]||n);else if(Array.isArray(n))e.push(s.apply(this,n));else if("object"==i)for(var o in n)a.call(n,o)&&n[o]&&e.push(this&&this[o]||o)}}return e.join(" ")}e.exports?e.exports=s.default=s:void 0!==(i=function(){return s}.apply(t,[]))&&(e.exports=i)}()},function(e,t,n){e.exports={"ejs-wrapper":"ejs--de6433374cb30211f10e148b320b2f",ejs:"ejs--7a5f920ceffb2913f6dbda780573cf","ejs--full-ui":"ejs--f3a002bba9836fe4ebfed357a45521","controls-tabs":"ejs--008adea3c1ef33a8fc94892a1e97e6",overlay:"ejs--85a95eb6bf74a40ab61b91a91e5bff","key-setting-popup":"ejs--d169a219343bc32dd4aecc3f6b7f25","loading-info":"ejs--782e3572812f983b3a150eec177391",p1:"ejs--c426dd1d179aa351e6cec47e1d9438",p2:"ejs--31e7e81db48819ee35ec6f50378a2e",p3:"ejs--20d4eb2646d396f558a645dc0574f1",p4:"ejs--4de05306c8b099bdeb4585571ac095",ejs__contextmenu:"ejs--c7957d8666bb6b8fc7c3e9c021aaf8",ad:"ejs--cbcfe0a1421cadac9a04c81d6431d6","close-ad":"ejs--f3a1903d935f6cf720d4a0498db62a","start-game":"ejs--73f9b4e94a7a1fe74e11107d5ab2ef",pulse:"ejs--9bd947b3e6427453595f083d740a7c",ejs__control:"ejs--8732295ca5c4902a060d34706a8146","ejs__tab-focus":"ejs--a83b6c705e103e81a7762d0ed5e64b","ejs__control--pressed":"ejs--b1238136ec472a92297159882cf4b8","icon--pressed":"ejs--ec731619062226d943da67f5d83009","icon--not-pressed":"ejs--dc7068585e3d84fe0e676864c1439e","label--pressed":"ejs--0c6561f9155750b0aeeed6da5da7bf","label--not-pressed":"ejs--13d64e30c1333cc99391af48ddabaa","ejs--video":"ejs--d5f430a99a1619b3434bf58e34a99c",ejs__controls:"ejs--1acedc5ed6816abe96dd27d910fd74",ejs__progress:"ejs--f1aa376719b564cae0e653157cde14",ejs__time:"ejs--90d2780f99bcc76fdb6b0378a7238e",ejs__menu:"ejs--c7bfb2d1b75a40fdaaf90624bea9e7",ejs__volume:"ejs--36ceeeec0df37a9cf4bbe05fa204ec","ejs--hide-controls":"ejs--1b8cb7f2294b1eb5de5238daea3513","ejs--fullscreen-enabled":"ejs--19409fe2057ab935a7e46abb5b4f49",ejs__tooltip:"ejs--74c6d4176d27e37a19d2e9e61de8f4",ejs__menu__container:"ejs--013213afedeeb6878089b1ca1b4e47","ejs-popup":"ejs--c2532bfe04554193cc42b3be753700","ejs__control--forward":"ejs--0b4cdb4057d1a4623e60836ccc6275","ejs__control--back":"ejs--a7ad9de0cb0ca672b6703c50de7db9",ejs__menu__value:"ejs--f91e90fe7cabc875aff9a431bf5389","ejs__tooltip--visible":"ejs--6ea27aa07e60d1d6e4c9782740028a","ejs--menu-open":"ejs--da54136ccf8c6b0b16d98e8b8e8b88","ejs__video-wrapper":"ejs--057800d021995e1347ec07cb748672",portrait:"ejs--64f1256f556fb94454b930cb3ea7f2","game-started":"ejs--7da7949f602347007818e6d192eb23",ejs__progress__buffer:"ejs--f8d706413436fd119cf01aaf5a9d9d","ejs--audio":"ejs--bd0222e58d71b0a304d6037dfcffd5","ejs--loading":"ejs--2521e1257996f264de36e77cc9c5ee",ejs__dialogs:"ejs--d31688f864f56d6426ebbf2217d6ee",ejs__dialog:"ejs--5e71fd80268afbb1d588e40b993508",ejs__cache__container:"ejs--1e0f0672f67d0e96592314c9ed78b0",ejs__loading__container:"ejs--d7e6a6a8f38bfaa256fe5d709a8258","ejs__load-state__container":"ejs--b183f581b5336c4908ad258d3e1cc7",ejs__screenRecord__container:"ejs--b183f581b5336cashrqd258d3e1cc7",ejs__netplay__container:"ejs--158ea9dd34e3e7af2d837f8b05babb",ejs__gamepad__container:"ejs--3f0897a8158ba363a0ee0afe4da7c5","dialog-container":"ejs--38cc09882a55e98c76168dbe838aa0","dialog-title":"ejs--b373c9d5029d49324fb8ac3ece96c1","dialog-content":"ejs--a5e2629abb9a5bcbc8b2c1307922d2","dialog-buttons":"ejs--580e3c22e63f8a1eb29694fd0b141b","btn-cancel":"ejs--ad20569e1449d7b8e99e6465960456","btn-reset":"ejs--ad20569e1449d7b8e99e6465963825","btn-clear":"ejs--ad20569e1449d7b8e99e6468571053",tabs:"ejs--8e7922427f460a31935084b7acfb1a",active:"ejs--68d337c212ec6a5bc43125440d422b","tabs-content":"ejs--31eb28817642bb1bfe0a2c422108bb","tabs-panel":"ejs--f932566a0af5314da834324c901978","button-container":"ejs--c233fb69cbef43078bc39e9d1efac8","btn-submit":"ejs--bdb54e9fc47f9805b506b746e897bf","btn-create-room":"ejs--67d03ee7480b871ad6507d6319a839","btn-quit":"ejs--c2d931157456c1d438d40a2f66af2c",set:"ejs--6604c83041a275a78837c452a71dd8","btn-join-room":"ejs--99150e15f962c63c689cadc81ef40d","netplay-player-name":"ejs--71527b6509aa48afce3ce1a11c02f0","netplay-player-name-input":"ejs--7ad35768e3f6b9faf97db01d5b60ae","netplay-player-name-set":"ejs--9c403e5e107a3e4374ba244b636400","netplay-roomlist":"ejs--d6a46533fa6e510a571af5c28b440a","netplay-create-room":"ejs--57ca9b3853cc7de731483cfcc95a59","netplay-room-name-input":"ejs--0885d5e25e19127b6b516014426a1b","netplay-room-password-input":"ejs--25023d28756fdb9dfbbfb6dccb8677","netplay-create-room-set":"ejs--75b3a8d35aacc6424ed7422fdeaaaa","netplay-room":"ejs--eefdf28d69ed2d20f197308981bb61","cheats-add":"ejs--9e670880bb57e824400fa00f09aaad","cheats-list":"ejs--2b4e3c245b7b25dfdac5e09155a68e","cheat-code-input":"ejs--572b0b3a0345a6b01b01a15a02842c","cheat-name-input":"ejs--a7d7f80c8999469c991ea452a85dd9",ejs__widgets:"ejs--952c974392296e7f643d51db380157",ejs__widget:"ejs--0d7e216cf12ae73705b5d5bb0452fc",ejs__widget_controls_toggle:"ejs--666d4296310579687cf3cf3d2cf951",ejs__widget_netplay:"ejs--c0a5e71f6613caab66d6ae15a5a00f","virtual-gamepad":"ejs--2440e3b831017ff8327c939e2a4413",top:"ejs--b8d8b771d0bbb94e2bbd03054f53fd",left:"ejs--c83d70cb63c933edc073c7fe92e32b",buttons:"ejs--6e7015634623fd6a82e6a7d3488c84",center:"ejs--49fa47c86a131e4ca8fb268bfdde89",right:"ejs--7d2b19f77fd0ccabf94dc1ca39ae18",touch:"ejs--d708d9d486f1eca73a593d5c09f8ad",modal:"ejs--eefec939452eb92fad035932d0f47c",modal__overlay:"ejs--f1f43b27384834c8c22c6f81d0c5ae",modal__container:"ejs--c4ee33766a01ed0356c3ec07898e96",modal__header:"ejs--a073f32023da1ced805c5f95a4e81c",modal__footer:"ejs--ed44f59bb8cd49177586b140658c6c",modal__title:"ejs--81470ba5e6a6d68014839ad4d9a977",modal__close:"ejs--c3c85789c2a7f56d8b26dba75b7e1f",modal__content:"ejs--db44f5520e6f4fd0dd34b478bb9ee8",modal__btn:"ejs--319bcec5dee9444e1a2a53d6503b7c","modal__btn-primary":"ejs--eaf3c1cba25d415d92ac48d7db34dd",modal__errmsg:"ejs--940087708c06b6129ce2bfa45f1d89","micromodal-slide":"ejs--bef295f3125e9ba83d4f3677264bae","is-open":"ejs--60c17e0d149099f207b06f27edae6a",mmfadeIn:"ejs--9d7aa2bd5ee276be085e5b2a0bbc2e",mmslideIn:"ejs--8b069266f76099cc6bc220f6ea56cc",mmfadeOut:"ejs--184b7558ffeb569c1790654537477b",mmslideOut:"ejs--379a464ad0e66ea5fc601e5f2fd73e","ejs-switch":"ejs--4c3e63d4005bd8a0468e9c74a35f62","ejs-delete-cheat":"ejs--90bcdd71cd0d2307e9ee0dffa916da","icon--exit-fullscreen":"ejs--2b3dd6e2e26c0f0dc4ac5779dedd5e","ejs--fullscreen-fallback":"ejs--412041671de21945d3e028b6ae84c9","ejs--no-transition":"ejs--33643265135cf89e6c0a0d9866d6f1","ejs__sr-only":"ejs--6f0e996cd15e5fb6be0256918531d7","ejs-fade-in":"ejs--7cadf43f3d9eb17c7e3c36de84973b"}},function(e,t,n){var i;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i=function(){function e(){}function r(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=r.id,r.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function i(e,t){var n=this;return n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=e,n.id=i.id,i.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1},n.config(t),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}function t(e){var t,i=this;return i.ids={},i.index=0,i.collections=[],i.config(e),i.prepareCollections(),u.bindEvt(window,"resize",function(e){clearTimeout(t),t=setTimeout(function(){var t,n=u.getScroll();i.collections.forEach(function(e){e.forEach(function(e){t=e.el.getBoundingClientRect(),e.position={x:n.x+t.left,y:n.y+t.top}})})},100)}),i.collections}var o,n=!!("ontouchstart"in window),a=!!window.PointerEvent,s=!!window.MSPointerEvent,l={start:"mousedown",move:"mousemove",end:"mouseup"},c={},u=(a?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},c=l):o=l,{distance:function(e,t){var n=t.x-e.x,t=t.y-e.y;return Math.sqrt(n*n+t*t)},angle:function(e,t){var n=t.x-e.x,t=t.y-e.y;return u.degrees(Math.atan2(t,n))},findCoord:function(e,t,n){var i={x:0,y:0};return n=u.radians(n),i.x=e.x-t*Math.cos(n),i.y=e.y-t*Math.sin(n),i},radians:function(e){return e*(Math.PI/180)},degrees:function(e){return e*(180/Math.PI)},bindEvt:function(e,t,n){for(var i,o=t.split(/[ ,]+/g),a=0;a<o.length;a+=1)i=o[a],e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent(i,n)},unbindEvt:function(e,t,n){for(var i,o=t.split(/[ ,]+/g),a=0;a<o.length;a+=1)i=o[a],e.removeEventListener?e.removeEventListener(i,n):e.detachEvent&&e.detachEvent(i,n)},trigger:function(e,t,n){t=new CustomEvent(t,n);e.dispatchEvent(t)},prepareEvent:function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},getScroll:function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},applyPosition:function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},getTransitionStyle:function(e,t,n){var i,o=u.configStylePropertyObject(e);for(i in o)if(o.hasOwnProperty(i))if("string"==typeof t)o[i]=t+" "+n;else{for(var a="",s=0,l=t.length;s<l;s+=1)a+=t[s]+" "+n+", ";o[i]=a.slice(0,-2)}return o},getVendorStyle:function(e,t){var n,i=u.configStylePropertyObject(e);for(n in i)i.hasOwnProperty(n)&&(i[n]=t);return i},configStylePropertyObject:function(t){var n={};return n[t]="",["webkit","Moz","o"].forEach(function(e){n[e+t.charAt(0).toUpperCase()+t.slice(1)]=""}),n},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},safeExtend:function(e,t){var n,i={};for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i},map:function(e,t){if(e.length)for(var n=0,i=e.length;n<i;n+=1)t(e[n]);else t(e)}}),d=(e.prototype.on=function(e,t){var n,i=this,o=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var a=0;a<o.length;a+=1)n=o[a],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i},e.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},void 0===e?n._handlers_={}:void 0===t?n._handlers_[e]=null:n._handlers_[e]&&0<=n._handlers_[e].indexOf(t)&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},e.prototype.trigger=function(e,t){var n,i=this,o=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var a=0;a<o.length;a+=1)n=o[a],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(e){e.call(i,{type:n,target:i},t)})},e.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=u.safeExtend(this.options,e))},e.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},u.bindEvt(e,o[t],n._domHandlers_[t]),c[t]&&u.bindEvt(e,c[t],n._domHandlers_[t]),n},e.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},u.unbindEvt(e,o[t],n._domHandlers_[t]),c[t]&&u.unbindEvt(e,c[t],n._domHandlers_[t]),delete n._domHandlers_[t],this},r.prototype=new e,(r.constructor=r).id=0,r.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},r.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=u.getVendorStyle("borderRadius","50%"),e=u.getTransitionStyle("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},u.extend(n.el,e),u.extend(n.back,t),u.extend(n.front,t),this.applyStyles(n),this},r.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},r.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},r.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},r.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},r.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},r.prototype.hide=function(t){var n=this;return n.options.dataOnly||(n.ui.el.style.opacity=n.options.restOpacity,clearTimeout(n.removeTimeout),clearTimeout(n.showTimeout),clearTimeout(n.restTimeout),n.removeTimeout=setTimeout(function(){var e="dynamic"===n.options.mode?"none":"block";n.ui.el.style.display=e,"function"==typeof t&&t.call(n),n.trigger("hidden",n.instance)},n.options.fadeTime),n.options.restJoystick&&n.restPosition()),n},r.prototype.restPosition=function(e){var t=this,n=(t.frontPosition={x:0,y:0},t.options.fadeTime+"ms"),i={},n=(i.front=u.getTransitionStyle("transition",["top","left"],n),{front:{}});n.front={left:t.frontPosition.x+"px",top:t.frontPosition.y+"px"},t.applyStyles(i),t.applyStyles(n),t.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(t),t.restCallback()},t.options.fadeTime)},r.prototype.restCallback=function(){var e={};e.front=u.getTransitionStyle("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},r.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},r.prototype.computeDirection=function(e){var t,n,i,o=e.angle.radian,a=Math.PI/4,s=Math.PI/2;if(a<o&&o<3*a&&!e.lockX?t="up":-a<o&&o<=a&&!e.lockY?t="left":3*-a<o&&o<=-a&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=-s<o&&o<s?"left":"right"),e.lockX||(i=0<o?"up":"down"),e.force>this.options.threshold){var l={};for(r in this.direction)this.direction.hasOwnProperty(r)&&(l[r]=this.direction[r]);var r,c={};for(r in this.direction={x:n,y:i,angle:t},e.direction=this.direction,l)l[r]===this.direction[r]&&(c[r]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+i,e),c.angle||this.trigger("dir dir:"+t,e)}return e},i.prototype=new e,(i.constructor=i).id=0,i.prototype.prepareNipples=function(){var e=this,i=e.nipples;i.on=e.on.bind(e),i.off=e.off.bind(e),i.options=e.options,i.destroy=e.destroy.bind(e),i.ids=e.ids,i.id=e.id,i.processOnMove=e.processOnMove.bind(e),i.processOnEnd=e.processOnEnd.bind(e),i.get=function(e){if(void 0===e)return i[0];for(var t=0,n=i.length;t<n;t+=1)if(i[t].identifier===e)return i[t];return!1}},i.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},i.prototype.begin=function(){var e=this.options;"static"===e.mode&&((e=this.createNipple(e.position,this.manager.getIdentifier())).add(),this.idles.push(e))},i.prototype.createNipple=function(e,t){var n,i=this,o=u.getScroll(),a={},s=i.options,l=(e.x&&e.y?a={x:e.x-(o.x+i.box.left),y:e.y-(o.y+i.box.top)}:(e.top||e.right||e.bottom||e.left)&&((l=document.createElement("DIV")).style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",s.zone.appendChild(l),n=l.getBoundingClientRect(),s.zone.removeChild(l),a=e,e={x:n.left+o.x,y:n.top+o.y}),new r(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0}}));return s.dataOnly||(u.applyPosition(l.ui.el,a),u.applyPosition(l.ui.front,l.frontPosition)),i.nipples.push(l),i.trigger("added "+l.identifier+":added",l),i.manager.trigger("added "+l.identifier+":added",l),i.bindNipple(l),l},i.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},i.prototype.bindNipple=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,i.trigger(n,t)}var n,i=this;e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},i.prototype.pressureFn=function(t,n,e){var i=this,o=0;clearInterval(i.pressureIntervals[e]),i.pressureIntervals[e]=setInterval(function(){var e=t.force||t.pressure||t.webkitForce||0;e!==o&&(n.trigger("pressure",e),i.trigger("pressure "+n.identifier+":pressure",e),o=e)}.bind(i),100)},i.prototype.onstart=function(e){var t=this,n=t.options;return e=u.prepareEvent(e),t.updateBox(),u.map(e,function(e){t.actives.length<n.maxNumberOfNipples&&t.processOnStart(e)}),t.manager.bindDocument(),!1},i.prototype.processOnStart=function(t){function e(e){e.trigger("start",e),n.trigger("start "+e.id+":start",e),e.show(),0<a&&n.pressureFn(t,e,e.identifier),n.processOnMove(t)}var n=this,i=n.options,o=n.manager.getIdentifier(t),a=t.force||t.pressure||t.webkitForce||0,s={x:t.pageX,y:t.pageY},l=n.getOrCreate(o,s);l.identifier!==o&&n.manager.removeIdentifier(l.identifier),l.identifier=o;if(0<=(o=n.idles.indexOf(l))&&n.idles.splice(o,1),n.actives.push(l),n.ids.push(l.identifier),"semi"!==i.mode)e(l);else{if(!(u.distance(s,l.position)<=i.catchDistance))return l.destroy(),void n.processOnStart(t);e(l)}return l},i.prototype.getOrCreate=function(e,t){var n,i=this,o=i.options;return/(semi|static)/.test(o.mode)?(n=i.idles[0])?(i.idles.splice(0,1),n):"semi"===o.mode?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):i.createNipple(t,e)},i.prototype.processOnMove=function(e){var t=this,n=t.options,i=t.manager.getIdentifier(e),o=t.nipples.get(i);if(!o)return console.error("Found zombie joystick with ID "+i),void t.manager.removeIdentifier(i);o.identifier=i;var i=o.options.size/2,a={x:e.pageX,y:e.pageY},s=u.distance(a,o.position),l=u.angle(a,o.position),r=u.radians(l),c=s/i,i=(a=i<s?u.findCoord(o.position,s=i,l):a).x-o.position.x,d=a.y-o.position.y,i=(n.lockX&&(d=0),n.lockY&&(i=0),o.frontPosition={x:i,y:d},n.dataOnly||u.applyPosition(o.ui.front,o.frontPosition),{identifier:o.identifier,position:a,force:c,pressure:e.force||e.pressure||e.webkitForce||0,distance:s,angle:{radian:r,degree:l},instance:o,lockX:n.lockX,lockY:n.lockY});(i=o.computeDirection(i)).angle={radian:u.radians(180-l),degree:180-l},o.trigger("move",i),t.trigger("move "+o.id+":move",i)},i.prototype.processOnEnd=function(e){var t=this,n=t.options,e=t.manager.getIdentifier(e),i=t.nipples.get(e),e=t.manager.removeIdentifier(i.identifier);i&&(n.dataOnly||i.hide(function(){"dynamic"===n.mode&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())}),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),0<=t.ids.indexOf(i.identifier)&&t.ids.splice(t.ids.indexOf(i.identifier),1),0<=t.actives.indexOf(i)&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(n.mode)?t.idles.push(i):0<=t.nipples.indexOf(i)&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[e.id]=e.identifier))},i.prototype.onDestroyed=function(e,t){var n=this;0<=n.nipples.indexOf(t)&&n.nipples.splice(n.nipples.indexOf(t),1),0<=n.actives.indexOf(t)&&n.actives.splice(n.actives.indexOf(t),1),0<=n.idles.indexOf(t)&&n.idles.splice(n.idles.indexOf(t),1),0<=n.ids.indexOf(t.identifier)&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument()},i.prototype.destroy=function(){var e,t=this;for(e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(e){e.destroy()}),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()},t.prototype=new e,(t.constructor=t).prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every(function(e){return!(n=e.get(t))}),n}},t.prototype.create=function(e){return this.createCollection(e)},t.prototype.createCollection=function(e){e=new i(this,e);return this.bindCollection(e),this.collections.push(e),e},t.prototype.bindCollection=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,i.trigger(n,t)}var n,i=this;e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},t.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},t.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},t.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},t.prototype.removeIdentifier=function(e){var t,n={};for(t in this.ids)if(this.ids[t]===e){n.id=t,n.identifier=this.ids[t],delete this.ids[t];break}return n},t.prototype.onmove=function(e){return this.onAny("move",e),!1},t.prototype.onend=function(e){return this.onAny("end",e),!1},t.prototype.oncancel=function(e){return this.onAny("end",e),!1},t.prototype.onAny=function(e,t){var n,i=this,o="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=u.prepareEvent(t);return u.map(t,function(e){n=i.getIdentifier(e),u.map(i.collections,function(e,t,n){0<=n.ids.indexOf(t)&&(n[o](e),e._found_=!0)}.bind(null,e,n)),e._found_||i.removeIdentifier(n)}),!1},t.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(e){e.destroy()}),e.off()},t.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)},new t);return{create:function(e){return d.create(e)},factory:d}},"object"==o(t)&&void 0!==e?e.exports=i():void 0!==(t="function"==typeof(i=i)?i.apply(t,[]):i)&&(e.exports=t)},null,function(p,o,s){"use strict";for(var m in window.EJS_RESET_VARS=[],window)window.EJS_RESET_VARS.push(m);s.r(o);function t(e){return null!=e?e.constructor:null}function n(e,t){return Boolean(e&&t&&e instanceof t)}function _(e){return null==e}function b(e){return t(e)===Object}function y(e){return t(e)===String}function x(e){return Array.isArray(e)}function T(e){return n(e,NodeList)}function S(e){return _(e)||(y(e)||x(e)||T(e))&&!e.length||b(e)&&!Object.keys(e).length}let E={volume:.5,muted:!1,i18n:{restart:"Restart",play:"Play",pause:"Pause",played:"Played",volume:"Volume",mute:"Mute (F9)",unmute:"Unmute (F9)",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",settings:"Settings",saveState:"Save State (Shift + F2)",loadState:"Load State (Shift + F4)",screenRecord:"Start Screen Recording",gamepad:"Control Settings",cheat:"Cheats",menuBack:"Go back to previous menu",normal:"Normal",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",playNow:"Start Game"},listeners:{play:null,pause:null,restart:null,rewind:null,mute:null,volume:null,fullscreen:null},events:["ready"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".ejs",controls:{container:null,wrapper:".jes__controls"},buttons:{play:'[data-btn="play"]',pause:'[data-btn="pause"]',mute:'[data-btn="mute"]',fullscreen:'[data-btn="fullscreen"]',settings:'[data-btn="settings"]',saveState:'[data-btn="save-state"]',loadState:'[data-btn="load-state"]',screenRecord:'[data-btn="screen-record"]',gamepad:'[data-btn="gamepad"]',cheat:'[data-btn="cheat"]'},inputs:{volume:'[data-range="volume"]'}},classNames:{type:"ejs--video",video:"ejs__video-wrapper",poster:"ejs__poster",posterEnabled:"ejs__poster-enabled",control:"ejs__control",controlPressed:"ejs__control--pressed",playing:"ejs--playing",paused:"ejs--paused",stopped:"ejs--stopped",loading:"ejs--loading",hover:"ejs--hover",tooltip:"ejs__tooltip",hidden:"ejs__sr-only",hideControls:"ejs--hide-controls",isIos:"ejs--is-ios",isTouch:"ejs--is-touch",uiSupported:"ejs--full-ui",noTransition:"ejs--no-transition",menu:{value:"ejs__menu__value",badge:"ejs__badge",open:"ejs--menu-open"},fullscreen:{enabled:"ejs--fullscreen-enabled",fallback:"ejs--fullscreen-fallback"},tabFocus:"ejs__tab-focus"}},k=s(0),C=s(157),w=s.n(C),B={nullOrUndefined:_,object:b,number:function(e){return t(e)===Number&&!Number.isNaN(e)},string:y,boolean:function(e){return t(e)===Boolean},function:function(e){return t(e)===Function},array:x,weakMap:function(e){return n(e,WeakMap)},nodeList:T,element:function(e){return n(e,Element)},textNode:function(e){return t(e)===Text},event:function(e){return n(e,Event)},keyboardEvent:function(e){return n(e,KeyboardEvent)},cue:function(e){return n(e,window.TextTrackCue)||n(e,window.VTTCue)},track:function(e){return n(e,TextTrack)||!_(e)&&y(e.kind)},url:function(e){if(n(e,window.URL))return!0;let t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!S(new URL(t).hostname)}catch(e){return!1}},empty:S},P=function(){let e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){return e=!0,null}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function r(n,i,o){let a=this,s=3<arguments.length&&void 0!==arguments[3]&&arguments[3],l=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],r=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if(n&&"addEventListener"in n&&!B.empty(i)&&B.function(o)){let e=i.split(" "),t=r;P&&(t={passive:l,capture:r}),e.forEach(function(e){a&&a.eventListeners&&s&&a.eventListeners.push({element:n,type:e,callback:o,options:t}),n[s?"addEventListener":"removeEventListener"](e,o,t)})}}function j(e){r.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!0,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function M(e){r.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!1,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function ie(i){let o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=2<arguments.length?arguments[2]:void 0,s=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],l=4<arguments.length&&void 0!==arguments[4]&&arguments[4];r.call(this,i,o,function e(){M(i,o,e,s,l);let t=arguments.length,n=new Array(t);for(let e=0;e<t;e++)n[e]=arguments[e];a.apply(this,n)},!0,s,l)}function G(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};B.element(e)&&!B.empty(t)&&(t=new CustomEvent(t,{bubbles:n,detail:Object.assign({},i,{emulator:this})}),e.dispatchEvent(t))}let O=s(158),I=s.n(O);function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(n,i){let o=[],a=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(a=(e=t.next()).done)&&(o.push(e.value),!i||o.length!==i);a=!0);}catch(e){t=!0,s=e}finally{try{a||null==_0x557ef0.return||_0x557ef0.return()}finally{if(t)throw s}}return o}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function R(e,a){e=e.length?e:[e];Array.from(e).reverse().forEach(function(e,t){let n=0<t?a.cloneNode(!0):a,i=e.parentNode,o=e.nextSibling;n.appendChild(e),o?i.insertBefore(n,o):i.appendChild(n)})}function N(n,e){B.element(n)&&!B.empty(e)&&Object.entries(e).filter(function(e){e=A(e,2)[1];return!B.nullOrUndefined(e)}).forEach(function(e){var e=A(e,2),t=e[0],e=e[1];return n.setAttribute(t,e)})}function F(e,t,n){let i=document.createElement(e);return B.object(t)&&N(i,t),B.string(n)&&(i.innerText=n),i}function L(e){B.nodeList(e)||B.array(e)?Array.from(e).forEach(L):B.element(e)&&B.element(e.parentNode)&&e.parentNode.removeChild(e)}function h(e,t){if(!B.string(e)||B.empty(e))return{};let s={},l=t;return e.split(",").forEach(function(e){let t=e.trim(),n=t.replace(".",""),i=t.replace(/[[\]]/g,"").split("="),o=i[0],a=1<i.length?i[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":B.object(l)&&B.string(l.class)&&(l.class+=" ".concat(n)),s.class=n;break;case"#":s.id=t.replace("#","");break;case"[":s[o]=a}}),s}function U(t,n){if(B.element(t)){let e=n;(e=B.boolean(e)?e:!t.hidden)?t.setAttribute("hidden",""):t.removeAttribute("hidden")}}function V(t,n,i){if(B.nodeList(t))return Array.from(t).map(function(e){return V(e,n,i)});if(B.element(t)){let e=void 0!==i?i?"add":"remove":"toggle";return t.classList[e](n),t.classList.contains(n)}return!1}function z(e,t){return B.element(e)&&e.classList.contains(t)}function D(e,t){let n={Element:Element};return(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(e,t)}function c(e){return this.elements.container.querySelectorAll(e)}function H(e){return this.elements.container.querySelector(e)}function oe(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];B.element(e)&&(e.focus(),t&&V(e,this.config.classNames.tabFocus))}function Y(e){return w.a.bind(I.a)(e)}let ae,se,le,re=(ae=document.createElement("span"),se={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},le=Object.keys(se).find(function(e){return void 0!==ae.style[e]}),!!B.string(le)&&se[le]);function ce(e){setTimeout(function(){try{U(e,!0),e.offsetHeight,U(e,!1)}catch(e){}},0)}let de,q={isEdge:"Netscape"===navigator.appName&&-1<navigator.appVersion.indexOf("Edge"),isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform),info:function(){let e=/(MSIE|(?!Gecko.+)Firefox|(?!AppleWebKit.+Chrome.+)Safari|(?!AppleWebKit.+)Chrome|AppleWebKit(?!.+Chrome|.+Safari)|Gecko(?!.+Firefox))(?: |\/)([\d\.apre]+)/.exec(navigator.userAgent);return{name:e[1].toLowerCase(),version:e[2]}}},X={rangeInput:((de=document.createElement("input")).type="range")===de.type,touch:"ontouchstart"in document.documentElement,transitions:!1!==re,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches,webgl:function(){let a={DETECTED:!1};if(!a.DETECTED){let o=document.createElement("canvas");if(o&&o.getContext)for(let n=["webgl2","experimental-webgl2","webgl","experimental-webgl"],i=0,e=n.length;i<e;++i){let e=n[i],t=o.getContext(e);if(t){a.WEBGL_CONTEXT=e,a.WEBGL_VERSION=t.getParameter(t.VERSION),a.WEBGL_VENDOR=t.getParameter(t.VENDOR),a.WEBGL_SL_VERSION=t.getParameter(t.SHADING_LANGUAGE_VERSION),a.MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE);var s=t.getExtension("WEBGL_debug_renderer_info");s&&(a.WEBGL_VENDOR=t.getParameter(s.UNMASKED_VENDOR_WEBGL),a.WEBGL_RENDERER=t.getParameter(s.UNMASKED_RENDERER_WEBGL)),a.DETECTED=!0;break}}}return a}(),wasm:"undefined"!=typeof WebAssembly&&B.object(WebAssembly),audioContext:"undefined"!=typeof AudioContext};function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(){let t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=new Array(1<o?o-1:0);for(let e=arguments.length,t=1;t<e;t++)n[t-1]=arguments[t];if(!n.length)return t;let i=n.shift();return B.object(i)?(Object.keys(i).forEach(function(e){B.object(i[e])?(Object.keys(t).includes(e)||Object.assign(t,ue({},e,{})),W(t[e],i[e])):Object.assign(t,ue({},e,i[e]))}),W.apply(void 0,[t].concat(n))):t}function fe(e,t,n){let i=0<arguments.length&&void 0!==e?e:"",o=1<arguments.length&&void 0!==t?t:"",a=2<arguments.length&&void 0!==n?n:"";return i.replace(new RegExp(o.toString().replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"),a.toString())}let pe={get:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(B.empty(t)||B.empty(n))return"";e=n.i18n;let i=t.split(".").reduce(function(e,t){return e&&e[t]},e);if(B.empty(i))return"";t={"{seektime}":n.seekTime,"{title}":n.title};return Object.entries(t).forEach(function(e){t=2;var e=function(e){if(Array.isArray(e))return e}(e=e)||function(n,i){let o=[],a=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(a=(e=t.next()).done)&&(o.push(e.value),!i||o.length!==i);a=!0);}catch(e){t=!0,s=e}finally{try{a||null==_0x2f59ed.return||_0x2f59ed.return()}finally{if(t)throw s}}return o}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),t=e[0],e=e[1];i=fe(i,t,e)}),i}};function me(n,i){for(let t=0;t<i.length;t++){let e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}u=[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.getItem("___test")||window.localStorage.setItem("___test","___test"),!0)}catch(e){return!1}}}],me((e=ve).prototype,[{key:"get",value:function(e){if(!ve.supported||!this.enabled)return null;var t=window.localStorage.getItem(this.key);if(B.empty(t))return null;t=JSON.parse(t);return B.string(e)&&e.length?t[e]:t}},{key:"set",value:function(t){if(ve.supported&&this.enabled&&B.object(t)){let e=this.get();W(e=B.empty(e)?{}:e,t),window.localStorage.setItem(this.key,JSON.stringify(e))}}}]),me(e,u);let he=ve;function ve(e,t){if(!(this instanceof ve))throw new TypeError("Cannot call a class as a function");this.enabled=!0,this.key=t}let ge,_e=s(6),be=s(159),ye=s.n(be),xe={"2xScaleHQ.glslp":'shaders = 1\n\nshader0 = "2xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"4xScaleHQ.glslp":'shaders = 1\n\nshader0 = "4xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"5xbrz.glslp":'shaders = 1\nshader0 = "5xbrz.glsl"\nfilter_linear0 = false\nscale_type0 = source\nscale0 = 5.0\n',"6xbrz.glslp":'shaders = 1\nshader0 = "6xbrz.glsl"\nfilter_linear0 = false\nscale_type0 = source\nscale0 = 6.0\n',"crt-easymode.glslp":"shaders = 1\n\nshader0 = crt-easymode.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","crt-aperture.glslp":"shaders = 1\n\nshader0 = crt-aperture.glsl\nfilter_linear0 = false\n","crt-geom.glslp":"shaders = 1\n\nshader0 = crt-geom.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","crt-mattias.glslp":"\nshaders = 1\nshader0 = crt-mattias.glsl\nfilter_linear0 = false\n","2xScaleHQ.glsl":"/*\n2xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 dx = vec2(x, 0.0);\nvec2 dy = vec2(0.0, y);\nt1 = vec4(vTexCoord - dg1, vTexCoord - dy);\nt2 = vec4(vTexCoord - dg2, vTexCoord + dx);\nt3 = vec4(vTexCoord + dg1, vTexCoord + dy);\nt4 = vec4(vTexCoord + dg2, vTexCoord - dx);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 0.325;      // start smoothing wt.\nfloat k = -0.250;      // wt. decrease factor\nfloat max_w = 0.25;    // max filter weight\nfloat min_w =-0.05;    // min filter weight\nfloat lum_add = 0.25;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c00 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 c10 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 c20 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 c01 = COMPAT_TEXTURE(Source, t4.zw).xyz; \nvec3 c11 = COMPAT_TEXTURE(Source, vTexCoord).xyz; \nvec3 c21 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 c02 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 c12 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 c22 = COMPAT_TEXTURE(Source, t3.xy).xyz; \n\nfloat md1 = dot(abs(c00 - c22), dt);\nfloat md2 = dot(abs(c02 - c20), dt);\n\nfloat w1 = dot(abs(c22 - c11), dt) * md2;\nfloat w2 = dot(abs(c02 - c11), dt) * md1;\nfloat w3 = dot(abs(c00 - c11), dt) * md2;\nfloat w4 = dot(abs(c20 - c11), dt) * md1;\n\nfloat t1 = w1 + w3;\nfloat t2 = w2 + w4;\nfloat ww = max(t1, t2) + 0.0001;\n\nc11 = (w1 * c00 + w2 * c20 + w3 * c22 + w4 * c02 + ww * c11) / (t1 + t2 + ww);\n\nfloat lc1 = k / (0.12 * dot(c10 + c12 + c11, dt) + lum_add);\nfloat lc2 = k / (0.12 * dot(c01 + c21 + c11, dt) + lum_add);\n\nw1 = clamp(lc1 * dot(abs(c11 - c10), dt) + mx, min_w, max_w);\nw2 = clamp(lc2 * dot(abs(c11 - c21), dt) + mx, min_w, max_w);\nw3 = clamp(lc1 * dot(abs(c11 - c12), dt) + mx, min_w, max_w);\nw4 = clamp(lc2 * dot(abs(c11 - c01), dt) + mx, min_w, max_w);\nFragColor = vec4(w1 * c10 + w2 * c21 + w3 * c12 + w4 * c01 + (1.0 - w1 - w2 - w3 - w4) * c11, 1.0);\n} \n#endif\n","4xScaleHQ.glsl":"/*\n4xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 sd1 = dg1 * 0.5;\nvec2 sd2 = dg2 * 0.5;\nvec2 ddx = vec2(x, 0.0);\nvec2 ddy = vec2(0.0, y);\nt1 = vec4(vTexCoord - sd1, vTexCoord - ddy);\nt2 = vec4(vTexCoord - sd2, vTexCoord + ddx);\nt3 = vec4(vTexCoord + sd1, vTexCoord + ddy);\nt4 = vec4(vTexCoord + sd2, vTexCoord - ddx);\nt5 = vec4(vTexCoord - dg1, vTexCoord - dg2);\nt6 = vec4(vTexCoord + dg1, vTexCoord + dg2);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 1.0;      // start smoothing wt.\nfloat k = -1.10;      // wt. decrease factor\nfloat max_w = 0.75;    // max filter weight\nfloat min_w = 0.03;    // min filter weight\nfloat lum_add = 0.33;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c  = COMPAT_TEXTURE(Source, vTexCoord).xyz;\nvec3 i1 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 i2 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 i3 = COMPAT_TEXTURE(Source, t3.xy).xyz; \nvec3 i4 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 o1 = COMPAT_TEXTURE(Source, t5.xy).xyz; \nvec3 o3 = COMPAT_TEXTURE(Source, t6.xy).xyz; \nvec3 o2 = COMPAT_TEXTURE(Source, t5.zw).xyz;\nvec3 o4 = COMPAT_TEXTURE(Source, t6.zw).xyz;\nvec3 s1 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 s2 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 s3 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 s4 = COMPAT_TEXTURE(Source, t4.zw).xyz; \n\nfloat ko1=dot(abs(o1-c),dt);\nfloat ko2=dot(abs(o2-c),dt);\nfloat ko3=dot(abs(o3-c),dt);\nfloat ko4=dot(abs(o4-c),dt);\n\nfloat k1=min(dot(abs(i1-i3),dt),max(ko1,ko3));\nfloat k2=min(dot(abs(i2-i4),dt),max(ko2,ko4));\n\nfloat w1 = k2; if(ko3<ko1) w1*=ko3/ko1;\nfloat w2 = k1; if(ko4<ko2) w2*=ko4/ko2;\nfloat w3 = k2; if(ko1<ko3) w3*=ko1/ko3;\nfloat w4 = k1; if(ko2<ko4) w4*=ko2/ko4;\n\nc=(w1*o1+w2*o2+w3*o3+w4*o4+0.001*c)/(w1+w2+w3+w4+0.001);\nw1 = k*dot(abs(i1-c)+abs(i3-c),dt)/(0.125*dot(i1+i3,dt)+lum_add);\nw2 = k*dot(abs(i2-c)+abs(i4-c),dt)/(0.125*dot(i2+i4,dt)+lum_add);\nw3 = k*dot(abs(s1-c)+abs(s3-c),dt)/(0.125*dot(s1+s3,dt)+lum_add);\nw4 = k*dot(abs(s2-c)+abs(s4-c),dt)/(0.125*dot(s2+s4,dt)+lum_add);\n\nw1 = clamp(w1+mx,min_w,max_w); \nw2 = clamp(w2+mx,min_w,max_w);\nw3 = clamp(w3+mx,min_w,max_w); \nw4 = clamp(w4+mx,min_w,max_w);\n\nFragColor = vec4((w1*(i1+i3)+w2*(i2+i4)+w3*(s1+s3)+w4*(s2+s4)+c)/(2.0*(w1+w2+w3+w4)+1.0), 1.0);\n} \n#endif\n","5xbrz.glsl":"\n#define BLEND_NONE 0\n#define BLEND_NORMAL 1\n#define BLEND_DOMINANT 2\n#define LUMINANCE_WEIGHT 1.0\n#define EQUAL_COLOR_TOLERANCE 30.0/255.0\n#define STEEP_DIRECTION_THRESHOLD 2.2\n#define DOMINANT_DIRECTION_THRESHOLD 3.6\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\nCOMPAT_VARYING vec4 t7;\n\nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// vertex compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define outsize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\n    gl_Position = MVPMatrix * VertexCoord;\n    COL0 = COLOR;\n    TEX0.xy = TexCoord.xy;\n    vec2 ps = vec2(SourceSize.z, SourceSize.w);\n    float dx = ps.x;\n    float dy = ps.y;\n\n\n    t1 = vTexCoord.xxxy + vec4( -dx, 0.0, dx,-2.0*dy); // A1 B1 C1\n    t2 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, -dy);    //  A  B  C\n    t3 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, 0.0);    //  D  E  F\n    t4 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, dy);     //  G  H  I\n    t5 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, 2.0*dy); // G5 H5 I5\n    t6 = vTexCoord.xyyy + vec4(-2.0*dx,-dy, 0.0, dy);  // A0 D0 G0\n    t7 = vTexCoord.xyyy + vec4( 2.0*dx,-dy, 0.0, dy);  // C4 F4 I4\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\nCOMPAT_VARYING vec4 t7;\n\n// fragment compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define outsize vec4(OutputSize, 1.0 / OutputSize)\n\n    const float  one_sixth = 1.0 / 6.0;\n    const float  two_sixth = 2.0 / 6.0;\n    const float four_sixth = 4.0 / 6.0;\n    const float five_sixth = 5.0 / 6.0;\n\n    float reduce(const vec3 color)\n    {\n        return dot(color, vec3(65536.0, 256.0, 1.0));\n    }\n    \n    float DistYCbCr(const vec3 pixA, const vec3 pixB)\n    {\n        const vec3 w = vec3(0.2627, 0.6780, 0.0593);\n        const float scaleB = 0.5 / (1.0 - w.b);\n        const float scaleR = 0.5 / (1.0 - w.r);\n        vec3 diff = pixA - pixB;\n        float Y = dot(diff, w);\n        float Cb = scaleB * (diff.b - Y);\n        float Cr = scaleR * (diff.r - Y);\n        \n        return sqrt( ((LUMINANCE_WEIGHT * Y) * (LUMINANCE_WEIGHT * Y)) + (Cb * Cb) + (Cr * Cr) );\n    }\n    \n    bool IsPixEqual(const vec3 pixA, const vec3 pixB)\n    {\n        return (DistYCbCr(pixA, pixB) < EQUAL_COLOR_TOLERANCE);\n    }\n    \n    bool IsBlendingNeeded(const ivec4 blend)\n    {\n        return any(notEqual(blend, ivec4(BLEND_NONE)));\n    }\n    \n\nvoid main()\n{\n    vec2 f = fract(vTexCoord.xy * SourceSize.xy);\n\n    vec3 src[25];\n    \n    src[21] = COMPAT_TEXTURE(Source, t1.xw).rgb;\n    src[22] = COMPAT_TEXTURE(Source, t1.yw).rgb;\n    src[23] = COMPAT_TEXTURE(Source, t1.zw).rgb;\n    src[ 6] = COMPAT_TEXTURE(Source, t2.xw).rgb;\n    src[ 7] = COMPAT_TEXTURE(Source, t2.yw).rgb;\n    src[ 8] = COMPAT_TEXTURE(Source, t2.zw).rgb;\n    src[ 5] = COMPAT_TEXTURE(Source, t3.xw).rgb;\n    src[ 0] = COMPAT_TEXTURE(Source, t3.yw).rgb;\n    src[ 1] = COMPAT_TEXTURE(Source, t3.zw).rgb;\n    src[ 4] = COMPAT_TEXTURE(Source, t4.xw).rgb;\n    src[ 3] = COMPAT_TEXTURE(Source, t4.yw).rgb;\n    src[ 2] = COMPAT_TEXTURE(Source, t4.zw).rgb;\n    src[15] = COMPAT_TEXTURE(Source, t5.xw).rgb;\n    src[14] = COMPAT_TEXTURE(Source, t5.yw).rgb;\n    src[13] = COMPAT_TEXTURE(Source, t5.zw).rgb;\n    src[19] = COMPAT_TEXTURE(Source, t6.xy).rgb;\n    src[18] = COMPAT_TEXTURE(Source, t6.xz).rgb;\n    src[17] = COMPAT_TEXTURE(Source, t6.xw).rgb;\n    src[ 9] = COMPAT_TEXTURE(Source, t7.xy).rgb;\n    src[10] = COMPAT_TEXTURE(Source, t7.xz).rgb;\n    src[11] = COMPAT_TEXTURE(Source, t7.xw).rgb;\n    \n        float v[9];\n        v[0] = reduce(src[0]);\n        v[1] = reduce(src[1]);\n        v[2] = reduce(src[2]);\n        v[3] = reduce(src[3]);\n        v[4] = reduce(src[4]);\n        v[5] = reduce(src[5]);\n        v[6] = reduce(src[6]);\n        v[7] = reduce(src[7]);\n        v[8] = reduce(src[8]);\n        \n        ivec4 blendResult = ivec4(BLEND_NONE);\n        \n        if ( ((v[0] == v[1] && v[3] == v[2]) || (v[0] == v[3] && v[1] == v[2])) == false)\n        {\n            float dist_03_01 = DistYCbCr(src[ 4], src[ 0]) + DistYCbCr(src[ 0], src[ 8]) + DistYCbCr(src[14], src[ 2]) + DistYCbCr(src[ 2], src[10]) + (4.0 * DistYCbCr(src[ 3], src[ 1]));\n            float dist_00_02 = DistYCbCr(src[ 5], src[ 3]) + DistYCbCr(src[ 3], src[13]) + DistYCbCr(src[ 7], src[ 1]) + DistYCbCr(src[ 1], src[11]) + (4.0 * DistYCbCr(src[ 0], src[ 2]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_03_01) < dist_00_02;\n            blendResult[2] = ((dist_03_01 < dist_00_02) && (v[0] != v[1]) && (v[0] != v[3])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n\n        if ( ((v[5] == v[0] && v[4] == v[3]) || (v[5] == v[4] && v[0] == v[3])) == false)\n        {\n            float dist_04_00 = DistYCbCr(src[17], src[ 5]) + DistYCbCr(src[ 5], src[ 7]) + DistYCbCr(src[15], src[ 3]) + DistYCbCr(src[ 3], src[ 1]) + (4.0 * DistYCbCr(src[ 4], src[ 0]));\n            float dist_05_03 = DistYCbCr(src[18], src[ 4]) + DistYCbCr(src[ 4], src[14]) + DistYCbCr(src[ 6], src[ 0]) + DistYCbCr(src[ 0], src[ 2]) + (4.0 * DistYCbCr(src[ 5], src[ 3]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_05_03) < dist_04_00;\n            blendResult[3] = ((dist_04_00 > dist_05_03) && (v[0] != v[5]) && (v[0] != v[3])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n        \n        if ( ((v[7] == v[8] && v[0] == v[1]) || (v[7] == v[0] && v[8] == v[1])) == false)\n        {\n            float dist_00_08 = DistYCbCr(src[ 5], src[ 7]) + DistYCbCr(src[ 7], src[23]) + DistYCbCr(src[ 3], src[ 1]) + DistYCbCr(src[ 1], src[ 9]) + (4.0 * DistYCbCr(src[ 0], src[ 8]));\n            float dist_07_01 = DistYCbCr(src[ 6], src[ 0]) + DistYCbCr(src[ 0], src[ 2]) + DistYCbCr(src[22], src[ 8]) + DistYCbCr(src[ 8], src[10]) + (4.0 * DistYCbCr(src[ 7], src[ 1]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_07_01) < dist_00_08;\n            blendResult[1] = ((dist_00_08 > dist_07_01) && (v[0] != v[7]) && (v[0] != v[1])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n        \n        if ( ((v[6] == v[7] && v[5] == v[0]) || (v[6] == v[5] && v[7] == v[0])) == false)\n        {\n            float dist_05_07 = DistYCbCr(src[18], src[ 6]) + DistYCbCr(src[ 6], src[22]) + DistYCbCr(src[ 4], src[ 0]) + DistYCbCr(src[ 0], src[ 8]) + (4.0 * DistYCbCr(src[ 5], src[ 7]));\n            float dist_06_00 = DistYCbCr(src[19], src[ 5]) + DistYCbCr(src[ 5], src[ 3]) + DistYCbCr(src[21], src[ 7]) + DistYCbCr(src[ 7], src[ 1]) + (4.0 * DistYCbCr(src[ 6], src[ 0]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_05_07) < dist_06_00;\n            blendResult[0] = ((dist_05_07 < dist_06_00) && (v[0] != v[5]) && (v[0] != v[7])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n        \n        vec3 dst[25];\n        dst[ 0] = src[0];\n        dst[ 1] = src[0];\n        dst[ 2] = src[0];\n        dst[ 3] = src[0];\n        dst[ 4] = src[0];\n        dst[ 5] = src[0];\n        dst[ 6] = src[0];\n        dst[ 7] = src[0];\n        dst[ 8] = src[0];\n        dst[ 9] = src[0];\n        dst[10] = src[0];\n        dst[11] = src[0];\n        dst[12] = src[0];\n        dst[13] = src[0];\n        dst[14] = src[0];\n        dst[15] = src[0];\n        dst[16] = src[0];\n        dst[17] = src[0];\n        dst[18] = src[0];\n        dst[19] = src[0];\n        dst[20] = src[0];\n        dst[21] = src[0];\n        dst[22] = src[0];\n        dst[23] = src[0];\n        dst[24] = src[0];\n        \n        if (IsBlendingNeeded(blendResult) == true)\n        {\n            float dist_01_04 = DistYCbCr(src[1], src[4]);\n            float dist_03_08 = DistYCbCr(src[3], src[8]);\n            bool haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[4]) && (v[5] != v[4]);\n            bool haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[8]) && (v[7] != v[8]);\n            bool needBlend = (blendResult[2] != BLEND_NONE);\n            bool doLineBlend = (  blendResult[2] >= BLEND_DOMINANT ||\n                                ((blendResult[1] != BLEND_NONE && !IsPixEqual(src[0], src[4])) ||\n                                    (blendResult[3] != BLEND_NONE && !IsPixEqual(src[0], src[8])) ||\n                                    (IsPixEqual(src[4], src[3]) && IsPixEqual(src[3], src[2]) && IsPixEqual(src[2], src[1]) && IsPixEqual(src[1], src[8]) && IsPixEqual(src[0], src[2]) == false) ) == false );\n            \n            vec3 blendPix = ( DistYCbCr(src[0], src[1]) <= DistYCbCr(src[0], src[3]) ) ? src[1] : src[3];\n            dst[ 1] = mix(dst[ 1], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[ 2] = mix(dst[ 2], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? ((haveSteepLine) ? 2.0/3.0 : 0.750) : ((haveSteepLine) ? 0.750 : 0.125)) : 0.000);\n            dst[ 3] = mix(dst[ 3], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[ 9] = mix(dst[ 9], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[10] = mix(dst[10], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.250 : 0.125)) : 0.000);\n            dst[11] = mix(dst[11], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[12] = mix(dst[12], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.8631434088) : 0.000);\n            dst[13] = mix(dst[13], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[14] = mix(dst[14], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.250 : 0.125)) : 0.000);\n            dst[15] = mix(dst[15], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[16] = mix(dst[16], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[24] = mix(dst[24], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            \n            dist_01_04 = DistYCbCr(src[7], src[2]);\n            dist_03_08 = DistYCbCr(src[1], src[6]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[2]) && (v[3] != v[2]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[6]) && (v[5] != v[6]);\n            needBlend = (blendResult[1] != BLEND_NONE);\n            doLineBlend = (  blendResult[1] >= BLEND_DOMINANT ||\n                            !((blendResult[0] != BLEND_NONE && !IsPixEqual(src[0], src[2])) ||\n                            (blendResult[2] != BLEND_NONE && !IsPixEqual(src[0], src[6])) ||\n                            (IsPixEqual(src[2], src[1]) && IsPixEqual(src[1], src[8]) && IsPixEqual(src[8], src[7]) && IsPixEqual(src[7], src[6]) && !IsPixEqual(src[0], src[8])) ) );\n            \n            blendPix = ( DistYCbCr(src[0], src[7]) <= DistYCbCr(src[0], src[1]) ) ? src[7] : src[1];\n            dst[ 7] = mix(dst[ 7], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[ 8] = mix(dst[ 8], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? ((haveSteepLine) ? 2.0/3.0 : 0.750) : ((haveSteepLine) ? 0.750 : 0.125)) : 0.000);\n            dst[ 1] = mix(dst[ 1], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[21] = mix(dst[21], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[22] = mix(dst[22], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.250 : 0.125)) : 0.000);\n            dst[23] = mix(dst[23], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[24] = mix(dst[24], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.8631434088) : 0.000);\n            dst[ 9] = mix(dst[ 9], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[10] = mix(dst[10], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.250 : 0.125)) : 0.000);\n            dst[11] = mix(dst[11], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[12] = mix(dst[12], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[20] = mix(dst[20], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n\n            dist_01_04 = DistYCbCr(src[5], src[8]);\n            dist_03_08 = DistYCbCr(src[7], src[4]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[8]) && (v[1] != v[8]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[4]) && (v[3] != v[4]);\n            needBlend = (blendResult[0] != BLEND_NONE);\n            doLineBlend = (  blendResult[0] >= BLEND_DOMINANT ||\n                            !((blendResult[3] != BLEND_NONE && !IsPixEqual(src[0], src[8])) ||\n                            (blendResult[1] != BLEND_NONE && !IsPixEqual(src[0], src[4])) ||\n                            (IsPixEqual(src[8], src[7]) && IsPixEqual(src[7], src[6]) && IsPixEqual(src[6], src[5]) && IsPixEqual(src[5], src[4]) && !IsPixEqual(src[0], src[6])) ) );\n            \n            blendPix = ( DistYCbCr(src[0], src[5]) <= DistYCbCr(src[0], src[7]) ) ? src[5] : src[7];\n            dst[ 5] = mix(dst[ 5], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[ 6] = mix(dst[ 6], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? ((haveSteepLine) ? 2.0/3.0 : 0.750) : ((haveSteepLine) ? 0.750 : 0.125)) : 0.000);\n            dst[ 7] = mix(dst[ 7], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[17] = mix(dst[17], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[18] = mix(dst[18], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.250 : 0.125)) : 0.000);\n            dst[19] = mix(dst[19], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[20] = mix(dst[20], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.8631434088) : 0.000);\n            dst[21] = mix(dst[21], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[22] = mix(dst[22], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.250 : 0.125)) : 0.000);\n            dst[23] = mix(dst[23], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[24] = mix(dst[24], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[16] = mix(dst[16], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            \n            \n            dist_01_04 = DistYCbCr(src[3], src[6]);\n            dist_03_08 = DistYCbCr(src[5], src[2]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[6]) && (v[7] != v[6]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[2]) && (v[1] != v[2]);\n            needBlend = (blendResult[3] != BLEND_NONE);\n            doLineBlend = (  blendResult[3] >= BLEND_DOMINANT ||\n                            !((blendResult[2] != BLEND_NONE && !IsPixEqual(src[0], src[6])) ||\n                            (blendResult[0] != BLEND_NONE && !IsPixEqual(src[0], src[2])) ||\n                            (IsPixEqual(src[6], src[5]) && IsPixEqual(src[5], src[4]) && IsPixEqual(src[4], src[3]) && IsPixEqual(src[3], src[2]) && !IsPixEqual(src[0], src[4])) ) );\n            \n            blendPix = ( DistYCbCr(src[0], src[3]) <= DistYCbCr(src[0], src[5]) ) ? src[3] : src[5];\n            dst[ 3] = mix(dst[ 3], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[ 4] = mix(dst[ 4], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? ((haveSteepLine) ? 2.0/3.0 : 0.750) : ((haveSteepLine) ? 0.750 : 0.125)) : 0.000);\n            dst[ 5] = mix(dst[ 5], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[13] = mix(dst[13], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[14] = mix(dst[14], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.250 : 0.125)) : 0.000);\n            dst[15] = mix(dst[15], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[16] = mix(dst[16], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.8631434088) : 0.000);\n            dst[17] = mix(dst[17], blendPix, (needBlend) ? ((doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.875 : 1.000) : 0.2306749731) : 0.000);\n            dst[18] = mix(dst[18], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.250 : 0.125)) : 0.000);\n            dst[19] = mix(dst[19], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[20] = mix(dst[20], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[12] = mix(dst[12], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\t\t\t\n        }\n        \n        vec3 res = mix(           mix( dst[20], mix( mix(dst[21], dst[22], step(0.40, f.x)), mix(dst[23], dst[24], step(0.80, f.x)), step(0.60, f.x)), step(0.20, f.x) ),\n                                mix( mix( mix( dst[19], mix( mix(dst[ 6], dst[ 7], step(0.40, f.x)), mix(dst[ 8], dst[ 9], step(0.80, f.x)), step(0.60, f.x)), step(0.20, f.x) ),\n                                            mix( dst[18], mix( mix(dst[ 5], dst[ 0], step(0.40, f.x)), mix(dst[ 1], dst[10], step(0.80, f.x)), step(0.60, f.x)), step(0.20, f.x) ), step(0.40, f.y)),\n                                        mix( mix( dst[17], mix( mix(dst[ 4], dst[ 3], step(0.40, f.x)), mix(dst[ 2], dst[11], step(0.80, f.x)), step(0.60, f.x)), step(0.20, f.x) ),\n                                            mix( dst[16], mix( mix(dst[15], dst[14], step(0.40, f.x)), mix(dst[13], dst[12], step(0.80, f.x)), step(0.60, f.x)), step(0.20, f.x) ), step(0.80, f.y)),\n                                                                                                                                                                                    step(0.60, f.y)),\n                                                                                                                                                                                    step(0.20, f.y));\n                                    \n    FragColor = vec4(res, 1.0);\n} \n#endif\n","6xbrz.glsl":"\n#define BLEND_NONE 0\n#define BLEND_NORMAL 1\n#define BLEND_DOMINANT 2\n#define LUMINANCE_WEIGHT 1.0\n#define EQUAL_COLOR_TOLERANCE 30.0/255.0\n#define STEEP_DIRECTION_THRESHOLD 2.2\n#define DOMINANT_DIRECTION_THRESHOLD 3.6\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\nCOMPAT_VARYING vec4 t7;\n\nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// vertex compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define outsize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\n    gl_Position = MVPMatrix * VertexCoord;\n    COL0 = COLOR;\n    TEX0.xy = TexCoord.xy;\n    vec2 ps = vec2(SourceSize.z, SourceSize.w);\n    float dx = ps.x;\n    float dy = ps.y;\n\n        //  A1 B1 C1\n    // A0 A  B  C C4\n    // D0 D  E  F F4\n    // G0 G  H  I I4\n        //  G5 H5 I5\n\n    t1 = vTexCoord.xxxy + vec4( -dx, 0.0, dx,-2.0*dy); // A1 B1 C1\n    t2 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, -dy);    //  A  B  C\n    t3 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, 0.0);    //  D  E  F\n    t4 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, dy);     //  G  H  I\n    t5 = vTexCoord.xxxy + vec4( -dx, 0.0, dx, 2.0*dy); // G5 H5 I5\n    t6 = vTexCoord.xyyy + vec4(-2.0*dx,-dy, 0.0, dy);  // A0 D0 G0\n    t7 = vTexCoord.xyyy + vec4( 2.0*dx,-dy, 0.0, dy);  // C4 F4 I4\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\nCOMPAT_VARYING vec4 t7;\n\n// fragment compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define outsize vec4(OutputSize, 1.0 / OutputSize)\n\n    const float  one_sixth = 1.0 / 6.0;\n    const float  two_sixth = 2.0 / 6.0;\n    const float four_sixth = 4.0 / 6.0;\n    const float five_sixth = 5.0 / 6.0;\n\n    float reduce(const vec3 color)\n    {\n        return dot(color, vec3(65536.0, 256.0, 1.0));\n    }\n    \n    float DistYCbCr(const vec3 pixA, const vec3 pixB)\n    {\n        const vec3 w = vec3(0.2627, 0.6780, 0.0593);\n        const float scaleB = 0.5 / (1.0 - w.b);\n        const float scaleR = 0.5 / (1.0 - w.r);\n        vec3 diff = pixA - pixB;\n        float Y = dot(diff, w);\n        float Cb = scaleB * (diff.b - Y);\n        float Cr = scaleR * (diff.r - Y);\n        \n        return sqrt( ((LUMINANCE_WEIGHT * Y) * (LUMINANCE_WEIGHT * Y)) + (Cb * Cb) + (Cr * Cr) );\n    }\n    \n    bool IsPixEqual(const vec3 pixA, const vec3 pixB)\n    {\n        return (DistYCbCr(pixA, pixB) < EQUAL_COLOR_TOLERANCE);\n    }\n    \n    bool IsBlendingNeeded(const ivec4 blend)\n    {\n        return any(notEqual(blend, ivec4(BLEND_NONE)));\n    }\n\n\nvoid main()\n{\n    vec2 f = fract(vTexCoord.xy * SourceSize.xy);\n\n    vec3 src[25];\n    \n    src[21] = COMPAT_TEXTURE(Source, t1.xw).rgb;\n    src[22] = COMPAT_TEXTURE(Source, t1.yw).rgb;\n    src[23] = COMPAT_TEXTURE(Source, t1.zw).rgb;\n    src[ 6] = COMPAT_TEXTURE(Source, t2.xw).rgb;\n    src[ 7] = COMPAT_TEXTURE(Source, t2.yw).rgb;\n    src[ 8] = COMPAT_TEXTURE(Source, t2.zw).rgb;\n    src[ 5] = COMPAT_TEXTURE(Source, t3.xw).rgb;\n    src[ 0] = COMPAT_TEXTURE(Source, t3.yw).rgb;\n    src[ 1] = COMPAT_TEXTURE(Source, t3.zw).rgb;\n    src[ 4] = COMPAT_TEXTURE(Source, t4.xw).rgb;\n    src[ 3] = COMPAT_TEXTURE(Source, t4.yw).rgb;\n    src[ 2] = COMPAT_TEXTURE(Source, t4.zw).rgb;\n    src[15] = COMPAT_TEXTURE(Source, t5.xw).rgb;\n    src[14] = COMPAT_TEXTURE(Source, t5.yw).rgb;\n    src[13] = COMPAT_TEXTURE(Source, t5.zw).rgb;\n    src[19] = COMPAT_TEXTURE(Source, t6.xy).rgb;\n    src[18] = COMPAT_TEXTURE(Source, t6.xz).rgb;\n    src[17] = COMPAT_TEXTURE(Source, t6.xw).rgb;\n    src[ 9] = COMPAT_TEXTURE(Source, t7.xy).rgb;\n    src[10] = COMPAT_TEXTURE(Source, t7.xz).rgb;\n    src[11] = COMPAT_TEXTURE(Source, t7.xw).rgb;\n    \n        float v[9];\n        v[0] = reduce(src[0]);\n        v[1] = reduce(src[1]);\n        v[2] = reduce(src[2]);\n        v[3] = reduce(src[3]);\n        v[4] = reduce(src[4]);\n        v[5] = reduce(src[5]);\n        v[6] = reduce(src[6]);\n        v[7] = reduce(src[7]);\n        v[8] = reduce(src[8]);\n        \n        ivec4 blendResult = ivec4(BLEND_NONE);\n\n        if ( ((v[0] == v[1] && v[3] == v[2]) || (v[0] == v[3] && v[1] == v[2])) == false)\n        {\n            float dist_03_01 = DistYCbCr(src[ 4], src[ 0]) + DistYCbCr(src[ 0], src[ 8]) + DistYCbCr(src[14], src[ 2]) + DistYCbCr(src[ 2], src[10]) + (4.0 * DistYCbCr(src[ 3], src[ 1]));\n            float dist_00_02 = DistYCbCr(src[ 5], src[ 3]) + DistYCbCr(src[ 3], src[13]) + DistYCbCr(src[ 7], src[ 1]) + DistYCbCr(src[ 1], src[11]) + (4.0 * DistYCbCr(src[ 0], src[ 2]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_03_01) < dist_00_02;\n            blendResult[2] = ((dist_03_01 < dist_00_02) && (v[0] != v[1]) && (v[0] != v[3])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n\n\n        if ( ((v[5] == v[0] && v[4] == v[3]) || (v[5] == v[4] && v[0] == v[3])) == false)\n        {\n            float dist_04_00 = DistYCbCr(src[17], src[ 5]) + DistYCbCr(src[ 5], src[ 7]) + DistYCbCr(src[15], src[ 3]) + DistYCbCr(src[ 3], src[ 1]) + (4.0 * DistYCbCr(src[ 4], src[ 0]));\n            float dist_05_03 = DistYCbCr(src[18], src[ 4]) + DistYCbCr(src[ 4], src[14]) + DistYCbCr(src[ 6], src[ 0]) + DistYCbCr(src[ 0], src[ 2]) + (4.0 * DistYCbCr(src[ 5], src[ 3]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_05_03) < dist_04_00;\n            blendResult[3] = ((dist_04_00 > dist_05_03) && (v[0] != v[5]) && (v[0] != v[3])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n        \n\n        if ( ((v[7] == v[8] && v[0] == v[1]) || (v[7] == v[0] && v[8] == v[1])) == false)\n        {\n            float dist_00_08 = DistYCbCr(src[ 5], src[ 7]) + DistYCbCr(src[ 7], src[23]) + DistYCbCr(src[ 3], src[ 1]) + DistYCbCr(src[ 1], src[ 9]) + (4.0 * DistYCbCr(src[ 0], src[ 8]));\n            float dist_07_01 = DistYCbCr(src[ 6], src[ 0]) + DistYCbCr(src[ 0], src[ 2]) + DistYCbCr(src[22], src[ 8]) + DistYCbCr(src[ 8], src[10]) + (4.0 * DistYCbCr(src[ 7], src[ 1]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_07_01) < dist_00_08;\n            blendResult[1] = ((dist_00_08 > dist_07_01) && (v[0] != v[7]) && (v[0] != v[1])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n        \n\n        if ( ((v[6] == v[7] && v[5] == v[0]) || (v[6] == v[5] && v[7] == v[0])) == false)\n        {\n            float dist_05_07 = DistYCbCr(src[18], src[ 6]) + DistYCbCr(src[ 6], src[22]) + DistYCbCr(src[ 4], src[ 0]) + DistYCbCr(src[ 0], src[ 8]) + (4.0 * DistYCbCr(src[ 5], src[ 7]));\n            float dist_06_00 = DistYCbCr(src[19], src[ 5]) + DistYCbCr(src[ 5], src[ 3]) + DistYCbCr(src[21], src[ 7]) + DistYCbCr(src[ 7], src[ 1]) + (4.0 * DistYCbCr(src[ 6], src[ 0]));\n            bool dominantGradient = (DOMINANT_DIRECTION_THRESHOLD * dist_05_07) < dist_06_00;\n            blendResult[0] = ((dist_05_07 < dist_06_00) && (v[0] != v[5]) && (v[0] != v[7])) ? ((dominantGradient) ? BLEND_DOMINANT : BLEND_NORMAL) : BLEND_NONE;\n        }\n        \n        vec3 dst[36];\n        dst[ 0] = src[0];\n        dst[ 1] = src[0];\n        dst[ 2] = src[0];\n        dst[ 3] = src[0];\n        dst[ 4] = src[0];\n        dst[ 5] = src[0];\n        dst[ 6] = src[0];\n        dst[ 7] = src[0];\n        dst[ 8] = src[0];\n        dst[ 9] = src[0];\n        dst[10] = src[0];\n        dst[11] = src[0];\n        dst[12] = src[0];\n        dst[13] = src[0];\n        dst[14] = src[0];\n        dst[15] = src[0];\n        dst[16] = src[0];\n        dst[17] = src[0];\n        dst[18] = src[0];\n        dst[19] = src[0];\n        dst[20] = src[0];\n        dst[21] = src[0];\n        dst[22] = src[0];\n        dst[23] = src[0];\n        dst[24] = src[0];\n        dst[25] = src[0];\n        dst[26] = src[0];\n        dst[27] = src[0];\n        dst[28] = src[0];\n        dst[29] = src[0];\n        dst[30] = src[0];\n        dst[31] = src[0];\n        dst[32] = src[0];\n        dst[33] = src[0];\n        dst[34] = src[0];\n        dst[35] = src[0];\n        \n        // Scale pixel\n        if (IsBlendingNeeded(blendResult) == true)\n        {\n            float dist_01_04 = DistYCbCr(src[1], src[4]);\n            float dist_03_08 = DistYCbCr(src[3], src[8]);\n            bool haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[4]) && (v[5] != v[4]);\n            bool haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[8]) && (v[7] != v[8]);\n            bool needBlend = (blendResult[2] != BLEND_NONE);\n            bool doLineBlend = (  blendResult[2] >= BLEND_DOMINANT ||\n                                ((blendResult[1] != BLEND_NONE && !IsPixEqual(src[0], src[4])) ||\n                                    (blendResult[3] != BLEND_NONE && !IsPixEqual(src[0], src[8])) ||\n                                    (IsPixEqual(src[4], src[3]) && IsPixEqual(src[3], src[2]) && IsPixEqual(src[2], src[1]) && IsPixEqual(src[1], src[8]) && IsPixEqual(src[0], src[2]) == false) ) == false );\n            \n            vec3 blendPix = ( DistYCbCr(src[0], src[1]) <= DistYCbCr(src[0], src[3]) ) ? src[1] : src[3];\n            dst[10] = mix(dst[10], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[11] = mix(dst[11], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 0.750 : ((haveShallowLine) ? 0.250 : 0.000)) : 0.000);\n            dst[12] = mix(dst[12], blendPix, (needBlend && doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.500 : 1.000) : 0.000);\n            dst[13] = mix(dst[13], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 0.750 : ((haveSteepLine) ? 0.250 : 0.000)) : 0.000);\n            dst[14] = mix(dst[14], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[25] = mix(dst[25], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[26] = mix(dst[26], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[27] = mix(dst[27], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 1.000 : 0.000);\n            dst[28] = mix(dst[28], blendPix, (needBlend) ? ((doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[29] = mix(dst[29], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[30] = mix(dst[30], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.9711013910) : 0.000);\n            dst[31] = mix(dst[31], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[32] = mix(dst[32], blendPix, (needBlend) ? ((doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[33] = mix(dst[33], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 1.000 : 0.000);\n            dst[34] = mix(dst[34], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[35] = mix(dst[35], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            \n            dist_01_04 = DistYCbCr(src[7], src[2]);\n            dist_03_08 = DistYCbCr(src[1], src[6]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[2]) && (v[3] != v[2]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[6]) && (v[5] != v[6]);\n            needBlend = (blendResult[1] != BLEND_NONE);\n            doLineBlend = (  blendResult[1] >= BLEND_DOMINANT ||\n                            !((blendResult[0] != BLEND_NONE && !IsPixEqual(src[0], src[2])) ||\n                            (blendResult[2] != BLEND_NONE && !IsPixEqual(src[0], src[6])) ||\n                            (IsPixEqual(src[2], src[1]) && IsPixEqual(src[1], src[8]) && IsPixEqual(src[8], src[7]) && IsPixEqual(src[7], src[6]) && !IsPixEqual(src[0], src[8])) ) );\n        \n            dist_01_04 = DistYCbCr(src[7], src[2]);\n            dist_03_08 = DistYCbCr(src[1], src[6]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[2]) && (v[3] != v[2]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[6]) && (v[5] != v[6]);\n            needBlend = (blendResult[1] != BLEND_NONE);\n            doLineBlend = (  blendResult[1] >= BLEND_DOMINANT ||\n                            !((blendResult[0] != BLEND_NONE && !IsPixEqual(src[0], src[2])) ||\n                            (blendResult[2] != BLEND_NONE && !IsPixEqual(src[0], src[6])) ||\n                            (IsPixEqual(src[2], src[1]) && IsPixEqual(src[1], src[8]) && IsPixEqual(src[8], src[7]) && IsPixEqual(src[7], src[6]) && !IsPixEqual(src[0], src[8])) ) );\n            \n            blendPix = ( DistYCbCr(src[0], src[7]) <= DistYCbCr(src[0], src[1]) ) ? src[7] : src[1];\n            dst[ 7] = mix(dst[ 7], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[ 8] = mix(dst[ 8], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 0.750 : ((haveShallowLine) ? 0.250 : 0.000)) : 0.000);\n            dst[ 9] = mix(dst[ 9], blendPix, (needBlend && doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.500 : 1.000) : 0.000);\n            dst[10] = mix(dst[10], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 0.750 : ((haveSteepLine) ? 0.250 : 0.000)) : 0.000);\n            dst[11] = mix(dst[11], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[20] = mix(dst[20], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[21] = mix(dst[21], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[22] = mix(dst[22], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 1.000 : 0.000);\n            dst[23] = mix(dst[23], blendPix, (needBlend) ? ((doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[24] = mix(dst[24], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[25] = mix(dst[25], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.9711013910) : 0.000);\n            dst[26] = mix(dst[26], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[27] = mix(dst[27], blendPix, (needBlend) ? ((doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[28] = mix(dst[28], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 1.000 : 0.000);\n            dst[29] = mix(dst[29], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[30] = mix(dst[30], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n\n            dist_01_04 = DistYCbCr(src[5], src[8]);\n            dist_03_08 = DistYCbCr(src[7], src[4]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[8]) && (v[1] != v[8]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[4]) && (v[3] != v[4]);\n            needBlend = (blendResult[0] != BLEND_NONE);\n            doLineBlend = (  blendResult[0] >= BLEND_DOMINANT ||\n                            !((blendResult[3] != BLEND_NONE && !IsPixEqual(src[0], src[8])) ||\n                            (blendResult[1] != BLEND_NONE && !IsPixEqual(src[0], src[4])) ||\n                            (IsPixEqual(src[8], src[7]) && IsPixEqual(src[7], src[6]) && IsPixEqual(src[6], src[5]) && IsPixEqual(src[5], src[4]) && !IsPixEqual(src[0], src[6])) ) );\n            \n            blendPix = ( DistYCbCr(src[0], src[5]) <= DistYCbCr(src[0], src[7]) ) ? src[5] : src[7];\n            dst[ 4] = mix(dst[ 4], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[ 5] = mix(dst[ 5], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 0.750 : ((haveShallowLine) ? 0.250 : 0.000)) : 0.000);\n            dst[ 6] = mix(dst[ 6], blendPix, (needBlend && doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.500 : 1.000) : 0.000);\n            dst[ 7] = mix(dst[ 7], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 0.750 : ((haveSteepLine) ? 0.250 : 0.000)) : 0.000);\n            dst[ 8] = mix(dst[ 8], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[35] = mix(dst[35], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[16] = mix(dst[16], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[17] = mix(dst[17], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 1.000 : 0.000);\n            dst[18] = mix(dst[18], blendPix, (needBlend) ? ((doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[19] = mix(dst[19], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[20] = mix(dst[20], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.9711013910) : 0.000);\n            dst[21] = mix(dst[21], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[22] = mix(dst[22], blendPix, (needBlend) ? ((doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[23] = mix(dst[23], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 1.000 : 0.000);\n            dst[24] = mix(dst[24], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[25] = mix(dst[25], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            \n            \n            dist_01_04 = DistYCbCr(src[3], src[6]);\n            dist_03_08 = DistYCbCr(src[5], src[2]);\n            haveShallowLine = (STEEP_DIRECTION_THRESHOLD * dist_01_04 <= dist_03_08) && (v[0] != v[6]) && (v[7] != v[6]);\n            haveSteepLine   = (STEEP_DIRECTION_THRESHOLD * dist_03_08 <= dist_01_04) && (v[0] != v[2]) && (v[1] != v[2]);\n            needBlend = (blendResult[3] != BLEND_NONE);\n            doLineBlend = (  blendResult[3] >= BLEND_DOMINANT ||\n                            !((blendResult[2] != BLEND_NONE && !IsPixEqual(src[0], src[6])) ||\n                            (blendResult[0] != BLEND_NONE && !IsPixEqual(src[0], src[2])) ||\n                            (IsPixEqual(src[6], src[5]) && IsPixEqual(src[5], src[4]) && IsPixEqual(src[4], src[3]) && IsPixEqual(src[3], src[2]) && !IsPixEqual(src[0], src[4])) ) );\n            \n            blendPix = ( DistYCbCr(src[0], src[3]) <= DistYCbCr(src[0], src[5]) ) ? src[3] : src[5];\n            dst[13] = mix(dst[13], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[14] = mix(dst[14], blendPix, (needBlend && doLineBlend) ? ((haveSteepLine) ? 0.750 : ((haveShallowLine) ? 0.250 : 0.000)) : 0.000);\n            dst[15] = mix(dst[15], blendPix, (needBlend && doLineBlend) ? ((!haveShallowLine && !haveSteepLine) ? 0.500 : 1.000) : 0.000);\n            dst[ 4] = mix(dst[ 4], blendPix, (needBlend && doLineBlend) ? ((haveShallowLine) ? 0.750 : ((haveSteepLine) ? 0.250 : 0.000)) : 0.000);\n            dst[ 5] = mix(dst[ 5], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            dst[30] = mix(dst[30], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.250 : 0.000);\n            dst[31] = mix(dst[31], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 0.750 : 0.000);\n            dst[32] = mix(dst[32], blendPix, (needBlend && doLineBlend && haveSteepLine) ? 1.000 : 0.000);\n            dst[33] = mix(dst[33], blendPix, (needBlend) ? ((doLineBlend) ? ((haveSteepLine) ? 1.000 : ((haveShallowLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[34] = mix(dst[34], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[35] = mix(dst[35], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.9711013910) : 0.000);\n            dst[16] = mix(dst[16], blendPix, (needBlend) ? ((doLineBlend) ? 1.000 : 0.4236372243) : 0.000);\n            dst[17] = mix(dst[17], blendPix, (needBlend) ? ((doLineBlend) ? ((haveShallowLine) ? 1.000 : ((haveSteepLine) ? 0.750 : 0.500)) : 0.05652034508) : 0.000);\n            dst[18] = mix(dst[18], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 1.000 : 0.000);\n            dst[19] = mix(dst[19], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.750 : 0.000);\n            dst[20] = mix(dst[20], blendPix, (needBlend && doLineBlend && haveShallowLine) ? 0.250 : 0.000);\n            \n        }\n        \n            vec3 res = mix( mix( mix( mix( mix( mix(dst[20], dst[21], step(one_sixth, f.x) ), dst[22], step(two_sixth, f.x) ), mix( mix(dst[23], dst[24], step(four_sixth, f.x) ), dst[25], step(five_sixth, f.x) ), step(0.50, f.x) ),\n                                            mix( mix( mix(dst[19], dst[ 6], step(one_sixth, f.x) ), dst[ 7], step(two_sixth, f.x) ), mix( mix(dst[ 8], dst[ 9], step(four_sixth, f.x) ), dst[26], step(five_sixth, f.x) ), step(0.50, f.x) ), step(one_sixth, f.y) ),\n                                            mix( mix( mix(dst[18], dst[ 5], step(one_sixth, f.x) ), dst[ 0], step(two_sixth, f.x) ), mix( mix(dst[ 1], dst[10], step(four_sixth, f.x) ), dst[27], step(five_sixth, f.x) ), step(0.50, f.x) ), step(two_sixth, f.y) ),\n                                mix( mix( mix( mix( mix(dst[17], dst[ 4], step(one_sixth, f.x) ), dst[ 3], step(two_sixth, f.x) ), mix( mix(dst[ 2], dst[11], step(four_sixth, f.x) ), dst[28], step(five_sixth, f.x) ), step(0.50, f.x) ),\n                                            mix( mix( mix(dst[16], dst[15], step(one_sixth, f.x) ), dst[14], step(two_sixth, f.x) ), mix( mix(dst[13], dst[12], step(four_sixth, f.x) ), dst[29], step(five_sixth, f.x) ), step(0.50, f.x) ), step(four_sixth, f.y) ),\n                                            mix( mix( mix(dst[35], dst[34], step(one_sixth, f.x) ), dst[33], step(two_sixth, f.x) ), mix( mix(dst[32], dst[31], step(four_sixth, f.x) ), dst[30], step(five_sixth, f.x) ), step(0.50, f.x) ), step(five_sixth, f.y) ),\n                                step(0.50, f.y) );\n                                    \n    FragColor = vec4(res, 1.0);\n} \n#endif\n","crt-easymode.glsl":"#if defined(VERTEX)\n\n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING out\n    #define COMPAT_ATTRIBUTE in\n    #define COMPAT_TEXTURE texture\n    #else\n    #define COMPAT_VARYING varying\n    #define COMPAT_ATTRIBUTE attribute\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _oPosition1;\n    vec4 _r0005;\n    COMPAT_ATTRIBUTE vec4 VertexCoord;\n    COMPAT_ATTRIBUTE vec4 TexCoord;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform mat4 MVPMatrix;\n    uniform int FrameDirection;\n    uniform int FrameCount;\n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _oTex;\n    _r0005 = VertexCoord.x*MVPMatrix[0];\n    _r0005 = _r0005 + VertexCoord.y*MVPMatrix[1];\n    _r0005 = _r0005 + VertexCoord.z*MVPMatrix[2];\n    _r0005 = _r0005 + VertexCoord.w*MVPMatrix[3];\n    _oPosition1 = _r0005;\n    _oTex = TexCoord.xy;\n    gl_Position = _r0005;\n    TEX0.xy = TexCoord.xy;\n    }\n    #elif defined(FRAGMENT)\n    \n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING in\n    #define COMPAT_TEXTURE texture\n    out vec4 FragColor;\n    #else\n    #define COMPAT_VARYING varying\n    #define FragColor gl_FragColor\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _ret_0;\n    float _TMP30;\n    float _TMP29;\n    float _TMP28;\n    float _TMP13;\n    float _TMP32;\n    float _TMP11;\n    float _TMP10;\n    float _TMP31;\n    float _TMP9;\n    float _TMP8;\n    float _TMP15;\n    float _TMP14;\n    float _TMP33;\n    vec4 _TMP34;\n    vec4 _TMP27;\n    vec4 _TMP25;\n    vec4 _TMP23;\n    vec4 _TMP21;\n    vec4 _TMP26;\n    vec4 _TMP24;\n    vec4 _TMP22;\n    vec4 _TMP20;\n    float _TMP4;\n    vec4 _TMP3;\n    vec4 _TMP2;\n    float _TMP19;\n    float _TMP18;\n    float _TMP17;\n    float _TMP16;\n    vec4 _TMP1;\n    vec2 _TMP0;\n    uniform sampler2D Texture;\n    input_dummy _IN1;\n    float _TMP43;\n    float _x_step0044;\n    float _curve0044;\n    float _a0048;\n    float _val0052;\n    float _a0052;\n    vec4 _TMP57;\n    vec4 _x0072;\n    vec2 _c0086;\n    vec4 _x0088;\n    vec4 _x0094;\n    vec2 _c0098;\n    vec4 _x0100;\n    vec2 _c0104;\n    vec4 _x0106;\n    vec4 _sample_min0110;\n    vec4 _sample_max0110;\n    vec4 _r0112;\n    vec4 _TMP117;\n    vec2 _co0124;\n    vec2 _c0126;\n    vec4 _x0128;\n    vec4 _x0134;\n    vec2 _c0138;\n    vec4 _x0140;\n    vec2 _c0144;\n    vec4 _x0146;\n    vec4 _sample_min0150;\n    vec4 _sample_max0150;\n    vec4 _r0152;\n    vec4 _TMP157;\n    float _TMP163;\n    float _x_step0164;\n    float _curve0164;\n    float _a0168;\n    float _val0172;\n    float _a0172;\n    float _TMP183;\n    float _TMP189;\n    float _x0190;\n    float _a0196;\n    float _x0198;\n    vec2 _x0200;\n    float _x0208;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _dx1;\n    vec2 _dy;\n    vec2 _pix_co;\n    vec2 _tex_co;\n    vec2 _dist;\n    vec3 _col2;\n    vec3 _col21;\n    vec4 _coeffs1;\n    float _luma;\n    float _bright;\n    float _scan_weight;\n    vec2 _mod_fac;\n    int _dot_no;\n    vec3 _mask_weight;\n    vec3 _TMP37;\n    _dx1 = vec2(1.00000000E+00/TextureSize.x, 0.00000000E+00);\n    _dy = vec2(0.00000000E+00, 1.00000000E+00/TextureSize.y);\n    _pix_co = TEX0.xy*TextureSize - vec2( 5.00000000E-01, 5.00000000E-01);\n    _TMP0 = floor(_pix_co);\n    _tex_co = (_TMP0 + vec2( 5.00000000E-01, 5.00000000E-01))/TextureSize;\n    _dist = fract(_pix_co);\n    _x_step0044 = float((_dist.x >= 5.00000000E-01));\n    _a0048 = 2.50000000E-01 - (_dist.x - _x_step0044)*(_dist.x - _x_step0044);\n    _TMP33 = inversesqrt(_a0048);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0052 = 5.00000000E-01 - _dist.x;\n    _val0052 = float((_a0052 > 0.00000000E+00));\n    _TMP15 = _val0052 - float((_a0052 < 0.00000000E+00));\n    _curve0044 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP43 = _dist.x + 2.50000000E-01*(_curve0044 - _dist.x);\n    _coeffs1 = 3.14159274E+00*vec4(1.00000000E+00 + _TMP43, _TMP43, 1.00000000E+00 - _TMP43, 2.00000000E+00 - _TMP43);\n    _TMP1 = abs(_coeffs1);\n    _TMP57 = max(_TMP1, vec4( 9.99999975E-06, 9.99999975E-06, 9.99999975E-06, 9.99999975E-06));\n    _TMP16 = sin(_TMP57.x);\n    _TMP17 = sin(_TMP57.y);\n    _TMP18 = sin(_TMP57.z);\n    _TMP19 = sin(_TMP57.w);\n    _TMP2 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _x0072 = _TMP57/2.00000000E+00;\n    _TMP16 = sin(_x0072.x);\n    _TMP17 = sin(_x0072.y);\n    _TMP18 = sin(_x0072.z);\n    _TMP19 = sin(_x0072.w);\n    _TMP3 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _coeffs1 = ((2.00000000E+00*_TMP2)*_TMP3)/(_TMP57*_TMP57);\n    _TMP4 = dot(_coeffs1, vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _coeffs1 = _coeffs1/_TMP4;\n    _c0086 = _tex_co - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0086);\n    _x0088 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0088;\n    _TMP22 = COMPAT_TEXTURE(Texture, _tex_co);\n    _x0094 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0094;\n    _c0098 = _tex_co + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0098);\n    _x0100 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0100;\n    _c0104 = _tex_co + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0104);\n    _x0106 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0106;\n    _r0112 = _coeffs1.x*_TMP21;\n    _r0112 = _r0112 + _coeffs1.y*_TMP23;\n    _r0112 = _r0112 + _coeffs1.z*_TMP25;\n    _r0112 = _r0112 + _coeffs1.w*_TMP27;\n    _sample_min0110 = min(_TMP23, _TMP25);\n    _sample_max0110 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0110, _r0112);\n    _TMP117 = max(_sample_min0110, _TMP34);\n    _co0124 = _tex_co + _dy;\n    _c0126 = _co0124 - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0126);\n    _x0128 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0128;\n    _TMP22 = COMPAT_TEXTURE(Texture, _co0124);\n    _x0134 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0134;\n    _c0138 = _co0124 + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0138);\n    _x0140 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0140;\n    _c0144 = _co0124 + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0144);\n    _x0146 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0146;\n    _r0152 = _coeffs1.x*_TMP21;\n    _r0152 = _r0152 + _coeffs1.y*_TMP23;\n    _r0152 = _r0152 + _coeffs1.z*_TMP25;\n    _r0152 = _r0152 + _coeffs1.w*_TMP27;\n    _sample_min0150 = min(_TMP23, _TMP25);\n    _sample_max0150 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0150, _r0152);\n    _TMP157 = max(_sample_min0150, _TMP34);\n    _x_step0164 = float((_dist.y >= 5.00000000E-01));\n    _a0168 = 2.50000000E-01 - (_dist.y - _x_step0164)*(_dist.y - _x_step0164);\n    _TMP33 = inversesqrt(_a0168);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0172 = 5.00000000E-01 - _dist.y;\n    _val0172 = float((_a0172 > 0.00000000E+00));\n    _TMP15 = _val0172 - float((_a0172 < 0.00000000E+00));\n    _curve0164 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP163 = _dist.y + (_curve0164 - _dist.y);\n    _col2 = _TMP117.xyz + _TMP163*(_TMP157.xyz - _TMP117.xyz);\n    _luma = dot(vec3( 2.12599993E-01, 7.15200007E-01, 7.22000003E-02), _col2);\n    _TMP8 = max(_col2.y, _col2.z);\n    _TMP9 = max(_col2.x, _TMP8);\n    _bright = (_TMP9 + _luma)/2.00000000E+00;\n    _TMP31 = min(6.49999976E-01, _bright);\n    _TMP183 = max(3.49999994E-01, _TMP31);\n    _x0190 = _bright*1.50000000E+00;\n    _TMP31 = min(1.50000000E+00, _x0190);\n    _TMP189 = max(1.50000000E+00, _TMP31);\n    _a0196 = TEX0.y*2.00000000E+00*3.14159274E+00*TextureSize.y;\n    _TMP10 = cos(_a0196);\n    _x0198 = _TMP10*5.00000000E-01 + 5.00000000E-01;\n    _TMP11 = pow(_x0198, _TMP189);\n    _scan_weight = 1.00000000E+00 - _TMP11;\n    _x0200 = (TEX0.xy*OutputSize*TextureSize)/InputSize;\n    _mod_fac = floor(_x0200);\n    _x0208 = _mod_fac.x/3.00000000E+00;\n    _TMP32 = floor(_x0208);\n    _TMP13 = _mod_fac.x - 3.00000000E+00*_TMP32;\n    _dot_no = int(_TMP13);\n    if (_dot_no == 0) {\n    _mask_weight = vec3( 1.00000000E+00, 6.99999988E-01, 6.99999988E-01);\n    } else {\n    if (_dot_no == 1) {\n    _mask_weight = vec3( 6.99999988E-01, 1.00000000E+00, 6.99999988E-01);\n    } else {\n    _mask_weight = vec3( 6.99999988E-01, 6.99999988E-01, 1.00000000E+00);\n    }\n    }\n    if (InputSize.y >= 4.00000000E+02) {\n    _scan_weight = 1.00000000E+00;\n    }\n    _col21 = _col2.xyz;\n    _col2 = _col2*vec3(_scan_weight, _scan_weight, _scan_weight);\n    _col2 = _col2 + _TMP183*(_col21 - _col2);\n    _col2 = _col2*_mask_weight;\n    _TMP28 = pow(_col2.x, 5.55555582E-01);\n    _TMP29 = pow(_col2.y, 5.55555582E-01);\n    _TMP30 = pow(_col2.z, 5.55555582E-01);\n    _col2 = vec3(_TMP28, _TMP29, _TMP30);\n    _TMP37 = _col2*1.20000005E+00;\n    _ret_0 = vec4(_TMP37.x, _TMP37.y, _TMP37.z, 1.00000000E+00);\n    FragColor = _ret_0;\n    return;\n    }\n    #endif\n","crt-aperture.glsl":'\n/*\nCRT Shader by EasyMode\nLicense: GPL\n*/\n/*\n#pragma parameter SHARPNESS_IMAGE "Sharpness Image" 1.0 1.0 5.0 1.0\n#pragma parameter SHARPNESS_EDGES "Sharpness Edges" 3.0 1.0 5.0 1.0\n#pragma parameter GLOW_WIDTH "Glow Width" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HEIGHT "Glow Height" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HALATION "Glow Halation" 0.1 0.0 1.0 0.01\n#pragma parameter GLOW_DIFFUSION "Glow Diffusion" 0.05 0.0 1.0 0.01\n#pragma parameter MASK_COLORS "Mask Colors" 2.0 2.0 3.0 1.0\n#pragma parameter MASK_STRENGTH "Mask Strength" 0.3 0.0 1.0 0.05\n#pragma parameter MASK_SIZE "Mask Size" 1.0 1.0 9.0 1.0\n#pragma parameter SCANLINE_SIZE_MIN "Scanline Size Min." 0.5 0.5 1.5 0.05\n#pragma parameter SCANLINE_SIZE_MAX "Scanline Size Max." 1.5 0.5 1.5 0.05\n#pragma parameter GAMMA_INPUT "Gamma Input" 2.4 1.0 5.0 0.1\n#pragma parameter GAMMA_OUTPUT "Gamma Output" 2.4 1.0 5.0 0.1\n#pragma parameter BRIGHTNESS "Brightness" 1.5 0.0 2.0 0.05\n* */\n\n#define Coord TEX0\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define OUT out\n#define IN  in\n#define tex2D texture\n#else\n#define OUT varying \n#define IN attribute \n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nIN  vec4 VertexCoord;\nIN  vec4 Color;\nIN  vec2 TexCoord;\nOUT vec4 color;\nOUT vec2 Coord;\n\nuniform mat4 MVPMatrix;\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\ncolor = Color;\nCoord = TexCoord;\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define IN in\n#define tex2D texture\nout vec4 FragColor;\n#else\n#define IN varying\n#define FragColor gl_FragColor\n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nIN vec2 Coord;\n\n#ifdef PARAMETER_UNIFORM\nuniform PRECISION float SHARPNESS_IMAGE;\nuniform PRECISION float SHARPNESS_EDGES;\nuniform PRECISION float GLOW_WIDTH;\nuniform PRECISION float GLOW_HEIGHT;\nuniform PRECISION float GLOW_HALATION;\nuniform PRECISION float GLOW_DIFFUSION;\nuniform PRECISION float MASK_COLORS;\nuniform PRECISION float MASK_STRENGTH;\nuniform PRECISION float MASK_SIZE;\nuniform PRECISION float SCANLINE_SIZE_MIN;\nuniform PRECISION float SCANLINE_SIZE_MAX;\nuniform PRECISION float GAMMA_INPUT;\nuniform PRECISION float GAMMA_OUTPUT;\nuniform PRECISION float BRIGHTNESS;\n#else\n#define SHARPNESS_IMAGE 1.0\n#define SHARPNESS_EDGES 3.0\n#define GLOW_WIDTH 0.5\n#define GLOW_HEIGHT 0.5\n#define GLOW_HALATION 0.1\n#define GLOW_DIFFUSION 0.05\n#define MASK_COLORS 2.0\n#define MASK_STRENGTH 0.3\n#define MASK_SIZE 1.0\n#define SCANLINE_SIZE_MIN 0.5\n#define SCANLINE_SIZE_MAX 1.5\n#define GAMMA_INPUT 2.4\n#define GAMMA_OUTPUT 2.4\n#define BRIGHTNESS 1.5\n#endif\n\n#define FIX(c) max(abs(c), 1e-5)\n#define PI 3.141592653589\n#define saturate(c) clamp(c, 0.0, 1.0)\n#define TEX2D(c) pow(tex2D(tex, c).rgb, vec3(GAMMA_INPUT))\n\nmat3 get_color_matrix(sampler2D tex, vec2 co, vec2 dx)\n{\nreturn mat3(TEX2D(co - dx), TEX2D(co), TEX2D(co + dx));\n}\n\nvec3 blur(mat3 m, float dist, float rad)\n{\nvec3 x = vec3(dist - 1.0, dist, dist + 1.0) / rad;\nvec3 w = exp2(x * x * -1.0);\n\nreturn (m[0] * w.x + m[1] * w.y + m[2] * w.z) / (w.x + w.y + w.z);\n}\n\nvec3 filter_gaussian(sampler2D tex, vec2 co, vec2 tex_size)\n{\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / tex_size.y);\nvec2 pix_co = co * tex_size;\nvec2 tex_co = (floor(pix_co) + 0.5) / tex_size;\nvec2 dist = (fract(pix_co) - 0.5) * -1.0;\n\nmat3 line0 = get_color_matrix(tex, tex_co - dy, dx);\nmat3 line1 = get_color_matrix(tex, tex_co, dx);\nmat3 line2 = get_color_matrix(tex, tex_co + dy, dx);\nmat3 column = mat3(blur(line0, dist.x, GLOW_WIDTH),\n                       blur(line1, dist.x, GLOW_WIDTH),\n                       blur(line2, dist.x, GLOW_WIDTH));\n\nreturn blur(column, dist.y, GLOW_HEIGHT);\n}\n\nvec3 filter_lanczos(sampler2D tex, vec2 co, vec2 tex_size, float sharp)\n{\ntex_size.x *= sharp;\n\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 pix_co = co * tex_size - vec2(0.5, 0.0);\nvec2 tex_co = (floor(pix_co) + vec2(0.5, 0.0)) / tex_size;\nvec2 dist = fract(pix_co);\nvec4 coef = PI * vec4(dist.x + 1.0, dist.x, dist.x - 1.0, dist.x - 2.0);\n\ncoef = FIX(coef);\ncoef = 2.0 * sin(coef) * sin(coef / 2.0) / (coef * coef);\ncoef /= dot(coef, vec4(1.0));\n\nvec4 col1 = vec4(TEX2D(tex_co), 1.0);\nvec4 col2 = vec4(TEX2D(tex_co + dx), 1.0);\n\nreturn (mat4(col1, col1, col2, col2) * coef).rgb;\n}\n\nvec3 get_scanline_weight(float x, vec3 col)\n{\nvec3 beam = mix(vec3(SCANLINE_SIZE_MIN), vec3(SCANLINE_SIZE_MAX), col);\nvec3 x_mul = 2.0 / beam;\nvec3 x_offset = x_mul * 0.5;\n\nreturn smoothstep(0.0, 1.0, 1.0 - abs(x * x_mul - x_offset)) * x_offset;\n}\n\nvec3 get_mask_weight(float x)\n{\nfloat i = mod(floor(x * OutputSize.x * TextureSize.x / (InputSize.x * MASK_SIZE)), MASK_COLORS);\n\nif (i == 0.0) return mix(vec3(1.0, 0.0, 1.0), vec3(1.0, 0.0, 0.0), MASK_COLORS - 2.0);\nelse if (i == 1.0) return vec3(0.0, 1.0, 0.0);\nelse return vec3(0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\nvec3 col_glow = filter_gaussian(Texture, Coord, TextureSize);\nvec3 col_soft = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_IMAGE);\nvec3 col_sharp = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_EDGES);\nvec3 col = sqrt(col_sharp * col_soft);\n\ncol *= get_scanline_weight(fract(Coord.y * TextureSize.y), col_soft);\ncol_glow = saturate(col_glow - col);\ncol += col_glow * col_glow * GLOW_HALATION;\ncol = mix(col, col * get_mask_weight(Coord.x) * MASK_COLORS, MASK_STRENGTH);\ncol += col_glow * GLOW_DIFFUSION;\ncol = pow(col * BRIGHTNESS, vec3(1.0 / GAMMA_OUTPUT));\n\nFragColor = vec4(col, 1.0);\n}\n\n#endif\n',"crt-geom.glsl":'\n/*\nCRT-interlaced\n\nCopyright (C) 2010-2012 cgwg, Themaister and DOLLS\n\nThis program is free software; you can redistribute it and/or modify it\nunder the terms of the GNU General Public License as published by the Free\nSoftware Foundation; either version 2 of the License, or (at your option)\nany later version.\n\n(cgwg gave their consent to have the original version of this shader\ndistributed under the GPL in this message:\n\nhttp://board.byuu.org/viewtopic.php?p=26075#p26075\n\n"Feel free to distribute my shaders under the GPL. After all, the\nbarrel distortion code was taken from the Curvature shader, which is\nunder the GPL."\n)\nThis shader variant is pre-configured with screen curvature\n*/\n/*\n#pragma parameter CRTgamma "CRTGeom Target Gamma" 2.4 0.1 5.0 0.1\n#pragma parameter monitorgamma "CRTGeom Monitor Gamma" 2.2 0.1 5.0 0.1\n#pragma parameter d "CRTGeom Distance" 1.6 0.1 3.0 0.1\n#pragma parameter CURVATURE "CRTGeom Curvature Toggle" 1.0 0.0 1.0 1.0\n#pragma parameter R "CRTGeom Curvature Radius" 2.0 0.1 10.0 0.1\n#pragma parameter cornersize "CRTGeom Corner Size" 0.03 0.001 1.0 0.005\n#pragma parameter cornersmooth "CRTGeom Corner Smoothness" 1000.0 80.0 2000.0 100.0\n#pragma parameter x_tilt "CRTGeom Horizontal Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter y_tilt "CRTGeom Vertical Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter overscan_x "CRTGeom Horiz. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter overscan_y "CRTGeom Vert. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter DOTMASK "CRTGeom Dot Mask Toggle" 0.3 0.0 0.3 0.3\n#pragma parameter SHARPER "CRTGeom Sharpness" 1.0 1.0 3.0 1.0\n#pragma parameter scanline_weight "CRTGeom Scanline Weight" 0.3 0.1 0.5 0.05\n*/\n\n#ifndef PARAMETER_UNIFORM\n#define CRTgamma 2.4\n#define monitorgamma 2.2\n#define d 1.6\n#define CURVATURE 1.0\n#define R 2.0\n#define cornersize 0.03\n#define cornersmooth 1000.0\n#define x_tilt 0.0\n#define y_tilt 0.0\n#define overscan_x 100.0\n#define overscan_y 100.0\n#define DOTMASK 0.3\n#define SHARPER 1.0\n#define scanline_weight 0.3\n#endif\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\n#define FIX(c) max(abs(c), 1e-5);\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = R*acos(a);\nreturn uv*r/sin(r/R);\n}\n\nvec2 fwtrans(vec2 uv)\n{\nfloat r = FIX(sqrt(dot(uv,uv)));\nuv *= sin(r/R)/r;\nfloat x = 1.0-cos(r/R);\nfloat D = d/R + x*cosangle.x*cosangle.y+dot(uv,sinangle);\nreturn d*(uv*cosangle-x*sinangle)/D;\n}\n\nvec3 maxscale()\n{\nvec2 c = bkwtrans(-R * sinangle / (1.0 + R/d*cosangle.x*cosangle.y));\nvec2 a = vec2(0.5,0.5)*aspect;\nvec2 lo = vec2(fwtrans(vec2(-a.x,c.y)).x, fwtrans(vec2(c.x,-a.y)).y)/aspect;\nvec2 hi = vec2(fwtrans(vec2(+a.x,c.y)).x, fwtrans(vec2(c.x,+a.y)).y)/aspect;\nreturn vec3((hi+lo)*aspect*0.5,max(hi.x-lo.x,hi.y-lo.y));\n}\n\nvoid main()\n{\n// START of parameters\n\n// gamma of simulated CRT\n//\tCRTgamma = 1.8;\n// gamma of display monitor (typically 2.2 is correct)\n//\tmonitorgamma = 2.2;\n// overscan (e.g. 1.02 for 2% overscan)\noverscan = vec2(1.00,1.00);\n// aspect ratio\naspect = vec2(1.0, 0.75);\n// lengths are measured in units of (approximately) the width\n// of the monitor simulated distance from viewer to monitor\n//\td = 2.0;\n// radius of curvature\n//\tR = 1.5;\n// tilt angle in radians\n// (behavior might be a bit wrong if both components are\n// nonzero)\nconst vec2 angle = vec2(0.0,0.0);\n// size of curved corners\n//\tcornersize = 0.03;\n// border smoothness parameter\n// decrease if borders are too aliased\n//\tcornersmooth = 1000.0;\n\n// END of parameters\n\nvec4 _oColor;\nvec2 _otexCoord;\ngl_Position = VertexCoord.x * MVPMatrix[0] + VertexCoord.y * MVPMatrix[1] + VertexCoord.z * MVPMatrix[2] + VertexCoord.w * MVPMatrix[3];\n_oPosition1 = gl_Position;\n_oColor = COLOR;\n_otexCoord = TexCoord.xy;\nCOL0 = COLOR;\nTEX0.xy = TexCoord.xy;\n\n// Precalculate a bunch of useful values we\'ll need in the fragment\n// shader.\nsinangle = sin(vec2(x_tilt, y_tilt)) + vec2(0.001);//sin(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\ncosangle = cos(vec2(x_tilt, y_tilt)) + vec2(0.001);//cos(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\nstretch = maxscale();\n\nilfac = vec2(1.0,clamp(floor(InputSize.y/200.0), 1.0, 2.0));\n\n// The size of one texel, in texture-coordinates.\nvec2 sharpTextureSize = vec2(SHARPER * TextureSize.x, TextureSize.y);\none = ilfac / sharpTextureSize;\n\n// Resulting X pixel-coordinate of the pixel we\'re drawing.\nmod_factor = TexCoord.x * TextureSize.x * OutputSize.x / InputSize.x;\n\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nstruct output_dummy {\nvec4 _color;\n};\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// Comment the next line to disable interpolation in linear gamma (and\n// gain speed).\n#define LINEAR_PROCESSING\n\n// Enable screen curvature.\n//        #define CURVATURE\n\n// Enable 3x oversampling of the beam profile\n#define OVERSAMPLE\n\n// Use the older, purely gaussian beam profile\n//#define USEGAUSSIAN\n\n// Macros.\n#define FIX(c) max(abs(c), 1e-5);\n#define PI 3.141592653589\n\n#ifdef LINEAR_PROCESSING\n#       define TEX2D(c) pow(COMPAT_TEXTURE(Texture, (c)), vec4(CRTgamma))\n#else\n#       define TEX2D(c) COMPAT_TEXTURE(Texture, (c))\n#endif\n\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = FIX(R*acos(a));\nreturn uv*r/sin(r/R);\n}\n\nvec2 transform(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord-vec2(0.5))*aspect*stretch.z+stretch.xy;\nreturn (bkwtrans(coord)/vec2(overscan_x / 100.0, overscan_y / 100.0)/aspect+vec2(0.5)) * InputSize / TextureSize;\n}\n\nfloat corner(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord - vec2(0.5)) * vec2(overscan_x / 100.0, overscan_y / 100.0) + vec2(0.5);\ncoord = min(coord, vec2(1.0)-coord) * aspect;\nvec2 cdist = vec2(cornersize);\ncoord = (cdist - min(coord,cdist));\nfloat dist = sqrt(dot(coord,coord));\nreturn clamp((cdist.x-dist)*cornersmooth,0.0, 1.0);\n}\n\n// Calculate the influence of a scanline on the current pixel.\n//\n// \'distance\' is the distance in texture coordinates from the current\n// pixel to the scanline in question.\n// \'color\' is the colour of the scanline at the horizontal location of\n// the current pixel.\nvec4 scanlineWeights(float distance, vec4 color)\n{\n// "wid" controls the width of the scanline beam, for each RGB\n// channel The "weights" lines basically specify the formula\n// that gives you the profile of the beam, i.e. the intensity as\n// a function of distance from the vertical center of the\n// scanline. In this case, it is gaussian if width=2, and\n// becomes nongaussian for larger widths. Ideally this should\n// be normalized so that the integral across the beam is\n// independent of its width. That is, for a narrower beam\n// "weights" should have a higher peak at the center of the\n// scanline than for a wider beam.\n#ifdef USEGAUSSIAN\nvec4 wid = 0.3 + 0.1 * pow(color, vec4(3.0));\nvec4 weights = vec4(distance / wid);\nreturn 0.4 * exp(-weights * weights) / wid;\n#else\nvec4 wid = 2.0 + 2.0 * pow(color, vec4(4.0));\nvec4 weights = vec4(distance / scanline_weight);\nreturn 1.4 * exp(-pow(weights * inversesqrt(0.5 * wid), wid)) / (0.6 + 0.2 * wid);\n#endif\n}\n\nvoid main()\n{\n// Here\'s a helpful diagram to keep in mind while trying to\n// understand the code:\n//\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  01  |  11  |  21  |  31  | <-- current scanline\n//  |      | @    |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  02  |  12  |  22  |  32  | <-- next scanline\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//\n// Each character-cell represents a pixel on the output\n// surface, "@" represents the current pixel (always somewhere\n// in the bottom half of the current scan-line, or the top-half\n// of the next scanline). The grid of lines represents the\n// edges of the texels of the underlying texture.\n\n// Texture coordinates of the texel containing the active pixel.\nvec2 xy = (CURVATURE > 0.5) ? transform(TEX0.xy) : TEX0.xy;\n\nfloat cval = corner(xy);\n\n// Of all the pixels that are mapped onto the texel we are\n// currently rendering, which pixel are we currently rendering?\nvec2 ilvec = vec2(0.0,ilfac.y > 1.5 ? mod(float(FrameCount),2.0) : 0.0);\nvec2 ratio_scale = (xy * TextureSize - vec2(0.5) + ilvec)/ilfac;\n#ifdef OVERSAMPLE\nfloat filter_ = InputSize.y/OutputSize.y;//fwidth(ratio_scale.y);\n#endif\nvec2 uv_ratio = fract(ratio_scale);\n\n// Snap to the center of the underlying texel.\nxy = (floor(ratio_scale)*ilfac + vec2(0.5) - ilvec) / TextureSize;\n\n// Calculate Lanczos scaling coefficients describing the effect\n// of various neighbour texels in a scanline on the current\n// pixel.\nvec4 coeffs = PI * vec4(1.0 + uv_ratio.x, uv_ratio.x, 1.0 - uv_ratio.x, 2.0 - uv_ratio.x);\n\n// Prevent division by zero.\ncoeffs = FIX(coeffs);\n\n// Lanczos2 kernel.\ncoeffs = 2.0 * sin(coeffs) * sin(coeffs / 2.0) / (coeffs * coeffs);\n\n// Normalize.\ncoeffs /= dot(coeffs, vec4(1.0));\n\n// Calculate the effective colour of the current and next\n// scanlines at the horizontal location of the current pixel,\n// using the Lanczos coefficients above.\nvec4 col  = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, 0.0)),\n                TEX2D(xy),\n                TEX2D(xy + vec2(one.x, 0.0)),\n                TEX2D(xy + vec2(2.0 * one.x, 0.0))) * coeffs,\n                0.0, 1.0);\nvec4 col2 = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, one.y)),\n                TEX2D(xy + vec2(0.0, one.y)),\n                TEX2D(xy + one),\n                TEX2D(xy + vec2(2.0 * one.x, one.y))) * coeffs,\n                0.0, 1.0);\n\n#ifndef LINEAR_PROCESSING\ncol  = pow(col , vec4(CRTgamma));\ncol2 = pow(col2, vec4(CRTgamma));\n#endif\n\n// Calculate the influence of the current and next scanlines on\n// the current pixel.\nvec4 weights  = scanlineWeights(uv_ratio.y, col);\nvec4 weights2 = scanlineWeights(1.0 - uv_ratio.y, col2);\n#ifdef OVERSAMPLE\nuv_ratio.y =uv_ratio.y+1.0/3.0*filter_;\nweights = (weights+scanlineWeights(uv_ratio.y, col))/3.0;\nweights2=(weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2))/3.0;\nuv_ratio.y =uv_ratio.y-2.0/3.0*filter_;\nweights=weights+scanlineWeights(abs(uv_ratio.y), col)/3.0;\nweights2=weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2)/3.0;\n#endif\n\nvec3 mul_res  = (col * weights + col2 * weights2).rgb * vec3(cval);\n\n// dot-mask emulation:\n// Output pixels are alternately tinted green and magenta.\nvec3 dotMaskWeights = mix(\nvec3(1.0, 1.0 - DOTMASK, 1.0),\nvec3(1.0 - DOTMASK, 1.0, 1.0 - DOTMASK),\nfloor(mod(mod_factor, 2.0))\n);\n\nmul_res *= dotMaskWeights;\n\n// Convert the image gamma for display on our output device.\nmul_res = pow(mul_res, vec3(1.0 / monitorgamma));\n\n// Color the texel.\noutput_dummy _OUT;\n_OUT._color = vec4(mul_res, 1.0);\nFragColor = _OUT._color;\nreturn;\n} \n#endif\n\n',"crt-mattias.glsl":'\n#pragma parameter CURVATURE "Curvature" 0.5 0.0 1.0 0.05\n#pragma parameter SCANSPEED "Scanline Crawl Speed" 1.0 0.0 10.0 0.5\n#if defined(VERTEX)\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\n    gl_Position = MVPMatrix * VertexCoord;\n    TEX0.xy = TexCoord.xy;\n}\n\n#elif defined(FRAGMENT)\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout COMPAT_PRECISION vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CURVATURE, SCANSPEED;\n#else\n#define CURVATURE 0.5\n#define SCANSPEED 1.0\n#endif\n\n#define iChannel0 Texture\n#define iTime (float(FrameCount) / 60.0)\n#define iResolution OutputSize.xy\n#define fragCoord gl_FragCoord.xy\n\nvec3 sample_( sampler2D tex, vec2 tc )\n{\n    vec3 s = pow(COMPAT_TEXTURE(tex,tc).rgb, vec3(2.2));\n    return s;\n}\n\nvec3 blur(sampler2D tex, vec2 tc, float offs)\n{\n    vec4 xoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) / (iResolution.x * TextureSize.x / InputSize.x);\n    vec4 yoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) / (iResolution.y * TextureSize.y / InputSize.y);\n    tc = tc * InputSize / TextureSize;\n    \n    vec3 color = vec3(0.0, 0.0, 0.0);\n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.x)) * 0.00366;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.x)) * 0.01465;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.x)) * 0.02564;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.x)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.x)) * 0.00366;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.y)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.y)) * 0.05861;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.y)) * 0.09524;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.y)) * 0.05861;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.y)) * 0.01465;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, 0.0)) * 0.02564;\n    color += sample_(tex,tc + vec2(xoffs.y, 0.0)) * 0.09524;\n    color += sample_(tex,tc + vec2(    0.0, 0.0)) * 0.15018;\n    color += sample_(tex,tc + vec2(xoffs.z, 0.0)) * 0.09524;\n    color += sample_(tex,tc + vec2(xoffs.w, 0.0)) * 0.02564;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.z)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.z)) * 0.05861;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.z)) * 0.09524;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.z)) * 0.05861;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.z)) * 0.01465;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.w)) * 0.00366;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.w)) * 0.01465;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.w)) * 0.02564;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.w)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.w)) * 0.00366;\n\n    return color;\n}\n\nfloat rand(vec2 co)\n{\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt= dot(co.xy ,vec2(a,b));\n    float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nvec2 curve(vec2 uv)\n{\n    uv = (uv - 0.5) * 2.0;\n    uv *= 1.1;\t\n    uv.x *= 1.0 + pow((abs(uv.y) / 5.0), 2.0);\n    uv.y *= 1.0 + pow((abs(uv.x) / 4.0), 2.0);\n    uv  = (uv / 2.0) + 0.5;\n    uv =  uv *0.92 + 0.04;\n    return uv;\n}\n\nvoid main()\n{\n    vec2 q = (vTexCoord.xy * TextureSize.xy / InputSize.xy);//fragCoord.xy / iResolution.xy;\n    vec2 uv = q;\n    uv = mix( uv, curve( uv ), CURVATURE ) * InputSize.xy / TextureSize.xy;\n    vec3 col;\n    float x =  sin(0.1*iTime+uv.y*21.0)*sin(0.23*iTime+uv.y*29.0)*sin(0.3+0.11*iTime+uv.y*31.0)*0.0017;\n    float o =2.0*mod(fragCoord.y,2.0)/iResolution.x;\n    x+=o;\n    uv = uv * TextureSize / InputSize;\n    col.r = 1.0*blur(iChannel0,vec2(uv.x+0.0009,uv.y+0.0009),1.2).x+0.005;\n    col.g = 1.0*blur(iChannel0,vec2(uv.x+0.000,uv.y-0.0015),1.2).y+0.005;\n    col.b = 1.0*blur(iChannel0,vec2(uv.x-0.0015,uv.y+0.000),1.2).z+0.005;\n    col.r += 0.2*blur(iChannel0,vec2(uv.x+0.0009,uv.y+0.0009),2.25).x-0.005;\n    col.g += 0.2*blur(iChannel0,vec2(uv.x+0.000,uv.y-0.0015),1.75).y-0.005;\n    col.b += 0.2*blur(iChannel0,vec2(uv.x-0.0015,uv.y+0.000),1.25).z-0.005;\n    float ghs = 0.05;\n    col.r += ghs*(1.0-0.299)*blur(iChannel0,0.75*vec2(0.01, -0.027)+vec2(uv.x+0.001,uv.y+0.001),7.0).x;\n    col.g += ghs*(1.0-0.587)*blur(iChannel0,0.75*vec2(-0.022, -0.02)+vec2(uv.x+0.000,uv.y-0.002),5.0).y;\n    col.b += ghs*(1.0-0.114)*blur(iChannel0,0.75*vec2(-0.02, -0.0)+vec2(uv.x-0.002,uv.y+0.000),3.0).z;\n    \n    \n\n    col = clamp(col*0.4+0.6*col*col*1.0,0.0,1.0);\n    float vig = (0.0 + 1.0*16.0*uv.x*uv.y*(1.0-uv.x)*(1.0-uv.y));\n    vig = pow(vig,0.3);\n    col *= vec3(vig);\n\n    col *= vec3(0.95,1.05,0.95);\n    col = mix( col, col * col, 0.3) * 3.8;\n\n    float scans = clamp( 0.35+0.15*sin(3.5*(iTime * SCANSPEED)+uv.y*iResolution.y*1.5), 0.0, 1.0);\n    \n    float s = pow(scans,0.9);\n    col = col*vec3( s) ;\n\n    col *= 1.0+0.0015*sin(300.0*iTime);\n    \n    col*=1.0-0.15*vec3(clamp((mod(fragCoord.x+o, 2.0)-1.0)*2.0,0.0,1.0));\n    col *= vec3( 1.0 ) - 0.25*vec3( rand( uv+0.0001*iTime),  rand( uv+0.0001*iTime + 0.3 ),  rand( uv+0.0001*iTime+ 0.5 )  );\n    col = pow(col, vec3(0.45));\n\n    if (uv.x < 0.0 || uv.x > 1.0)\n        col *= 0.0;\n    if (uv.y < 0.0 || uv.y > 1.0)\n        col *= 0.0;\n    \n\n    float comp = smoothstep( 0.1, 0.9, sin(iTime) );\n\n    FragColor = vec4(col,1.0);\n} \n#endif\n'},Te=s(57),K=s(11),J={addStyleHook:function(){V(this.elements.container,this.config.selectors.container.replace(".",""),!0),V(this.elements.container,this.config.classNames.uiSupported,!0),V(this.elements.container,this.config.classNames.hideControls,!0)},build:function(){this.listeners.media(),B.element(this.elements.controls)||(ne.inject.call(this),this.listeners.controls()),this.volume=null,this.muted=null,ne.updateVolume.call(this),V(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0},toggleControls:function(t){var i=this.elements.controls;if(i){let n=0,e=c.call(this,".".concat(Y({ejs__dialogs:!0})," > .").concat(Y({ejs__dialog:!0})));Array.from(e).forEach(function(e,t){!0!==e.hidden&&(n+=1)}),0<n?this.toggleControls(!1):this.toggleControls(Boolean(t||this.paused||i.pressed||i.hover))}}};function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if("object"===Se(e)&&e.files&&(e=e.files[0]),this.littleEndian=!1,this.offset=0,this._lastRead=null,"object"===Se(e)&&e.name&&e.size){if("function"!=typeof window.FileReader)throw new Error("Incompatible Browser");this.fileName=e.name,this.fileType=e.type,this.fileSize=e.size,this._fileReader=new FileReader,(this._fileReader.marcFile=this)._fileReader.addEventListener("load",function(){this.marcFile._u8array=new Uint8Array(this.result),this.marcFile._dataView=new DataView(this.result),t&&t.call()},!1),this._fileReader.readAsArrayBuffer(e)}else if("object"===Se(e)&&"string"==typeof e.fileName&&"boolean"==typeof e.littleEndian){this.fileName=e.fileName,this.fileType=e.fileType,this.fileSize=e.fileSize;new ArrayBuffer(e);this._u8array=new Uint8Array(this.fileType),this._dataView=new DataView(this.fileType),e.copyToFile(this,0),t&&t.call()}else if("object"===Se(e)&&"number"==typeof e.byteLength)this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e.byteLength,void 0!==e.buffer&&(e=e.buffer),this._u8array=new Uint8Array(e),this._dataView=new DataView(e),t&&t.call();else{if("number"!=typeof e)throw new Error("Invalid source");this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e,s=new ArrayBuffer(e),this._u8array=new Uint8Array(s),this._dataView=new DataView(s),t&&t.call()}}i.IS_MACHINE_LITTLE_ENDIAN=(ge=new ArrayBuffer(2),new DataView(ge).setInt16(0,256,!0),256===new Int16Array(ge)[0]),i.prototype.seek=function(e){this.offset=e},i.prototype.skip=function(e){this.offset+=e},i.prototype.isEOF=function(){return!(this.offset<this.fileSize)},i.prototype.slice=function(e,t){let n;return t=t||this.fileSize-e,void 0!==this._u8array.buffer.slice?((n=new i(0)).fileSize=t,n._u8array=new Uint8Array(this._u8array.buffer.slice(e,e+t))):(n=new i(t),this.copyToFile(n,e,t,0)),n.fileName=this.fileName,n.fileType=this.fileType,n.littleEndian=this.littleEndian,n},i.prototype.copyToFile=function(t,n,i,o){void 0===o&&(o=n),i=i||this.fileSize-n;for(let e=0;e<i;e++)t._u8array[o+e]=this._u8array[n+e]},i.prototype.save=function(){let n;try{n=new Blob([this._u8array],{type:this.fileType})}catch(e){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"InvalidStateError"!==e.name||!window.BlobBuilder)throw new Error("Incompatible Browser");let t=new BlobBuilder;t.append(this._u8array.buffer),n=t.getBlob(this.fileType)}saveAs(n,this.fileName)},i.prototype.readU8=function(){return this._lastRead=this._u8array[this.offset],this.offset++,this._lastRead},i.prototype.readU16=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8):this._lastRead=(this._u8array[this.offset]<<8)+this._u8array[this.offset+1],this.offset+=2,this._lastRead>>>0},i.prototype.readU24=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16):this._lastRead=(this._u8array[this.offset]<<16)+(this._u8array[this.offset+1]<<8)+this._u8array[this.offset+2],this.offset+=3,this._lastRead>>>0},i.prototype.readU32=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16)+(this._u8array[this.offset+3]<<24):this._lastRead=(this._u8array[this.offset]<<24)+(this._u8array[this.offset+1]<<16)+(this._u8array[this.offset+2]<<8)+this._u8array[this.offset+3],this.offset+=4,this._lastRead>>>0},i.prototype.readBytes=function(t){this._lastRead=new Array(t);for(let e=0;e<t;e++)this._lastRead[e]=this._u8array[this.offset+e];return this.offset+=t,this._lastRead},i.prototype.readString=function(t){this._lastRead="";for(let e=0;e<t&&this.offset+e<this.fileSize&&0<this._u8array[this.offset+e];e++)this._lastRead=this._lastRead+String.fromCharCode(this._u8array[this.offset+e]);return this.offset+=t,this._lastRead},i.prototype.writeU8=function(e){this._u8array[this.offset]=e,this.offset++},i.prototype.writeU16=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=e>>8):(this._u8array[this.offset]=e>>8,this._u8array[this.offset+1]=255&e),this.offset+=2},i.prototype.writeU24=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16):(this._u8array[this.offset]=(16711680&e)>>16,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=255&e),this.offset+=3},i.prototype.writeU32=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16,this._u8array[this.offset+3]=(4278190080&e)>>24):(this._u8array[this.offset]=(4278190080&e)>>24,this._u8array[this.offset+1]=(16711680&e)>>16,this._u8array[this.offset+2]=(65280&e)>>8,this._u8array[this.offset+3]=255&e),this.offset+=4},i.prototype.writeBytes=function(t){for(let e=0;e<t.length;e++)this._u8array[this.offset+e]=t[e];this.offset+=t.length},i.prototype.writeString=function(t,n){n=n||t.length;for(let e=0;e<t.length&&e<n;e++)this._u8array[this.offset+e]=t.charCodeAt(e);for(;s<n;s++)this._u8array[this.offset+s]=0;this.offset+=n};let Q=i,a=0;function l(){this.records=[],this.truncate=!1}function Ee(e){let t=new l;e.seek(5);for(var n,i;!e.isEOF();){if(4542278===(n=e.readU24())){if(e.isEOF())break;if(e.offset+3===e.fileSize){t.truncate=e.readU24();break}}(i=e.readU16())===a?t.addRLERecord(n,e.readU16(),e.readU8()):t.addSimpleRecord(n,e.readBytes(i))}return t}l.prototype.addSimpleRecord=function(e,t){this.records.push({offset:e,type:1,length:t.length,data:t})},l.prototype.addRLERecord=function(e,t,n){this.records.push({offset:e,type:a,length:t,byte:n})},l.prototype.toString=function(){nSimpleRecords=0;for(let e=nRLERecords=0;e<this.records.length;e++)this.records[e].type===a?nRLERecords++:nSimpleRecords++;let e="Simple records: "+nSimpleRecords;return e=(e+="\nRLE records: "+nRLERecords)+("\nTotal records: "+this.records.length),this.truncate&&(e+="\nTruncate at: 0x"+this.truncate.toString(16)),e},l.prototype.export=function(e){for(let e=5,t=0;t<this.records.length;t++)this.records[t].type===a?e+=8:e+=5+this.records[t].data.length;for(o+=3,this.truncate&&(o+=3),(tempFile=new Q(o)).fileName=e+".ips",tempFile.writeString("PATCH"),s=0;s<this.records.length;s++){var t=this.records[s];tempFile.writeU24(t.offset),t.type===a?(tempFile.writeU16(0),tempFile.writeU16(t.length),tempFile.writeU8(t.byte)):(tempFile.writeU16(t.data.length),tempFile.writeBytes(t.data))}return tempFile.writeString("EOF"),_0x512785.truncate&&tempFile.writeU24(_0x512785.truncate),tempFile},l.prototype.apply=function(n){let t;if(this.truncate)t=n.slice(0,this.truncate);else{for(let e=n.fileSize,t=0;t<this.records.length;t++){var i=this.records[t];i.type===a?i.offset+i.length>e&&(e=i.offset+i.length):i.offset+i.data.length>e&&(e=i.offset+i.data.length)}s===n.fileSize?t=n.slice(0,n.fileSize):(t=new Q(s),n.copyToFile(t,0))}for(n.seek(0),_0x5a0a71=0;_0x5a0a71<this.records.length;_0x5a0a71++)if(t.seek(this.records[_0x5a0a71].offset),this.records[_0x5a0a71].type===a)for(let e=0;e<this.records[_0x5a0a71].length;e++)t.writeU8(this.records[_0x5a0a71].byte);else t.writeBytes(this.records[_0x5a0a71].data);return t},"0123456789abcdef".split("");let Ce=function(){for(let t,e=[],n=0;n<256;n++){t=n;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return o}();function Z(o,a,s){for(let e=a?new Uint8Array(o._u8array.buffer,a):o._u8array,t=-1,n=s?e.length-4:e.length,i=0;i<n;i++)t=t>>>8^Ce[255&(t^e[i])];return(-1^_0x20e2c1)>>>0}let we=1,Pe=2,Me=3;function Oe(){this.sourceSize=0,this.targetSize=0,this.metaData="",this.actions=[],this.sourceChecksum=0,this.targetChecksum=0,this.patchChecksum=0}function Ie(n){n.readVLV=Ae,n.littleEndian=!0;let i=new Oe;n.seek(4),i.sourceSize=n.readVLV(),i.targetSize=n.readVLV();var e=n.readVLV();e&&(i.metaData=n.readString(e));for(var o,t=n.fileSize-12;n.offset<t;){let e=n.readVLV(),t={type:3&e,length:1+(e>>2)};t.type===we?t.bytes=n.readBytes(t.length):t.type!==Pe&&t.type!==Me||(o=n.readVLV(),t.relativeOffset=(1&o?-1:1)*(o>>1)),i.actions.push(t)}if(i.sourceChecksum=n.readU32(),i.targetChecksum=n.readU32(),i.patchChecksum=n.readU32(),i.patchChecksum!==Z(n,0,!0))throw new Error("error_crc_patch");return i}function Ae(){for(let e=0,t=1;;){var n=this.readU8();if(e+=(127&n)*t,128&n)break;e+=t<<=7}return this._lastRead=p}function Re(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),e--}}function Ne(t){for(let e=0;;){if(0==(t>>=7)){e++;break}e++,t--}return o}Oe.prototype.toString=function(){var e="Source size: "+this.sourceSize;return(e=(e+="\nTarget size: "+this.targetSize)+("\nMetadata: "+this.metaData))+("\n#Actions: "+this.actions.length)},Oe.prototype.validateSource=function(e,t){return this.sourceChecksum===Z(e,t)},Oe.prototype.apply=function(o,e){if(e&&!this.validateSource(o))throw new Error("error_crc_input");for(let t=new Q(this.targetSize),n=0,e=0,i=0;i<this.actions.length;i++){var a=this.actions[i];if(0===a.type)o.copyToFile(t,t.offset,a.length),t.skip(a.length);else if(a.type===we)t.writeBytes(a.bytes);else if(a.type===Pe){n+=a.relativeOffset;for(let e=a.length;e--;)t.writeU8(o._u8array[n]),n++}else if(a.type===Me)for(e+=a.relativeOffset,_0x5c2263=a.length;_0x5c2263--;)t.writeU8(t._u8array[e]),e++}if(e&&this.targetChecksum!==Z(s))throw new Error("error_crc_output");return s},Oe.prototype.export=function(e){let t="BPS1".length;t=(t=(t=(t+=Ne(this.sourceSize))+Ne(this.targetSize))+Ne(this.metaData.length))+this.metaData.length;for(let e=0;e<this.actions.length;e++)t+=Ne(((_0x38dad6=this.actions[e]).length-1<<2)+_0x38dad6.type),_0x38dad6.type===we?t+=_0x38dad6.length:_0x38dad6.type!==Pe&&_0x38dad6.type!==Me||(t+=Ne((Math.abs(_0x38dad6.relativeOffset)<<1)+(_0x38dad6.relativeOffset<0?1:0)));let n=new Q(t+=12);for(n.fileName=e+".bps",n.littleEndian=!0,n.writeVLV=Re,n.writeString("BPS1"),n.writeVLV(this.sourceSize),n.writeVLV(this.targetSize),n.writeVLV(this.metaData.length),n.writeString(this.metaData,this.metaData.length),s=0;s<this.actions.length;s++){var i=this.actions[s];n.writeVLV((i.length-1<<2)+i.type),i.type===we?n.writeBytes(i.bytes):i.type!==Pe&&i.type!==Me||n.writeVLV((Math.abs(i.relativeOffset)<<1)+(i.relativeOffset<0?1:0))}return n.writeU32(this.sourceChecksum),n.writeU32(this.targetChecksum),n.writeU32(this.patchChecksum),n};let Le="UPS1";function d(){this.records=[],this.sizeInput=0,this.sizeOutput=0,this.checksumInput=0,this.checksumOutput=0}function ze(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),--e}}function De(){for(let e=0,t=1;;){var n=this.readU8();if(-1==n)throw new Error("Can't read UPS VLV at 0x"+(this.offset-1).toString(16));if(e+=(127&n)*t,0!=(128&n))break;e+=t<<=7}return p}function ke(t){for(let e=0;e++,0!=(t>>=7);)--t;return o}function Be(t){let e=new d;for(t.readVLV=De,t.seek(Le.length),e.sizeInput=t.readVLV(),e.sizeOutput=t.readVLV();t.offset<t.fileSize-12;){t.readVLV();for(let e=[];t.readU8();)e.push(t._lastRead);e.addRecord(s,_0x3bca86)}return t.littleEndian=!0,e.checksumInput=t.readU32(),e.checksumOutput=t.readU32(),t.littleEndian=!1,e}d.prototype.addRecord=function(e,t){this.records.push({offset:e,XORdata:t})},d.prototype.toString=function(){var e="Records: "+(void 0).records.length;return(e=(e=(e+="\nInput file size: "+(void 0).sizeInput)+("\nOutput file size: "+(void 0).sizeOutput))+("\nInput file checksum: "+padZeroes((void 0).checksumInput,4)))+("\nOutput file checksum: "+padZeroes((void 0).checksumOutput,4))},d.prototype.export=function(e){let t=Le.length;t=(t+=ke(this.sizeInput))+ke(this.sizeOutput);for(let e=0;e<this.records.length;e++)t=(t+=ke(this.records[e].offset))+(this.records[e].XORdata.length+1);for(t+=12,(tempFile=new Q(t)).writeVLV=ze,tempFile.fileName=e+".ups",tempFile.writeString(Le),tempFile.writeVLV(this.sizeInput),tempFile.writeVLV(this.sizeOutput),s=0;s<this.records.length;s++)tempFile.writeVLV(this.records[s].offset),tempFile.writeBytes(this.records[s].XORdata),tempFile.writeU8(0);return tempFile.littleEndian=!0,tempFile.writeU32(this.checksumInput),tempFile.writeU32(this.checksumOutput),tempFile.writeU32(Z(tempFile,0,!0)),tempFile},d.prototype.validateSource=function(e,t){return Z(e,t)===this.checksumInput};var $={_FS:{createFolder:function(e,t,n,i){var o,a;$.FS&&("function"==typeof $.FS.mkdir&&window.PATH?(o=PATH.join2("string"==typeof e?e:$.FS.getPath(e),t),a=$.FS.getMode(n,i),$.FS.mkdir(o,a)):$.FS.createFolder(e,t,n,i))}},romdb:null,supportBatterySave:!(d.prototype.apply=function(t,e){e&&this.validateSource(t),tempFile=new Q(this.sizeOutput),t.copyToFile(tempFile,0,this.sizeInput),t.seek(0);for(let e=0;e<this.records.length;e++){var n=this.records[e];tempFile.skip(n.offset),t.skip(n.offset);for(let e=0;e<n.XORdata.length;e++)tempFile.writeU8((t.isEOF()?0:t.readU8())^n.XORdata[e]);tempFile.skip(1),t.skip(1)}return e&&(Z(tempFile),this.checksumOutput),tempFile}),hash:"2b35cacf70ae",hash2:"f5cbb3f38c0bb20e4",hash3:"88cc8ad0c350400499a0",loading:null,gamePatch:null,saveFilenames:[],FS:null,Module:null,aspectRatio:4/3,memData:null,wasmData:null,coreFileData:{},coreFileName:"",coreFileVersion:"",isMobileDevice:!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||""),create:function(){let u=this;window.URL=window.URL||window.webkitURL;let f,p,m,n=!1,i=!1,a=!1,h=0,v=!1,g={psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],"3do":["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a5200:["a52","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],"32x":["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],"fba0.2.97.29":["zip"],mame2003:["zip"],mame:["zip"]},_={psx:"psx",nds:"nds",nes:"nes",snes:"snes",snes2002:"snes2002",snes2005:"snes2005",snes2010:"snes2010",gb:"gb",gbc:"gb",gba:"gba",vbanext:"vbanext",vb:"vb",n64:"n64","3do":"3do",segaMS:"sega",segaGG:"sega",segaMD:"sega",segaCD:"segacd",sega32x:"32x",segaSaturn:"saturn",ngp:"ngp",pce:"pce",msx:"bluemsx",atari2600:"a2600",atari7800:"a7800",atari5200:"a5200",lynx:"lynx",ws:"ws",arcade:"arcade","fba0.2.97.29":"fba0.2.97.29",jaguar:"jaguar",mame2003:"mame2003"},b=this,y=b.system,s=(f=b.customPaths&&"string"==typeof b.customPaths["extract7z.js"]?b.customPaths["extract7z.js"]:b.dataPath+"extract7z.js",p=b.customPaths&&"string"==typeof b.customPaths["extractzip.js"]?b.customPaths["extractzip.js"]:b.dataPath+"extractzip.js?v=1",m=b.customPaths&&"string"==typeof b.customPaths["libunrar.js"]?b.customPaths["libunrar.js"]:b.dataPath+"libunrar.js",F("canvas",{})),x=(this.game.appendChild(s),$.loading=F("div",{class:this.config.classNames.loading}),this.elements.container.appendChild($.loading),{"loading-info":Y({"loading-info":!0}),ad:Y({ad:!0}),"close-ad":Y({"close-ad":!0}),"start-game":Y({"start-game":!0}),on:Y({on:!0}),p1:Y({p1:!0}),p2:Y({p2:!0}),p3:Y({p3:!0}),p4:Y({p4:!0})});var e;"string"==typeof b.adUrl?($.loading.innerHTML='\n        <div>\n        <div class="'+x.ad+'" style="display:block !important;width:300px !important">\n        <div class="'+x["close-ad"]+'" hidden><a href="#" onclick="return false"></a></div>\n        <iframe scrolling="no" frameborder="no" style="width:300px !important;height:250px !important;display: block !important;" src="'+b.adUrl+'"></iframe>\n        </div>\n        <div class="'+x["loading-info"]+'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="'+x.p1+'"></div>\n        <div class="'+x.p2+'"></div>\n        <div class="'+x.p3+'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="'+x["start-game"]+'">'+pe.get("playNow",b.config)+"</a>\n        </div>\n        </div>",e=F("iframe",{src:b.adUrl,scrolling:"no",frameborder:"no",style:"width:300px !important;height:250px !important;display: block !important;"}),$.loading.querySelector(".".concat(x.ad)).removeChild($.loading.querySelector(".".concat(x.ad," iframe"))),$.loading.querySelector(".".concat(x.ad)).appendChild(e),X.webgl.DETECTED||(U($.loading.querySelector(".".concat(x["start-game"])),!0),$.loading.querySelector(".".concat(x.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'),$.loading.querySelector(".".concat(x.ad," iframe")).style.setProperty("display","block","important"),$.loading.querySelector(".".concat(x.ad," iframe")).style.setProperty("visibility","visible","important"),$.loading.querySelector(".".concat(x.ad)).style.setProperty("display","block","important"),$.loading.querySelector(".".concat(x.ad)).style.setProperty("visibility","visible","important")):($.loading.innerHTML='\n        <div>\n        <div class="'.concat(x["loading-info"],'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="').concat(x.p1,'"></div>\n        <div class="').concat(x.p2,'"></div>\n        <div class="').concat(x.p3,'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="').concat(x["start-game"],'">').concat(pe.get("playNow",b.config),"</a>\n        </div>\n        </div>"),X.webgl.DETECTED||(U($.loading.querySelector(".".concat(x["start-game"])),!0),$.loading.querySelector(".".concat(x.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'));let o=window.URL||window.webkitURL,T=function(e){return 80===e[0]&&75===e[1]&&(3===e[2]&&4===e[3]||5===e[2]&&6===e[3]||7===e[2]&&8===e[3])?"zip":55===e[0]&&122===e[1]&&188===e[2]&&175===e[3]&&39===e[4]&&28===e[5]?"7z":82===e[0]&&97===e[1]&&114===e[2]&&33===e[3]&&26===e[4]&&7===e[5]&&(0===e[6]||1===e[6]&&0==e[7])?"rar":void 0},S=async function(e){e=await(await fetch(e)).text(),e=new Blob([e],{type:"application/javascript"}),e=window.URL.createObjectURL(e);return new Worker(e)},E=async function(e){var t=await(await fetch(e)).text(),e=new Blob(["\nlet dataToPass = [];\nModule = {\n    monitorRunDependencies: function(left)  {\n        if (left == 0) {\n            setTimeout(function() {\n                unrar(dataToPass, null);\n            }, 100);\n        }\n    },\n    onRuntimeInitialized: function() {\n    },\n    locateFile: function(file) {\n        return '"+e+".mem';\n    }\n};\n"+t+'\nlet unrar = function(data, password) {\n    let cb = function(fileName, fileSize, progress) {\n        postMessage({"t":4,"current":progress,"total":fileSize, "name": fileName});\n    };\n\n    let rarContent = readRARContent(data.map(function(d) {\n        return {\n            name: d.name,\n            content: new Uint8Array(d.content)\n        }\n    }), password, cb)\n    let rec = function(entry) {\n        if (entry.type === \'file\') {\n            postMessage({"t":2,"file":entry.fullFileName,"size":entry.fileSize,"data":entry.fileContent});\n        } else if (entry.type === \'dir\') {\n            Object.keys(entry.ls).forEach(function(k) {\n                rec(entry.ls[k]);\n            })\n        } else {\n            throw "Unknown type";\n        }\n    }\n    rec(rarContent);\n    postMessage({"t":1});\n    return rarContent;\n};\nonmessage = function(data) {\n    dataToPass.push({name:  \'test.rar\', content: data.data});\n};\n                '],{type:"application/javascript"}),t=window.URL.createObjectURL(e);return new Worker(t)},C=null,w=null,r=null,d=null;try{C=new Te({dbVersion:1,storePrefix:"ejs-",storeName:"system",keyPath:null,autoIncrement:!1,onStoreReady:function(){n=!0},onError:function(){n=!0}}),w=new Te({dbVersion:1,storePrefix:"ejs-",storeName:"roms",keyPath:null,autoIncrement:!1,onStoreReady:function(){i=!0},onError:function(){i=!0}}),r=new Te({dbVersion:1,storePrefix:"ejs-",storeName:"bios",keyPath:null,autoIncrement:!1,onStoreReady:function(){a=!0},onError:function(){a=!0}}),d=new Te({dbVersion:1,storePrefix:"ejs-",storeName:"romsdata",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(e){n=!0,i=!0,a=!0,console.log(e)}j.call(b,b.elements.container,"start-game",function(e){b.started=!0,b.playing=!0,U($.loading.querySelector(".".concat(x["loading-info"])),!0),!ee||"undefined"!=ee.virtualGamepadContainer&&null!==ee.virtualGamepadContainer||J.toggleControls.call(b,!0);let t=Y({"ejs__tooltip--visible":!0}),n=b.elements.buttons.gamepad.querySelector(".".concat(Y({ejs__tooltip:!0}))),i=(V(n,t,!0),setTimeout(function(){V(n,t,!1)},5e3),"string"==typeof b.adUrl&&(U($.loading.querySelector(".".concat(x["close-ad"])),!1),!0!==b.config.noAutoAdClose&&setTimeout(function(){b.started&&$.loading.querySelector(".".concat(x.ad))&&$.loading.querySelector(".".concat(x.ad)).parentNode.removeChild($.loading.querySelector(".".concat(x.ad)))},1e4)),U($.loading.querySelector(".".concat(x["start-game"])),!0),W(ne.defaultCoreOptionsValues.call(u),ne.storage.get("core-options")||{}));"n64"===b.system&&i&&Object.keys(i).forEach(function(e){"glupen64-aspect"===e&&"16:9"===i[e]&&(s.height=s.width/16*9,$.aspectRatio=16/9)}),"arcade"!==u.system&&"fba0.2.97.29"!==u.system||i&&Object.keys(i).forEach(function(e){"fba-aspect"===e&&"PAR"===i[e]&&(s.height=s.width/16*9,$.aspectRatio=16/9)}),"gba"===b.system&&(s.height=s.width/1.5,$.aspectRatio=1.5);{let e=u;"undefined"!=typeof RI?(document.removeEventListener("mousemove",RI.eventHandler,!1),s.removeEventListener("mousedown",RI.canvasEventHandler,!1),s.removeEventListener("mouseup",RI.canvasEventHandler,!1),e.elements.container.addEventListener("mousemove",function(e){let t=0,n=0,i=e.offsetX-$.Module.canvas.offsetLeft,o=e.offsetY-$.Module.canvas.offsetTop;if("mousemove"===e.type){t=i<0?(i=0,-$.Module.canvas.offsetWidth):i>$.Module.canvas.offsetWidth?(i=$.Module.canvas.offsetWidth,$.Module.canvas.offsetWidth):i-RI.currentX,n=o<0?(o=0,-$.Module.canvas.offsetHeight):o>$.Module.canvas.offsetHeight?(o=$.Module.canvas.offsetHeight,$.Module.canvas.offsetHeight):o-RI.currentY,RI.currentX=i,RI.currentY=o;for(let e=0;e<RI.contexts.length;e+=1)HEAP32[RI.contexts[e].state+32>>2]=t,HEAP32[RI.contexts[e].state+36>>2]=n}},!1),e.elements.container.addEventListener("mousedown",RI.canvasEventHandler,!1),e.elements.container.addEventListener("mouseup",RI.canvasEventHandler,!1),o=function(l){if(l.targetTouches[0]){let t,n,i=0,o=0,e=l.target.getBoundingClientRect(),a=l.targetTouches[0].clientX-e.left,s=l.targetTouches[0].clientY-e.top;i=a<0?(a=0,-$.Module.canvas.offsetWidth):a>$.Module.canvas.offsetWidth?(a=$.Module.canvas.offsetWidth,$.Module.canvas.offsetWidth):a-RI.currentX,o=s<0?(s=0,-$.Module.canvas.offsetHeight):s>$.Module.canvas.offsetHeight?(s=$.Module.canvas.offsetHeight,$.Module.canvas.offsetHeight):s-RI.currentY,RI.currentX=a,RI.currentY=s;for(let e=0;e<RI.contexts.length;e+=1)HEAP32[RI.contexts[e].state+32>>2]=i,HEAP32[RI.contexts[e].state+36>>2]=o;switch(l.type){case"touchend":case"touchstart":if(0===l.button)n=40;else{if(2!==l.button)break;n=41}t="touchend"===l.type?0:1;for(let e=0;e<RI.contexts.length;e+=1)HEAP8[RI.contexts[e].state+n>>0]=t}}},e.elements.container.addEventListener("touchstart",o,!1),e.elements.container.addEventListener("touchend",o,!1)):(o=function(e){e=new MouseEvent(e.type,e);$.Module.canvas.dispatchEvent(e)},H.call(u,".".concat(Y({ejs__dialogs:!0}))).addEventListener("mousemove",o,!1),H.call(u,".".concat(Y({ejs__dialogs:!0}))).addEventListener("mousedown",o,!1),H.call(u,".".concat(Y({ejs__dialogs:!0}))).addEventListener("mouseup",o,!1))}var o;"msx"===b.system&&"undefined"!=typeof RI&&(document.removeEventListener("keydown",RI.eventHandler,!1),document.removeEventListener("keyup",RI.eventHandler,!1),o=function(n){var e=n.keyCode,i=e>>3,o=1<<(7&e);switch(n.type){case"keyup":case"keydown":if(32<=i)throw"key code error! bad code: "+e;for(let t=0;t<RI.contexts.length;t++){let e=HEAP8[RI.contexts[t].state+i>>0];"keyup"===n.type?e&=~o:e|=o,HEAP8[RI.contexts[t].state+i>>0]=e}}},document.addEventListener("keydown",o,!1),document.addEventListener("keyup",o,!1)),setTimeout(function(){let o;o=q.info(),null===ee.setVolume&&"undefined"!=typeof RA?(RA.queueAudio=function(){let e,t=b.volume,n=RA.bufIndex,i=(e=RA.bufIndex?RA.buffers[RA.bufIndex-1].endTime:RA.context.currentTime,RA.buffers[n].endTime=e+RA.buffers[n].duration,RA.context.createBufferSource());if(i.buffer=RA.buffers[n],1===(t=b.muted?0:t))i.connect(RA.context.destination);else{let e=RA.context.createGain();i.connect(e),e.connect(RA.context.destination),q.isEdge||"chrome"===o.name&&parseInt(o.version,10)<=60||"firefox"===o.name&&parseInt(o.version,10)<=56||"opera"===o.name&&parseInt(o.version,10)<=44?e.gain.value=t:"firefox"===o.name?e.gain.setValueAtTime(t,RA.context.currentTime):e.gain.setValueAtTime(t,RA.context.currentTime,0)}i.start(e),RA.bufIndex+=1,RA.bufOffset=0},q.isIos&&window.addEventListener("touchstart",function(){if(RA.context){RA.context.resume();let e=RA.context.createBufferSource();e.connect(RA.context.destination),e.start()}},!1)):ee.setVolume()},500),setTimeout(function(){b.elements.container.focus()},30),void 0===window.addRunDependency&&(window.Module=void 0)}),"string"==typeof b.adUrl&&j.call(b,$.loading.querySelector(".".concat(x["close-ad"])),"click",function(e){e instanceof MouseEvent&&b.started&&$.loading.querySelector(".".concat(x.ad))&&$.loading.querySelector(".".concat(x.ad)).parentNode.removeChild($.loading.querySelector(".".concat(x.ad))),b.elements.container.focus()});let P=function(){w.db&&w.getAll(function(e){Array.isArray(e)&&10<e.length&&e.sort(function(e,t){return(t.lastaccess||0)-(e.lastaccess||0)}).forEach(function(e,t){10<t&&!$.saveFilenames.includes(e.key)?(w.remove(e.key),d.db&&d.remove(e.key)):(delete e.data,w.put(e.key,e))})},function(){w.clear(),d.db&&d.clear()})},M=function(o){if($.gamePatch){let r=$.getStartName(!0),e=r.split("/"),t=e.pop().split(".").pop(),n=($.gamePatch.split(".").pop(),$.gamePatch.split("/").pop().split(".").shift()),i="".concat(e.join("/"),"/").concat(n,".").concat(t);i=i.replace(/\#/g,""),$.gamePatch.startsWith("blob:")&&(i=r);var c,d=$.gamePatch;if($.FS.rename(r,i),o.startName=i,r=$.getStartName(!0),"snes"===o.system||["snes2002","snes2005","snes2010"].includes(o.system)){let e,t,n,i=new Q($.FS.readFile(r)),o=Z(i),a=new Q($.FS.readFile(d)),s=a.readString(6),l=i._u8array.length%1024;s.startsWith("PATCH")?(e=Ee(a),0==l&&"B19ED489"===o.toString(16).toUpperCase()&&((t=new Uint8Array(i._u8array.length+512)).set(new Uint8Array(512),0),t.set(i._u8array,512),i=new Q(t))):s.startsWith(Le)?e=Be(a):s.startsWith("BPS1")&&(e=Ie(a),0<l&&"A31BEAD4"===o.toString(16).toUpperCase()&&(t=i._u8array.slice?i._u8array.slice(l):i._u8array.subarray(l),i=new Q(t)));try{(n=e.apply(i,!1))&&(0<(c=n._u8array.length%1024)&&(t=n._u8array.slice?n._u8array.slice(c):n._u8array.subarray(c),n=new Q(t)),$.FS.unlink(d),$.FS.unlink(r),$.FS.writeFile(r,n._u8array))}catch(e){}}else{let e,t,n=new Q($.FS.readFile(r)),i=new Q($.FS.readFile(d)),o=i.readString(6);o.startsWith("PATCH")?e=Ee(i):o.startsWith(Le)?e=Be(i):o.startsWith("BPS1")&&(e=Ie(i));try{(t=e.apply(n,!1))&&($.FS.unlink(d),$.FS.unlink(r),$.FS.writeFile(r,t._u8array))}catch(e){}}}},O=function(){var e=2===u.coreVer?"INITIAL_MEMORY":"TOTAL_MEMORY";v?(window.Module[e]=268435456,["jaguar"].includes(u.system)&&(window.Module[e]=268435456),["nds","nes","snes","arcade","mame"].includes(u.system)&&(window.Module[e]=0),["snes2002","snes2005","snes2010"].includes(u.system)&&(window.Module[e]=0),"gba"==u.system&&(window.Module[e]=0),"3do"==u.system&&(window.Module[e]=0),"n64"==u.system&&(window.Module[e]=0)):("nes"===u.system&&(window.Module[e]=134217728),window.Module[e]=h+67108864,["arcade","mame","mame2003","fba0.2.97.29"].includes(u.system)&&(window.Module[e]=h+268435456,$.isMobileDevice&&(window.Module[e]=314572800)),["n64","nds","jaguar"].includes(u.system)&&(window.Module[e]=h+268435456,$.isMobileDevice&&(window.Module[e]=314572800)),"gba"==u.system&&(window.Module[e]=268435456)),"undefined"!=typeof EJS_MEMORY&&(window.Module[e]=EJS_MEMORY)},I=function(e,t){function n(t){if(a.innerHTML="Game Data ready",t)try{O(),M(o),P();let e=[t,[$.hash,$.hash2,$.hash3].join("")];if("undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&e.unshift("-v"),$.Module.callMain(e),2===b.coreVer){$.Module.resumeMainLoop(),$.Module.setCanvasSize(800,600);let e=0,t=setInterval(function(){20<e&&clearInterval(t),e++,$.Module.setCanvasSize(800,600)},100)}G.call(o,o.elements.container,"start-game");try{c()}catch(e){}}catch(e){console.log(e),a.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Doesn\'t look like your browser is supported</strong>'}else a.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Invalid Rom</strong>'}function i(e){if(e.data){if(1===e.data.t&&(!o.startName&&r&&(o.startName=r),e.target.terminate(),n(o.startName)),2===e.data.t){let t=e.data.file.split("/"),n=t.pop(),i=n.split(".").pop();n=n.replace(/\#/g,""),$.FS.createPath("/",t.join("/"),!0,!0);for(let e=g[s].length-1;0<=e;--e)g[s][e]===i.toLowerCase()&&e>l&&(l=e,o.startName=["",t.join("/"),n].join("/"),o.startName=o.startName.replace(/\/+/,"/"));n&&($.FS.createDataFile("/".concat(t.join("/")),n,e.data.data,!0,!1),h+=e.data.data.length),r="/".concat(t.join("/"),"/").concat(n)}var t;4===e.data.t&&0<e.data.total&&(t=Math.floor(e.data.current/e.data.total*100),e=e.data.name||"",t<=100&&0<t&&(a.innerHTML=u.localization("Decompress Game Data")+e+" "+t+"%"))}}let o=u,a=$.loading.querySelector(".".concat(x.p3)),s=(e.split(".").pop(),_[y]),l=-1,r="",c=function(){if(2===o.coreVer){o.elements.settings.panels.home.querySelector('[role="menu"]').innerHTML="",te.setNormalOptionsMenu.call(o),te.setCoreOptionsMenu.call(o);let e=$.Module.cwrap("toggleMainLoop","null",["number"]);$.Module.resumeMainLoop=function(){e(1)},$.Module.pauseMainLoop=function(){e(0)}}"string"==typeof o.loadStateOnStart&&fetch(o.loadStateOnStart).then(function(e){e.arrayBuffer().then(function(e){e=new Uint8Array(e);EJS_loadState(e)})})},d=(window.EJS_terminate=function(){if($.Module.pauseMainLoop(),o&&o.eventListeners)for(var e in o)for(let t=0;t<o.eventListeners.length;t++){let e=o.eventListeners[t];e.element.removeEventListener(e.type,e.callback,e.capture)}if(window.EJS_RESET_VARS){let t=[],n=[];for(var i in window)t.push(i);for(let e=0;e<t.length;e++)window.EJS_RESET_VARS.includes(t[e])||n.push(t[e]);for(let e=0;e<n.length;e++)window[n[e]]&&delete window[n[e]]}},!1);if(["arcade","mame","mame2003","fba0.2.97.29"].includes(o.system)||(e=t.slice?t.slice(0,10):t.subarray(0,10),"7z"===(e=T(e))?(S(f).then(function(e){e.onmessage=i,e.postMessage(t)}),d=!0):"zip"===e?(S(p).then(function(e){e.onmessage=i,e.postMessage(t)}),d=!0):"rar"===e&&(E(m).then(function(e){e.onmessage=i,e.postMessage(t)}),d=!0)),!d){o.startName=o.getStartName(),o.startName||(o.startName="rom");try{h+=t.length,$.FS.createDataFile("/",o.startName,t,!0,!1)}catch(e){console.log(e)}n(o.startName)}},c=function(){let i=u,s=$.loading.querySelector(".".concat(x.p3)),e=u.config,l=e.gameUrl,r=e.system,t=("vbanext"==r&&(r="gba"),"string"==typeof l?l.split("/"):"ga.me"),c=t[t.length-1];(c=-1<c.indexOf("?")?c.substr(0,c.indexOf("?")):c).split(".").pop(),s.innerHTML=u.localization("Download Game Data"),["arcade","mame","mame2003","fba0.2.97.29"].includes(i.system)&&i.config.gameParentUrl&&(s.innerHTML+=" (2/2)"),i.config.gamePatchUrl&&(s.innerHTML+=" (2/2)"),"string"!=typeof l?"[object Blob]"===l.toString()?l.arrayBuffer().then(function(e){I(c,new Uint8Array(e))}):"[object ArrayBuffer]"===l.toString()?I(c,new Uint8Array(l)):I(c,Uint8Array.from(l)):K.a.head(l,{}).then(function(e){function t(){K.a.get(l,{onDownloadProgress:function(e){e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"";["arcade","mame","mame2003","fba0.2.97.29"].includes(i.system)&&i.config.gameParentUrl||i.config.gamePatchUrl?s.innerHTML=u.localization("Download Game Data")+" (2/2) ".concat(e):s.innerHTML=u.localization("Download Game Data")+" ".concat(e)},responseType:"arraybuffer"}).then(function(e){let i=new Uint8Array(e.data);if("string"!=typeof u.config.gameUrl||"string"==typeof u.config.gameUrl&&(u.config.gameUrl.startsWith("blob:")||u.config.gameUrl.startsWith("file:")||u.config.gameUrl.startsWith("chrome-extension:")||("file:"==window.location.protocol||"chrome-extension:"==window.location.protocol)&&1===u.config.gameUrl.split(":").length))I(c,i);else{if(a&&w.db)if(104857600<i.length)for(let e=Math.ceil(i.length/104857600),n=0;n<e;n+=1){let e=i.slice?i.slice(104857600*n,104857600*(n+1)):i.subarray(104857600*n,104857600*(n+1)),t="".concat(a);0<n&&(t="".concat(a,"-part-").concat(n)),$.saveFilenames.push(t),w.put(t,{filename:c,filesize:i.length,filetype:o,key:t,lastaccess:(new Date).valueOf(),next:"".concat(a,"-part-").concat(n+1)}),d.db&&d.put(t,{filename:c,filesize:i.length,filetype:o,key:t,data:e})}else $.saveFilenames.push(a),w.put(a,{filename:c,filesize:i.length,filetype:o,key:a,lastaccess:(new Date).valueOf()}),d.db&&d.put(a,{filename:c,filesize:i.length,filetype:o,key:a,data:i});I(c,i)}}).catch(function(e){k(e,s,u)})}let n=e.headers["content-length"],o=e.headers["content-type"],a=(e.headers["last-modified"],"".concat(r,"-").concat(c));d.db?d.get(a,function(i){if(i&&i.filename===c&&i.filesize-n==0&&i.filetype===o&&i.key)if(w.get(a,function(e){e.lastaccess=(new Date).valueOf(),w.put(e.key,e)}),104857600<i.filesize){let n=new Uint8Array(i.filesize);n.set(i.data);for(let e=Math.ceil(i.filesize/104857600),t=[],n=1;n<e;n+=1)t.push("".concat(a,"-part-").concat(n)),w.get("".concat(a,"-part-").concat(n),function(e){e.lastaccess=(new Date).valueOf(),w.put(e.key,e)});d.getBatch(_0x36180f,function(e){e.filter(function(e){return e}).length!==_0x36180f.length?t():(e.forEach(function(e,t){n.set(e.data,104857600*(t+1))}),I(i.filename,n))},function(){},"sparse")}else I(i.filename,i.data);else t()}):t()}).catch(function(e){k(e,s,u)})},A=function(){let t=$.loading.querySelector(".".concat(x.p3)),n=u.config.gamePatchUrl;if(n){let e=n.split("/"),l=e[e.length-1];(l=-1<l.indexOf("?")?l.substr(0,l.indexOf("?")):l).split(".").pop(),t.innerHTML=u.localization("Download Game Data")+" (1/2)",K.a.get(n,{onDownloadProgress:function(e){t.innerHTML=u.localization("Download Game Data")+" (1/2) ";e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"";t.innerHTML+=e},responseType:"arraybuffer"}).then(function(e){function t(i){if(i.data){if(1===i.data.t&&(i.target.terminate(),c()),2===i.data.t){let e=i.data.file.split("/"),t=e.pop(),n=t.split(".").pop();$.FS.createPath("/",e.join("/"),!0,!0),$.FS.createDataFile("/"+e.join("/"),t,i.data.data,!0,!1),h+=i.data.data.length,["ips","bps","ups"].includes(n)&&!$.gamePatch&&($.gamePatch="/"+e.join("/")+"/"+t)}var e;4===i.data.t&&0<i.data.total&&(e=Math.floor(i.data.current/i.data.total*100),i=i.data.name||"",e<=100&&0<e&&(o.innerHTML=u.localization("Decompress Game Patch")+" ".concat(i," ").concat(e,"%")))}}let n=new Uint8Array(e.data),i=l.split(".").pop(),o=$.loading.querySelector(".".concat(x.p3)),a=n.slice?n.slice(0,10):n.subarray(0,10),s=T(a);"7z"===s?S(f).then(function(e){e.onmessage=t,e.postMessage(n)}):"zip"===s?S(p).then(function(e){e.onmessage=t,e.postMessage(n)}):"rar"===s?E(m).then(function(e){e.onmessage=t,e.postMessage(n)}):(h+=n.length,$.gamePatch="/"+i,$.FS.createDataFile("/",i,n,!0,!1),c())}).catch(function(e){k(e,p,u)})}else c()},R=function(){let t=u,i=$.loading.querySelector(".".concat(x.p3)),l=u.config.gameParentUrl;if(l&&["arcade","mame","mame2003","fba0.2.97.29"].includes(t.system)){let e=l.split("/"),s=e[e.length-1];(s=-1<s.indexOf("?")?s.substr(0,s.indexOf("?")):s).split(".").pop(),i.innerHTML=u.localization("Download Game Data")+" (1/2)",t.config.gamePatchUrl&&(i.innerHTML=u.localization("Download Game Data")+" (1/3)"),K.a.head(l,{}).then(function(e){function t(){K.a.get(l,{onDownloadProgress:function(e){e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"";i.innerHTML=u.localization("Download Game Data")+" (1/2) ".concat(e)},responseType:"arraybuffer"}).then(function(e){let i=new Uint8Array(e.data);if(a&&w.db)if(104857600<i.length)for(let e=Math.ceil(i.length/104857600),n=0;n<e;n+=1){let e=i.slice?i.slice(104857600*n,104857600*(n+1)):i.subarray(104857600*n,104857600*(n+1)),t="".concat(a);0<n&&(t="".concat(a,"-part-").concat(n)),$.saveFilenames.push(t),w.put(t,{filename:s,filesize:i.length,filetype:o,key:t,lastaccess:(new Date).valueOf(),next:"".concat(a,"-part-").concat(n+1)}),d.db&&d.put(t,{filename:s,filesize:i.length,filetype:o,key:t,data:e})}else $.saveFilenames.push(a),w.put(a,{filename:s,filesize:i.length,filetype:o,key:a,lastaccess:(new Date).valueOf()}),d.db&&d.put(a,{filename:s,filesize:i.length,filetype:o,key:a,data:i});e=s.replace(/\#/g,"");try{h+=i.length,$.FS.createDataFile("/",e,i,!0,!1),A()}catch(e){console.log(e)}}).catch(function(e){k(e,i,u)})}let n=e.headers["content-length"],o=e.headers["content-type"],a=(e.headers["last-modified"],"".concat(y,"-").concat(s));d.db?d.get(a,function(i){if(i&&i.filename===s&&i.filesize-n==0&&i.filetype===o&&i.key)if(104857600<i.filesize){let n=new Uint8Array(i.filesize);n.set(i.data);for(let e=Math.ceil(i.filesize/104857600),t=[],n=1;n<e;n+=1)t.push("".concat(a,"-part-").concat(n));d.getBatch(_0x6f30ae,function(e){e.filter(function(e){return e}).length!==_0x6f30ae?t():(e.forEach(function(e,t){n.set(e.data,104857600*(t+1))}),$.FS.createDataFile("/",i.filename,n,!0,!1),A())},function(){},"sparse")}else $.FS.createDataFile("/",i.filename,i.data,!0,!1),A();else t()}):t()}).catch(function(e){k(e,i,u)})}else A()},N=function(e,t){function n(n){if(n.data){if(1===n.data.t&&(o.innerHTML="BIOS ready",n.target.terminate(),R()),2===n.data.t){let e=n.data.file.split("/"),t=e.pop();t.split(".").pop(),$.FS.createPath("/",e.join("/"),!0,!0),$.FS.createDataFile("/"+e.join("/"),t,n.data.data,!0,!1),h+=n.data.data.length}var e;4===n.data.t&&0<n.data.total&&(e=Math.floor(n.data.current/n.data.total*100),n=n.data.name||"",e<=100&&0<e&&(o.innerHTML="Decompress BIOS ".concat(n," ").concat(e,"%")))}}let i=u,o=$.loading.querySelector(".".concat(x.p2)),a=(e.split(".").pop(),t.slice?t.slice(0,10):t.subarray(0,10)),s=T(a);"7z"===s?S(f).then(function(e){e.onmessage=n,e.postMessage(t)}):"rar"===s?E(m).then(function(e){e.onmessage=n,e.postMessage(t)}):"zip"!==s||["arcade","mame","mame2003","fba0.2.97.29"].includes(i.system)?(h+=t.length,o.innerHTML="BIOS ready",$.FS.createDataFile("/",e,t,!0,!1),R()):S(p).then(function(e){e.onmessage=n,e.postMessage(t)})},l=function(){$.loading.querySelector(".".concat(x.p1)).innerHTML="Game Core ready";let l=u.config.biosUrl,e=(ee.bindFunction.call(u),ee.setGamepadDialog.call(u),ee.setCacheDialog.call(u),ee.setLoadingDialog.call(u),ee.setCheatDialog.call(u),ee.initGamepad.call(u),ee.initKeyboard.call(u),ee.listeners.call(u),$._FS.createFolder("/","etc",!0,!0),$.FS.mkdir("/data"),$.FS.mkdir("/data/saves"),"undefined"!=typeof IDBFS?$.FS.mount(IDBFS,{},"/data/saves"):$.FS.mount($.FS.filesystems.IDBFS,{},"/data/saves"),$.FS.mkdir("/shader"),$.FS.syncfs(!0,function(e){}),ee.initShaders(),""),t=(e=(e=(e=(e=(e+="savefile_directory = /data/saves\n")+"video_vsync = true\n"+"screenshot_directory = /\n")+"video_shader = /shader/shader.glslp\n"+"video_shader_enable = true\n")+"video_font_enable = false\n"+"video_scale = 1.0\n")+"video_gpu_screenshot = false\n"+"audio_latency = 96\n",ne.defaultCoreOptionsValues.call(u)),n=(u.lightgun&&("nes"===u.system&&(e+='input_libretro_device_p2 = "258"\n'),"segaMS"!==u.system&&"segaMD"!==u.system&&"segaCD"!==u.system||(t.genesis_plus_gx_gun_cursor="yes",t.genesis_plus_gx_invert_mouse="yes",t.genesis_plus_gx_bram="per game",e+='input_libretro_device_p2 = "260"\n'),"snes"===u.system&&(e+='input_libretro_device_p2 = "260"\n'),["snes2002","snes2005","snes2010","snesnext"].includes(u.system)&&(e+='input_libretro_device_p2 = "260"\n')),u.mouse&&("snes"===u.system&&(e+="input_libretro_device_p1 = 2\n"),["snes2002","snes2005","snes2010","snesnext"].includes(u.system)&&(e+="input_libretro_device_p1 = 2\n")),u.multitap&&["snes2002","snes2005","snes2010","snesnext","snes"].includes(u.system)&&(e+="input_libretro_device_p2 = 257\n"),"n64"===u.system&&(e+="input_libretro_device_p1 = 5\n"),e=e+"fastforward_ratio = 1.0\n"+"video_smooth = false\n",W(t,ne.storage.get("core-options")||{})),i="";if(2===u.coreVer?($.FS.createDataFile("/etc","retroarch.cfg",e,!0,!0),$._FS.createFolder("/home/web_user","retroarch",!0,!0),$._FS.createFolder("/home/web_user/retroarch","userdata",!0,!0),$.FS.createDataFile("/home/web_user/retroarch/userdata","retroarch.cfg",i,!0,!0)):($.FS.createDataFile("/etc","retroarch.cfg",e,!0,!0),$._FS.createFolder("/home/web_user",".config",!0,!0),$._FS.createFolder("/home/web_user/.config","retroarch",!0,!0),$.FS.createDataFile("/home/web_user/.config/retroarch","retroarch-core-options.cfg",i,!0,!0)),n&&Object.keys(n).forEach(function(t){if(u.lightgun&&"nes"===u.system&&"system_type"===t)return!1;i+="".concat(t,' = "').concat(n[t],'"\n'),j.call(u,u.elements.container,"start-game",function(e){ee.setVariable(t,n[t])})}),l){let e=l.split("/"),a=e[e.length-1],s=((a=-1<a.indexOf("?")?a.substr(0,a.indexOf("?")):a).split(".").pop(),$.loading.querySelector(".".concat(x.p2)));K.a.head(l,{}).then(function(e){function t(){K.a.get(l,{onDownloadProgress:function(e){e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"";s.innerHTML="Download BIOS ".concat(e)},responseType:"arraybuffer"}).then(function(e){e=new Uint8Array(e.data);r.db&&r.put(y,{filename:a,filesize:e.length,filetype:i,data:e}),N(a,e)}).catch(function(e){k(e,s,u)})}let n=e.headers["content-length"],i=e.headers["content-type"],o=(e.headers["last-modified"],u.system);r.db?r.get(o,function(e){e&&e.filename===a&&e.filesize-n==0&&e.filetype===i?N(e.filename,e.data):t()}):t()}).catch(function(e){k(e,s,u)})}else R()},L=function(e){e=e.byteLength?new Uint8Array(e):e;"undefined"!=typeof GLOBAL_BASE?$.Module.HEAPU8.set(e,GLOBAL_BASE):"undefined"!=typeof Runtime&&Runtime.GLOBAL_BASE?$.Module.HEAPU8.set(e,Runtime.GLOBAL_BASE):$.Module.HEAPU8.set(e,8)},z=function(t){function n(n){if(n.data){if(1===n.data.t&&(G.call(b,b.elements.container,"script-loaded"),n.target.terminate()),2===n.data.t){let e=n.data.file.split("/").pop(),t=e.split(".").pop();$.coreFileData[e]=n.data.data,"js"!==t||e.includes(".worker.js")||(i=n.data.data),"mem"===t&&($.memData=n.data.data),"wasm"===t&&($.wasmData=n.data.data)}4===n.data.t&&0<n.data.total&&(e.innerHTML=u.localization("Decompress Game Core")+" ".concat(Math.floor(n.data.current/n.data.total*100),"%"))}}let e=$.loading.querySelector(".".concat(x.p1)),i="";j.call(b,b.elements.container,"script-loaded",function(e){{null!==$.wasmData?(window.Module.wasmBinary=$.wasmData,O(),window.Module.monitorRunDependencies=function(e){0===e&&l()},window.Module.onRuntimeInitialized=function(){}):(O(),window.Module.monitorRunDependencies=function(e){console.log("monitorRunDependencies, ",e)},window.Module.onRuntimeInitialized=function(){$.Module||($.Module=window.Module),$.Module&&$.Module.FS?$.FS=$.Module.FS:$.FS=window.FS,console.log("onRuntimeInitialized"),l()});let n=window.Module;if(null!==$.wasmData&&(n.wasmBinary=$.wasmData),q.isIos&&null!==$.wasmData){let e=new Blob([i],{type:"text/javascript"}),t=F("script",{src:o.createObjectURL(e)});document.body.appendChild(t),t.onload=function(){void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&($.Module=EmulatorJS(n),EmulatorJS=void 0),null!==$.memData&&2!==b.coreVer&&L($.memData),$.Module||($.Module=window.Module),$.Module&&$.Module.FS?$.FS=$.Module.FS:$.FS=window.FS}}else i=function(n){let i=[];for(let t=0;t<n.length;t+=1){let e=n[t];255<e&&(e&=255),i.push(String.fromCharCode(e))}return i.join("")}(i),window.eval(i),void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&($.Module=EmulatorJS(n),EmulatorJS=void 0),null!==$.memData&&2!==b.coreVer&&L($.memData),$.Module||($.Module=window.Module),$.Module&&$.Module.FS?$.FS=$.Module.FS:$.FS=window.FS,window.EJS_MODULE=$.Module,window.ejs_loader=$,window.ejs_media=ee;return void(i=null)}});S(f).then(function(e){e.onmessage=n,e.postMessage(t)})},D=function(t){U($.loading.querySelector(".".concat(x["start-game"])),!0);let o=$.loading.querySelector(".".concat(x.p1));if(o.innerHTML=u.localization("Loading")+"...",!0===n&&!0===i&&!0===a){window.Module={TOTAL_MEMORY:268435456,noInitialRun:!0,arguments:[],preRun:[],postRun:[],canvas:s,print:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},printErr:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},totalDependencies:0,monitorRunDependencies:function(e){},locateFile:function(e){let t=null;var n;return e.includes(".worker.js")?(Object.keys($.coreFileData).includes(e)&&(t=$.coreFileData[e]),n=new Blob([""],{type:"application/javascript"}),window.URL.createObjectURL(n)):e.includes(".js.mem")&&Object.keys($.coreFileData).includes(e)?(t=$.coreFileData[e],URL.createObjectURL(new Blob([t.buffer]))):null},readAsync:function(t,n,i){if(t instanceof ArrayBuffer)setTimeout(function(){n(t)},500);else{let e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){200==e.status||0==e.status&&e.response?n(e.response):i()},e.onerror=i,e.send()}}};let d=function(n,i){var e=u.customPaths&&"string"==typeof u.customPaths[n]?u.customPaths[n]:2===u.coreVer?u.dataPath+"cores/"+n+"?v="+i:u.dataPath+"old/"+n+"?v="+i;K.a.get(e,{onDownloadProgress:function(e){e.total&&Math.floor(e.loaded/e.total*100).toString();o.innerHTML=u.localization("Download Game Core")+i},responseType:"arraybuffer"}).then(function(e){let t=new Uint8Array(e.data);if(C.db&&C.put(n,{version:i,data:t}),2===u.coreVer)z(t);else{let e=t.slice?t.slice(12):t.subarray(12);e.set([55,122,188,175,39,28,0,3],0),t=null,z(e)}}).catch(function(e){k(e,o,u)})};var e=u.customPaths&&"string"==typeof u.customPaths["v.json"]?u.customPaths["v.json"]:u.dataPath+"v.json";return K.a.get(e,{}).then(function(s){let l,r=_[u.system],e=s.data[u.system],c=$.loading.querySelector(".".concat(x.p1));if(e){let n=e.version||1,t=Boolean(e.state),i=Boolean(e.asmjs),o=Boolean(e.wasm),a=(!0===u.config.oldCores&&1===e.oldCores||1!==e.newCores||!X.wasm&&!i||$.isMobileDevice&&1===e.oldCores||(u.coreVer=2,delete Module.readAsync,Module.INITIAL_MEMORY=Module.TOTAL_MEMORY,delete Module.TOTAL_MEMORY,u.elements.settings.panels.home.querySelector('[role="menu"]').innerHTML="",te.setNormalOptionsMenu.call(u),te.setCoreOptionsMenu.call(u)),2!==u.coreVer&&e.old&&(i=Boolean(e.old.asmjs),o=Boolean(e.old.wasm)),"nds"!=u.system||X.wasm||2===u.coreVer||(t=!1),!1===u.statesSupported&&(t=!1),$.coreFileVersion=n,$.coreFileName=r,!1);if(["webgl2","experimental-webgl2"].includes(X.webgl.WEBGL_CONTEXT)&&(a=!0),"undefined"!=typeof EJS_N64_LEGACY&&1==EJS_N64_LEGACY&&(a=!1),"mame"==u.system){let e=u.mameCore;if(!e||null===e||2!==e.split("|").length)return void(c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+u.localization("Missing mame config")+"</strong>");s=e.split("|");$.coreFileName="".concat(u.system,"-").concat(s[0]),t="1"===s[1],B.element(u.elements.buttons.saveState)&&U(u.elements.buttons.saveState,!t),B.element(u.elements.buttons.loadState)&&U(u.elements.buttons.loadState,!t),U(ne.contextMenu.querySelectorAll("ul li").item(2),!t),U(ne.contextMenu.querySelectorAll("ul li").item(3),!t),l=2===u.coreVer?"":u.system.concat("-old-").concat(s[0],"-wasm.data"),s[0]?(X.wasm&&o?v=!0:(c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+u.localization("Webassembly support is not detected in this browser")+"</strong>",l=""),l&&(C.db?C.get(l,function(t){if(t&&t.version===n)if(2===b.coreVer)z(t.data);else{let e=t.data.slice?t.data.slice(12):t.data.subarray(12);e.set([55,122,188,175,39,28,0,3],0),z(e)}else d(l,n)}):d(l,n))):c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+u.localization("Unsupported Game")+"</strong>"}else{l=!1;let e;if(X.wasm&&o?(e="wasm",l=!0,"n64"!==u.system||a||2===u.coreVer||(e="legacy-wasm"),v=!0):i&&(l=!0,e="asmjs","n64"!==u.system||a||2===u.coreVer||(e="legacy-asmjs")),!0!==(l="undefined"!=typeof EJS_CUSTOM_COREFILE?EJS_CUSTOM_COREFILE:l))return void(c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+u.localization("Please upgrade your browser to the latest version")+"</strong>");l=2===u.coreVer?r+"-"+e+".data":r+"-old-"+e+".data","undefined"!=typeof EJS_CUSTOM_COREFILE&&(l=EJS_CUSTOM_COREFILE),C.db?C.get(l,function(t){if(!t||t.version!==n||"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX)d(l,n);else if(2===b.coreVer)z(t.data);else{let e=t.data.slice?t.data.slice(12):t.data.subarray(12);e.set([55,122,188,175,39,28,0,3],0),z(e)}}):d(l,n)}B.element(u.elements.buttons.saveState)&&U(u.elements.buttons.saveState,!t),B.element(u.elements.buttons.loadState)&&U(u.elements.buttons.loadState,!t),U(ne.contextMenu.querySelectorAll("ul li").item(2),!t),U(ne.contextMenu.querySelectorAll("ul li").item(3),!t),u.statesSupported=t,u.config.buttons&&(!1===u.config.buttons.playPause&&B.element(u.elements.buttons.play[0])&&U(u.elements.buttons.play[0],!0),!1===u.config.buttons.restart&&B.element(u.elements.buttons.restart)&&U(u.elements.buttons.restart,!0),!1===u.config.buttons.mute&&B.element(u.elements.buttons.mute)&&U(u.elements.buttons.mute,!0),!1===u.config.buttons.settings&&B.element(u.elements.buttons.settings)&&U(u.elements.buttons.settings,!0),!1===u.config.buttons.fullscreen&&B.element(u.elements.buttons.fullscreen)&&U(u.elements.buttons.fullscreen,!0),!1===u.config.buttons.saveState&&B.element(u.elements.buttons.saveState)&&U(u.elements.buttons.saveState,!0),!1===u.config.buttons.loadState&&B.element(u.elements.buttons.loadState)&&U(u.elements.buttons.loadState,!0),!1===u.config.buttons.screenRecord&&B.element(u.elements.buttons.screenRecord)&&U(u.elements.buttons.screenRecord,!0),!1===u.config.buttons.gamepad&&B.element(u.elements.buttons.gamepad)&&U(u.elements.buttons.gamepad,!0),!1===u.config.buttons.cheat&&B.element(u.elements.buttons.cheat)&&U(u.elements.buttons.cheat,!0),!1===u.config.buttons.volume&&B.element(u.elements.inputs.volume)&&U(u.elements.inputs.volume,!0),!1===u.config.buttons.screenshot&&U(ne.contextMenu.querySelectorAll("ul li").item(0),!0),!0===u.config.buttons.cacheManage&&U(ne.contextMenu.querySelectorAll("ul li").item(1),!1),!1===u.config.buttons.quickSave&&U(ne.contextMenu.querySelectorAll("ul li").item(2),!0),!1===u.config.buttons.quickLoad&&U(ne.contextMenu.querySelectorAll("ul li").item(3),!0))}else c.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+u.localization("Invalid System")+"</strong>"}).catch(function(e){k(e,t,b)}),$.romdb=w,!1}setTimeout(D,50)};ie($.loading.querySelector(".".concat(x["start-game"])),"click touchstart",D),!0===b.startOnLoad&&$.loading.querySelector(".".concat(x["start-game"])).click()}};let v=$;function je(e){return function(n){if(Array.isArray(n)){for(let e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ge(n,i){for(let t=0;t<i.length;t++){let e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}let Fe,Ue,Ve,He,Ye,qe=(Fe=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],Ue=function(){function u(e){var t=e.targetModal,n=e.triggers,n=void 0===n?[]:n,i=e.onShow,i=void 0===i?function(){}:i,o=e.onClose,o=void 0===o?function(){}:o,a=e.openTrigger,a=void 0===a?"data-micromodal-trigger":a,s=e.closeTrigger,s=void 0===s?"data-micromodal-close":s,l=e.disableScroll,l=void 0!==l&&l,r=e.disableFocus,r=void 0!==r&&r,c=e.awaitCloseAnimation,c=void 0!==c&&c,d=e.debugMode,d=void 0!==d&&d,e=e.closeByEsckey,e=void 0===e||e;if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");this.modal=document.getElementById(t),this.config={debugMode:d,disableScroll:l,openTrigger:a,closeTrigger:s,onShow:i,onClose:o,awaitCloseAnimation:c,disableFocus:r,closeByEsckey:e},0<n.length&&this.registerTriggers.apply(this,je(n)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}let e,t;return e=u,t=[{key:"registerTriggers",value:function(){for(let e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e.addEventListener("click",function(){return u.showModal()})})}},{key:"showModal",value:function(){this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(Y({"is-open":!0})),this.setFocusToFirstNode(),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){let t=this.modal;this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",function e(){t.classList.remove(Y({"is-open":!0})),t.removeEventListener("animationend",e,!1)},!1):t.classList.remove(Y({"is-open":!0}))}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){this.config.closeByEsckey&&27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){let t=this.modal.querySelectorAll(Fe);return Object.keys(t).map(function(e){return t[e]})}},{key:"setFocusToFirstNode",value:function(){if(!this.config.disableFocus){let e=this.getFocusableNodes();e.length&&e[0].focus()}}},{key:"maintainFocus",value:function(e){let t=this.getFocusableNodes();var n;this.modal.contains(document.activeElement)?(n=t.indexOf(document.activeElement),e.shiftKey&&0===n&&(t[t.length-1].focus(),e.preventDefault()),e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault())):t[0].focus()}}],Ge(e.prototype,t),u}(),Ve=null,He=function(e){if(!document.getElementById(e))return!1},Ye=function(e,t){if(e.length<=0&&(console.warn("MicroModal v".concat(version,": ❗Please specify at least one %c'micromodal-trigger'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>')),!t)return!0;for(var n in t)He(n);return!0},{init:function(e){let t=Object.assign({},{openTrigger:"data-micromodal-trigger"},e),n=je(document.querySelectorAll("[".concat(t.openTrigger,"]"))),i=function(e,n){let i=[];return e.forEach(function(e){var t=e.attributes[n].value;void 0===i[t]&&(i[t]=[]),i[t].push(e)}),i}(n,t.openTrigger);if(!0!==t.debugMode||!1!==Ye(n,i))for(var o in i){var a=i[o];t.targetModal=o,t.triggers=je(a),new Ue(t)}},show:function(e,t){let n=t||{};return n.targetModal=e,!0===n.debugMode&&!1===He(e)?Ve=null:(Ve=new Ue(n)).showModal(),Ve},close:function(){Ve.closeModal()}});const g={defaultControllers:{0:{0:{value:"88"},1:{value:"83"},2:{value:"16"},3:{value:"13"},4:{value:"38"},5:{value:"40"},6:{value:"37"},7:{value:"39"},8:{value:"90"},9:{value:"65"},10:{value:"81"},11:{value:"69"},12:{value:"82"},13:{value:"87"},14:{},15:{},16:{value:"72"},17:{value:"70"},18:{value:"71"},19:{value:"84"},20:{value:"76"},21:{value:"74"},22:{value:"75"},23:{value:"73"},24:{},25:{},26:{}},1:{},2:{},3:{}},controllers:{},virtualGamepadContainer:null,keyMap:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",27:"escape",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"left window key",92:"right window key",93:"select key",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num lock",145:"scroll lock",186:"semi-colon",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash",192:"grave accent",219:"open bracket",220:"back slash",221:"close braket",222:"single quote"},saveLoaddbDB:function(){try{return new Te({dbVersion:1,storePrefix:"ejs-",storeName:"states",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(e){console.log(e)}}(),saveLoadDB:function(n){try{if(!g.saveLoaddbDB.db)return!1;if(ne&&"function"==typeof ne.getCoreOptionsValues){var e=ne.getCoreOptionsValues()["save-state-location"];if(!e||"download"===e)return!1;if(!this.getStartName())return!1;var i=ne.getCoreOptionsValues()["save-state-slot"],o=this.getStartName();if(!i)return!1;let t=o+"-"+i;return async function(){if("save"===n)try{var e=await g.saveState();g.saveLoaddbDB.put(t,e)}catch(e){return}else g.saveLoaddbDB.get(t,function(e){EJS_loadState(e)})}(),!0}return!1}catch(e){return!1}},gamepad:null,allowCheat:!0,connection:null,connected:!1,playerName:"",players:[],waitingList:{},roomMaster:null,inputsData:{},coreOptionData:{},currentFrame:0,wait:!1,progressHelper:{},icons:{lock:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="lock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-lock fa-w-14 fa-3x"><path fill="currentColor" d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z" class=""></path></svg>'},isPaused:null,setVolume:null,setVariable:null,simulateInput:null,simulateInputFn:null,toggleShader:null,saveState:null,screenRecord:null,loadState:null,quickSaveState:null,quickLoadState:null,changeStateSlot:null,getScreenData:null,getStateInfo:null,setCheat:null,resetCheat:null,getGameCoreOptions:null,classNames:{"dialog-container":Y({"dialog-container":!0}),tabs:Y({tabs:!0}),"dialog-title":Y({"dialog-title":!0}),"dialog-content":Y({"dialog-content":!0}),"dialog-buttons":Y({"dialog-buttons":!0}),overlay:Y({overlay:!0}),"key-setting-popup":Y({"key-setting-popup":!0}),"tabs-panel":Y({"tabs-panel":!0}),"tabs-content":Y({"tabs-content":!0}),"button-container":Y({"button-container":!0}),set:Y({set:!0}),active:Y({active:!0}),"btn-cancel":Y({"btn-cancel":!0}),"btn-reset":Y({"btn-reset":!0}),"btn-clear":Y({"btn-clear":!0}),"btn-create":Y({"btn-create":!0}),"btn-submit":Y({"btn-submit":!0}),"btn-join-room":Y({"btn-join-room":!0}),"btn-quit":Y({"btn-quit":!0}),"btn-create-room":Y({"btn-create-room":!0}),modal:Y({modal:!0}),modal__overlay:Y({modal__overlay:!0}),modal__container:Y({modal__container:!0}),modal__header:Y({modal__header:!0}),modal__title:Y({modal__title:!0}),modal__close:Y({modal__close:!0}),modal__content:Y({modal__content:!0}),modal__btn:Y({modal__btn:!0}),"modal__btn-primary":Y({"modal__btn-primary":!0}),"micromodal-slide":Y({"micromodal-slide":!0}),modal__errmsg:Y({modal__errmsg:!0}),modal__footer:Y({modal__footer:!0}),"cheats-add":Y({"cheats-add":!0}),"cheats-list":Y({"cheats-list":!0}),"cheat-code-input":Y({"cheat-code-input":!0}),"cheat-name-input":Y({"cheat-name-input":!0}),"ejs-switch":Y({"ejs-switch":!0}),"ejs-delete-cheat":Y({"ejs-delete-cheat":!0})},initShaders:function(){for(let e=xe,t=Object.keys(e),n,i=0;i<t.length;i+=1)n=e[t[i]],v.FS.writeFile("/shader/".concat(t[i]),n),ne.storage.get("shader")===t[i]&&v.FS.writeFile("/shader/shader.glslp",n)},setGamepadDialog:function(){let l=this,n=(l.elements.dialogs.gamepad.innerHTML='\n        <div class="'+g.classNames["dialog-container"]+'">\n            <div class="'+g.classNames["dialog-title"]+'">\n                <h4>'+l.localization("Control Settings")+'</h4>\n            </div>\n            \n            <ul class="'+g.classNames.tabs+'" id="controls-tabs">\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-0" aria-selected="false" id="controls-0-label">'+l.localization("Player 1")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-1" aria-selected="false" id="controls-1-label">'+l.localization("Player 2")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-2" aria-selected="false" id="controls-2-label">'+l.localization("Player 3")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-3" aria-selected="false" id="controls-3-label">'+l.localization("Player 4")+'</a></li>\n            </ul>\n            <div class="'+g.classNames["dialog-content"]+'">\n            <div class="'+g.classNames["tabs-content"]+' controls">\n                \n            </div>\n            </div>\n            <div class="'+g.classNames["dialog-buttons"]+'">\n                <a href="#" onclick="return false" class="'+g.classNames["btn-submit"]+'">'+l.localization("Update")+'</a>\n                <a href="#" onclick="return false" class="'+g.classNames["btn-reset"]+'">'+l.localization("Reset")+'</a>\n                <a href="#" onclick="return false" class="'+g.classNames["btn-clear"]+'">'+l.localization("Clear")+'</a>\n                <a href="#" onclick="return false" class="'+g.classNames["btn-cancel"]+'">'+l.localization("Cancel")+'</a>\n            </div>\n            <div class="'+g.classNames.overlay+'" hidden>\n                <div class="'+g.classNames["key-setting-popup"]+'">\n                    <span>[Select]</span><br />\n                    <div style="color:#fff !important">'+l.localization("Press keyboard or gamepad")+"</div>\n                </div>\n            </div>\n        </div>\n        ",'\n        <div class="'.concat(g.classNames["tabs-panel"],'" id="controls-{index}" hidden>\n            <div>\n                <div style="">\n                    <div class="gamepad" style="font-size:12px">Connected gamepad: <span class="gamepad-name">n/a</span></div>\n                </div>\n                <div style="width:25%;float:left">&nbsp;</div>\n                <div style="font-size:12px;width:50%;float:left">\n                    <div class="row">\n                        <div style="text-align:center;width:50%;float:left">'+l.localization("Gamepad")+'</div>\n                        <div style="text-align:center;width:50%;float:left">'+l.localization("Keyboard")+'</div>\n                    </div>\n                </div>\n                <div style="clear:both"></div>\n            </div>\n        </div>')),i='\n        <div class="'.concat(g.classNames["button-container"],'" data-id="{id}" data-index="{index}" data-label="{label}" style="margin-bottom:10px">\n            <div style="width:25%;float:left;font-size:12px">\n                <label>{label}:</label>\n            </div>\n            <div style="width:50%;float:left">\n                <div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="2" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="1" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="clear:both"></div>\n                </div>\n            </div>\n            <div style="width:25%;float:left">\n                <a class="').concat(g.classNames.set,'" href="#" onclick="return false">'+l.localization("Set")+'</a>\n            </div>\n            <div style="clear:both"></div>\n        </div>'),o;"nes"===l.system?o={0:"B",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",24:l.localization("QUICK SAVE STATE"),25:l.localization("QUICK LOAD STATE"),26:l.localization("CHANGE STATE SLOT")}:"snes"===l.system?o={0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",24:l.localization("QUICK SAVE STATE"),25:l.localization("QUICK LOAD STATE"),26:l.localization("CHANGE STATE SLOT")}:"n64"===l.system?(o={0:"B",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",10:"L",11:"R",12:"Z",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:l.localization("QUICK SAVE STATE"),25:l.localization("QUICK LOAD STATE"),26:l.localization("CHANGE STATE SLOT")},2===l.coreVer&&(o[0]="A",o[1]="B",delete o[8])):o="nds"===l.system?{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",14:"Microphone",24:l.localization("QUICK SAVE STATE"),25:l.localization("QUICK LOAD STATE"),26:l.localization("CHANGE STATE SLOT")}:{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",12:"L2",13:"R2",14:"L3",15:"R3",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:l.localization("QUICK SAVE STATE"),25:l.localization("QUICK LOAD STATE"),26:l.localization("CHANGE STATE SLOT")},["arcade","mame"].includes(l.system)&&(o[2]=l.localization("INSERT COIN")),!1===l.statesSupported&&(delete o[24],delete o[25],delete o[26]);for(let e=[2,3,4,5,6,7,8,0,9,1,10,11,12,13,14,15,19,18,17,16,23,22,21,20,24,25,26],t=0;t<=3;t+=1)!function(t){l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames["tabs-content"])).innerHTML+=n.replace(/{index}/g,t),e.forEach(function(e){o[e]&&(l.elements.dialogs.gamepad.querySelector("#controls-".concat(t)).innerHTML+=i.replace(/{index}/g,t).replace(/{id}/g,e).replace(/{label}/g,o[e]))}),l.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),l.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(t,'"][data-type="2"]'))&&(l.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc")}(t);Object.keys(g.controllers).forEach(function(i){g.controllers[i]&&Object.keys(g.controllers[i]).forEach(function(e){let t=l.elements.dialogs.gamepad.querySelector('[data-id="'.concat(e,'"][data-index="').concat(i,'"][data-type="1"]')),n=l.elements.dialogs.gamepad.querySelector('[data-id="'.concat(e,'"][data-index="').concat(i,'"][data-type="2"]'));if(!t||!n)return!1;e=g.controllers[i][e];e&&(e.type&&1!==parseInt(e.type,10)?n.value="":e.value&&(t.value=g.keyMap[e.value]||"",t.setAttribute("data-value",e.value)),e.value2&&(n.value=isNaN(e.value2)?e.value2:"button ".concat(parseInt(e.value2,10)+1),n.setAttribute("data-value",e.value2)))})}),j.call(this,l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames["btn-submit"])),"click",function(e){let t=l.elements.dialogs.gamepad.querySelectorAll("input"),o={};return Array.from(t).forEach(function(e){let t,n=e.getAttribute("data-index"),i=e.getAttribute("data-value");2===parseInt(e.getAttribute("data-type"),10)&&(t=e.getAttribute("data-value"));e=e.getAttribute("data-id");o[n]||(o[n]={}),o[n][e]||(o[n][e]={}),i&&(o[n][e].value=i),t&&(o[n][e].value2=t)}),ne.storage.set({controllers:o}),g.controllers=o,U(l.elements.dialogs.gamepad,!0),l.elements.container.focus(),e.stopPropagation(),!1}),j.call(this,l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames["btn-reset"])),"click",function(e){g.controllers=JSON.parse(JSON.stringify(g.defaultControllers)),localStorage.removeItem(ne.storage.key);let t=l.elements.dialogs.gamepad.querySelectorAll("input");for(let e=0;e<t.length;e++){var n=t[e].getAttribute("data-index"),i=t[e].getAttribute("data-type"),o=t[e].getAttribute("data-id"),a=1==i?"value":"value2";g.defaultControllers[n]&&g.defaultControllers[n][o]&&g.defaultControllers[n][o][a]?(t[e].value=1==i?g.keyMap[g.defaultControllers[n][o][a]]:"button "+(parseInt(g.defaultControllers[n][o][a])+1),t[e].setAttribute("data-value",g.defaultControllers[n][o][a])):(t[e].value="",t[e].setAttribute("data-value",""))}}),j.call(this,l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames["btn-clear"])),"click",function(e){let t={0:{},1:{},2:{},3:{}};for(var n in o)t[0][n]={},t[1][n]={},t[2][n]={},t[3][n]={};g.controllers=t,localStorage.setItem(ne.storage.key,JSON.stringify({controllers:g.controllers}));let i=l.elements.dialogs.gamepad.querySelectorAll("input");for(let e=0;e<i.length;e++)i[e].value="",i[e].setAttribute("data-value","")}),j.call(this,l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames["btn-cancel"])),"click",function(e){return U(l.elements.dialogs.gamepad,!0),l.elements.container.focus(),e.stopPropagation(),!1}),Array.from(l.elements.dialogs.gamepad.querySelectorAll(".".concat(g.classNames.tabs," li"))).forEach(function(n){j.call(l,n,"mousedown",function(e){V(l.elements.dialogs.gamepad.querySelectorAll(".".concat(g.classNames.tabs," li")),g.classNames.active,!1),V(n,g.classNames.active,!0);var t=n.querySelector("a").getAttribute("aria-controls");return Array.from(l.elements.dialogs.gamepad.querySelectorAll(".".concat(g.classNames["tabs-content"]," .").concat(g.classNames["tabs-panel"]))).forEach(function(e){U(e,!0)}),U(l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames["tabs-content"]," #").concat(t)),!1),e.stopPropagation(),!1})}),G.call(l,l.elements.dialogs.gamepad.querySelector('[aria-controls="controls-0"]').parentNode,"mousedown");let r=l.elements.dialogs.gamepad.querySelector(".".concat(g.classNames.overlay));j.call(l,r,"mousedown",function(e){U(r,!0),e.stopPropagation()}),Array.from(l.elements.dialogs.gamepad.querySelectorAll(".".concat(g.classNames["button-container"]))).forEach(function(t){j.call(l,t,"mousedown",function(e){G.call(l,t.querySelector("a.".concat(g.classNames.set)),e.type,!0,{})})}),Array.from(l.elements.dialogs.gamepad.querySelectorAll(".".concat(g.classNames["tabs-panel"]," a.").concat(g.classNames.set))).forEach(function(s){j.call(l,s,"mousedown",function(e){let t=s.parentNode.parentNode,n=t.getAttribute("data-id"),i=t.getAttribute("data-index"),o=t.getAttribute("data-label"),a=(U(r,!1),r.setAttribute("data-id",n),r.setAttribute("data-index",i),"[ ".concat(o," ]"));g.gamepad.gamepads[i]&&n<16?a+='<br /><span style="font-size:12px">Gamepad:'.concat(g.gamepad.gamepads[i].id,"</span><br />"+l.localization("Press keyboard or gamepad")+"<br/>"+l.localization("Press escape (esc) to clear")):a+="<br />Press keyboard<br/>"+l.localization("Press escape (esc) to clear"),r.querySelector(".".concat(g.classNames["key-setting-popup"])).innerHTML=a,e.stopPropagation()})})},setCacheDialog:function(){let t=this;t.elements.dialogs.cache.innerHTML='\n        <div class="'.concat(g.classNames["dialog-container"],'">\n            <div class="').concat(g.classNames["dialog-title"],'">\n                <h4>'+t.localization("Cache Manager")+'</h4>\n            </div>\n            <div class="').concat(g.classNames["dialog-content"],'">\n\n            </div>\n            <div class="').concat(g.classNames["dialog-buttons"],'">\n                <a href="#" onclick="return false" class="').concat(g.classNames["btn-cancel"],'">'+t.localization("Close")+"</a>\n            </div>\n        </div>\n        "),j.call(this,t.elements.dialogs.cache.querySelector(".".concat(g.classNames["btn-cancel"])),"click",function(e){return U(t.elements.dialogs.cache,!0),t.elements.container.focus(),e.stopPropagation(),!1}),j.call(this,t.elements.dialogs.cache.querySelector(".".concat(g.classNames["dialog-title"]," a")),"click",function(e){return v.romdb&&(v.romdb.clear(),t.elements.dialogs.cache.querySelector(".".concat(g.classNames["dialog-content"])).innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"),e.stopPropagation(),!1})},showLoading:function(e){qe.show("modal-6ed698f3d04061f5",{closeByEsckey:!1}),e&&console.log(""),U(this.elements.dialogs.loading,!1)},hideLoading:function(){qe.close(),U(this.elements.dialogs.loading,!0)},setLoadingDialog:function(){this.elements.dialogs.loading&&(this.elements.dialogs.loading.innerHTML='\n            <div class="'.concat(g.classNames.modal," ").concat(g.classNames["micromodal-slide"],'" id="modal-6ed698f3d04061f5" aria-hidden="true">\n                <div class="').concat(g.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(g.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-6ed698f3d04061f5-title">\n                '+this.localization("Loading")+"...\n                </div>\n                </div>\n            </div>"))},setCheatDialog:function(){let s=this;if(s.elements.dialogs.cheat){s.elements.dialogs.cheat.innerHTML='\n            <div class="'.concat(g.classNames["dialog-container"],'">\n                <div class="').concat(g.classNames["dialog-title"],'">\n                    <h4>Cheats</h4>\n                </div>\n                <div class="').concat(g.classNames["dialog-content"],'">\n                    <div class="').concat(g.classNames["cheats-list"],'">\n                        \n                    </div>\n                </div>\n                <div class="').concat(g.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(g.classNames["cheats-add"],'">'+s.localization("Add Cheat")+'</a>\n                    <a href="#" onclick="return false" class="').concat(g.classNames["btn-submit"],'">'+s.localization("OK")+'</a>\n                    <a href="#" onclick="return false" class="').concat(g.classNames["btn-cancel"],'">Close</a>\n                </div>\n            </div>\n\n            \n\n            <div class="').concat(g.classNames.modal," ").concat(g.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484b" aria-hidden="true">\n                <div class="').concat(g.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(g.classNames.modal__container,'" style="width:100%" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484b-title">\n                    <div class="').concat(g.classNames.modal__header,'">\n                    <h2 class="').concat(g.classNames.modal__title,'" id="modal-85cd7a1c543a484b-title">\n                    '+s.localization("Add Cheat Code")+'\n                    </h2>\n                    <button class="').concat(g.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(g.classNames.modal__content,'" id="modal-85cd7a1c543a484b-content">\n\n                        <div class="').concat(g.classNames.modal__errmsg,'"></div>\n                        <strong>'+s.localization("Code")+'</strong><br />\n                        <textarea style="width:100%;height:80px;" class="').concat(g.classNames["cheat-code-input"],'"></textarea><br />\n                        <strong>'+s.localization("Description")+'</strong><br />\n                        <input type="text" class="').concat(g.classNames["cheat-name-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(g.classNames.modal__footer,'">\n                    <button class="').concat(g.classNames.modal__btn," ").concat(g.classNames["modal__btn-primary"],'">'+s.localization("Submit")+'</button>\n                    <button class="').concat(g.classNames.modal__btn,'" data-modal-close aria-label="Close">'+s.localization("Close")+"</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            ");let o=s.elements.dialogs.cheat.querySelector("#modal-85cd7a1c543a484b"),a=(j.call(this,s.elements.dialogs.cheat.querySelector(".".concat(g.classNames["cheats-add"])),"click",function(e){return qe.show("modal-85cd7a1c543a484b",{closeTrigger:"data-modal-close"}),!1}),s.elements.dialogs.cheat.querySelector(".".concat(g.classNames["cheats-list"]))),i=(j.call(this,o.querySelector(".".concat(g.classNames["modal__btn-primary"])),"click",function(e){var t=o.querySelector(".".concat(g.classNames["cheat-name-input"])).value,n=o.querySelector(".".concat(g.classNames["cheat-code-input"])).value;if(t&&n){let e=a.querySelectorAll("input:checked");o.querySelector(".".concat(g.classNames["cheat-name-input"])).value="",o.querySelector(".".concat(g.classNames["cheat-code-input"])).value="",qe.close();var i=s.cheats.length;s.cheats.push([t,n]),a.innerHTML+='<div class="'.concat(g.classNames["ejs-switch"],'">\n                            <input type="checkbox" value="').concat(i,'" id="ejs-cheat-switch-').concat(i,'">\n                            <label for="ejs-cheat-switch-').concat(i,'">').concat(t,'</label>\n                            <a href="#" data-idx="').concat(i,'" onclick="return false" class="').concat(g.classNames["ejs-delete-cheat"],'">&times;</a>\n                        </div>'),e.forEach(function(e,t){a.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")})}return"localStorage"in window&&s.getStartName()&&(localStorage.setItem("".concat(s.system,"-").concat(s.getStartName(),"-cheats"),JSON.stringify(s.cheats)),e.stopPropagation()),!1}),function(){if("localStorage"in window&&s.getStartName()){let e=localStorage.getItem("".concat(s.system,"-").concat(s.getStartName(),"-cheats"));try{e=JSON.parse(e)}catch(e){}e&&(s.cheats=e)}a.innerHTML="",s.cheats&&Array.isArray(s.cheats)&&s.cheats.forEach(function(e,t){var n=e[0];e[1],a.innerHTML+='<div class="'.concat(g.classNames["ejs-switch"],'">\n                                <input type="checkbox" value="').concat(t,'" id="ejs-cheat-switch-').concat(t,'">\n                                <label for="ejs-cheat-switch-').concat(t,'">').concat(n,'</label>\n                                <a href="#" data-idx="').concat(t,'" onclick="return false" class="').concat(g.classNames["ejs-delete-cheat"],'">&times;</a>\n                            </div>')})});j.call(s,a,"click",function(e){if(e.target&&e.target.classList.contains(g.classNames["ejs-delete-cheat"])&&e.target.getAttribute("data-idx")){var t=e.target.getAttribute("data-idx");s.cheats.splice(t,1),"localStorage"in window&&s.getStartName()&&localStorage.setItem("".concat(s.system,"-").concat(s.getStartName(),"-cheats"),JSON.stringify(s.cheats));let n=[];a.querySelectorAll("input").forEach(function(e,t){n[t]=!!a.querySelector("#ejs-cheat-switch-".concat(t,":checked"))}),n.splice(t,1),i(),n.forEach(function(e,t){e&&a.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")})}return e.stopPropagation(),!1}),j.call(s,s.elements.container,"start-game",function(e){i()}),j.call(this,s.elements.dialogs.cheat.querySelector(".".concat(g.classNames["btn-cancel"])),"click",function(e){return U(s.elements.dialogs.cheat,!0),e.stopPropagation(),s.elements.container.focus(),!1}),j.call(this,s.elements.dialogs.cheat.querySelector(".".concat(g.classNames["btn-submit"])),"click",function(e){return g.resetCheat(),a.querySelectorAll("input:checked").forEach(function(e,t){e=s.cheats[e.value];e&&g.setCheat(t,1,e[1])}),U(s.elements.dialogs.cheat,!0),s.elements.container.focus(),!1}),"arcade"!==s.system&&"mame"!==s.system&&"mame2003"!==s.system&&"mame2010"!==s.system||(B.element(s.elements.buttons.cheat)&&U(s.elements.buttons.cheat,!0),g.allowCheat=!1),g.setCheat||(U(s.elements.buttons.cheat,!0),g.allowCheat=!1)}},initKeyboard:function(){let t=this,o=this,a=this.elements.dialogs.gamepad.querySelector(".".concat(g.classNames.overlay));j.call(this,document.body,"keydown keyup",function(i){if(!(112<=i.which&&i.which<=123)){let e=!t.elements.dialogs.gamepad.hidden&&!a.hidden,n="keydown"===i.type;if(n&&e){let e=a.getAttribute("data-index"),t=a.getAttribute("data-id"),n=null;if(i.key&&"escape"===g.keyMap[i.keyCode])return(n=o.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(e,'"][data-type="1"]'))).setAttribute("data-value",""),n.value=""(n=o.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(e,'"][data-type="2"]'))).setAttribute("data-value",""),n.value="",void U(a,!0);e=a.getAttribute("data-index"),t=a.getAttribute("data-id"),n=null,i.key&&((n=o.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(e,'"][data-type="1"]'))).setAttribute("data-value",i.keyCode),n.value=g.keyMap[i.keyCode]),U(a,!0)}else Object.keys(g.controllers).forEach(function(t){Object.keys(g.controllers[t]).forEach(function(e){parseInt(g.controllers[t][e].value,10)===i.keyCode&&["24","25","26"].includes(e)&&"keydown"==i.type&&!i.repeat&&("24"==e?g.quickSaveState():"25"==e?g.quickLoadState():"26"==e&&g.changeStateSlot()),parseInt(g.controllers[t][e].value,10)===i.keyCode&&(n?16<=e&&e<=23?g.simulateInput(t,e,32767):g.simulateInput(t,e,1):g.simulateInput(t,e,0))})})}}),document.body.addEventListener("keydown",function(e){var t=e.keyCode||e.which;[32,37,38,39,40,112,113,114,115,116,117,118,119,120,121,122,123].includes(t)&&e.srcElement===o.elements.container&&e.preventDefault(),e.srcElement.className.split(/ +/).includes(g.classNames.set)&&e.preventDefault()})},initGamepad:function(){let l=this,o=this,r=this.elements.dialogs.gamepad.querySelector(".".concat(g.classNames.overlay)),n;try{n=new _e}catch(e){return void console.warn("gamepad not supported")}(g.gamepad=n).on("buttondown",function(n){if(l.elements.dialogs.gamepad.hidden||r.hidden)Object.keys(g.controllers[n.gamepadIndex.toString()]).forEach(function(e){var t=n.gamepadIndex.toString();parseInt(g.controllers[t][e].value2,10)===parseInt(n.index,10)&&["24","25","26"].includes(e)&&("24"==e?g.quickSaveState():"25"==e?g.quickLoadState():"26"==e&&g.changeStateSlot()),parseInt(g.controllers[t][e].value2,10)===parseInt(n.index,10)&&parseInt(t,10)===parseInt(n.gamepadIndex,10)&&g.simulateInput(t,e,1)});else{var t=parseInt(r.getAttribute("data-index"),10),i=r.getAttribute("data-id");if(n.gamepadIndex===parseInt(t,10)){let e=null;(e=o.elements.dialogs.gamepad.querySelector('[data-id="'.concat(i,'"][data-index="').concat(t,'"][data-type="2"]'))).setAttribute("data-value",n.index),e.value="button ".concat(n.index+1),U(r,!0)}}}),n.on("buttonup",function(n){Object.keys(g.controllers).forEach(function(t){Object.keys(g.controllers[t]).forEach(function(e){parseInt(g.controllers[t][e].value2,10)===parseInt(n.index,10)&&parseInt(t,10)===parseInt(n.gamepadIndex,10)&&g.simulateInput(t,e,0)})})}),n.on("axischanged",function(n){var i=.5<(t=n.value)||t<-.5?0<t?1:-1:0;if(l.elements.dialogs.gamepad.hidden||r.hidden){g.prevButtons||(g.prevButtons={});let t=!1;var o=n.gamepadIndex.toString();g.prevButtons[o]||(g.prevButtons[o]={}),g.prevButtons[o][n.axis]||(g.prevButtons[o][n.axis]=0),g.prevButtons[o].buttonID||(g.prevButtons[o].buttonID=0);for(let e=0;e<Object.keys(g.controllers[o]).length;e++){var a=Object.keys(g.controllers[o])[e];g.controllers[o][a].value2&&(g.controllers[o][a].value2.split(":")[0]===n.axis&&parseInt(g.controllers[o][a].value2.split(":")[1])===i&&["24","25","26"].includes(a)&&("24"==a?(t=!0,g.quickSaveState()):"25"==a?(t=!0,g.quickLoadState()):"26"==a&&g.changeStateSlot()),0==i?g.controllers[o][a].value2.split(":")[0]===n.axis&&(g.prevButtons[o][n.axis]=i,g.prevButtons[o].buttonID=a,g.simulateInput(o,a,0)):((1===g.prevButtons[o][n.axis]&&-1==i||-1===g.prevButtons[o][n.axis]&&1==i)&&g.simulateInput(o,g.prevButtons[o].buttonID,0),g.controllers[o][a].value2.split(":")[0]===n.axis&&parseInt(g.controllers[o][a].value2.split(":")[1])===i&&(g.prevButtons[o][n.axis]=i,g.prevButtons[o].buttonID=a,t=!0,g.simulateInput(o,a,1))))}if(t)return;if(!l.elements.dialogs.gamepad.hidden&&!r.hidden)return}else if(0!=i){var t=r.getAttribute("data-id"),s=parseInt(r.getAttribute("data-index"),10);let e=l.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(s,'"][data-type="2"]'));e.setAttribute("data-value",n.axis+":"+i),e.value=n.axis+":"+i,U(r,!0)}Math.abs(n.value)<=.1&&(n.value=0);t=n.gamepadIndex;l.coreVer;"LEFT_STICK_X"===n.axis?0<n.value?(g.simulateInput(t,16,32767*n.value),g.simulateInput(t,17,0)):(g.simulateInput(t,17,-32767*n.value),g.simulateInput(t,16,0)):"LEFT_STICK_Y"===n.axis?0<n.value?(g.simulateInput(t,18,32767*n.value),g.simulateInput(t,19,0)):(g.simulateInput(t,19,-32767*n.value),g.simulateInput(t,18,0)):"RIGHT_STICK_X"===n.axis?0<n.value?(g.simulateInput(t,20,32767*n.value),g.simulateInput(t,21,0)):(g.simulateInput(t,21,-32767*n.value),g.simulateInput(t,20,0)):"RIGHT_STICK_Y"===n.axis&&(0<n.value?(g.simulateInput(t,22,32767*n.value),g.simulateInput(t,23,0)):(g.simulateInput(t,23,32767*n.value),g.simulateInput(t,22,0)))}),n.on("disconnected",function(e){[0,1,2,3].forEach(function(e){var t=n.gamepads[e];o.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=t?t.id:"n/a"})}),n.on("connected",function(e){Object.keys(n.gamepads).forEach(function(e){var t=n.gamepads[e];o.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=t?t.id:"n/a"})})},setShader:function(e){"disabled"===e?(v.FS.unlink("/shader/shader.glslp",""),g.toggleShader&&g.toggleShader(0)):(g.toggleShader&&g.toggleShader(0),e="/shader/".concat(e),v.FS.writeFile("/shader/shader.glslp",v.FS.readFile(e)),g.toggleShader&&g.toggleShader(1))},toggleVirtualGamepad:function(r){let c=this;if(null!==g.virtualGamepadContainer)U(g.virtualGamepadContainer,!r);else{g.virtualGamepadContainer=F("div",{class:Y({"ejs-virtual-gamepad":!0}),hidden:""}),this.elements.container.appendChild(g.virtualGamepadContainer);var d="height:31px;text-align:center;border:1px solid #ccc;border-radius:5px;line-height:31px;";let i="",o;c.config.VirtualGamepadSettings&&function(t){if(Array.isArray(t)){if(t.length){for(let e=0;e<t.length;e++)if("zone"!==t[e].type){if(!t[e].location)return void console.warn("Missing location value for button "+t[e].text+"! Using default gamepad settings");if(!t[e].type)return void console.warn("Missing type value for button "+t[e].text+"! Using default gamepad settings");if(!t[e].id.toString())return void console.warn("Missing id value for button "+t[e].text+"! Using default gamepad settings");if(!t[e].input_value.toString())return void console.warn("Missing input_value for button "+t[e].text+"! Using default gamepad settings")}return 1}console.warn("Vritual gamepad settings is empty! Using default gamepad settings")}else console.warn("Vritual gamepad settings is not array! Using default gamepad settings")}(c.config.VirtualGamepadSettings)?o=c.config.VirtualGamepadSettings:["gba","gb","vb","nes"].includes(c.system)?(o=[{type:"button",text:"B",id:"b",location:"right",left:-10,top:70,bold:!0,input_value:0},{type:"button",text:"A",id:"a",location:"right",left:60,top:70,bold:!0,input_value:8},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:60,fontSize:15,block:!0,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,fontSize:15,block:!0,input_value:2}],"gba"===c.system&&(o.push({type:"button",text:"L",id:"l",block:!0,location:"top",left:10,top:-40,bold:!0,input_value:10}),o.push({type:"button",text:"R",id:"r",block:!0,location:"top",right:10,top:-40,bold:!0,input_value:11}))):o="n64"===c.system?[{type:"button",text:"B",id:"b",location:"right",left:-10,top:95,input_value:0,bold:!0,input_new_cores:1},{type:"button",text:"A",id:"a",location:"right",left:40,top:150,input_value:8,bold:!0,input_new_cores:0},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:30,top:-10,fontSize:15,block:!0,input_value:3},{type:"button",text:"L",id:"l",block:!0,location:"top",left:10,top:-40,bold:!0,input_value:10},{type:"button",text:"R",id:"r",block:!0,location:"top",right:10,top:-40,bold:!0,input_value:11},{type:"button",text:"Z",id:"z",block:!0,location:"top",left:10,bold:!0,input_value:12},{type:"button",text:"",id:"cu",location:"right",left:25,top:-65,input_value:23},{type:"button",text:"",id:"cd",location:"right",left:25,top:15,input_value:22},{type:"button",text:"",id:"cl",location:"right",left:-15,top:-25,input_value:21},{type:"button",text:"",id:"cr",location:"right",left:65,top:-25,input_value:20}]:["snes","nds"].includes(c.system)?[{type:"button",text:"X",id:"x",location:"right",left:40,bold:!0,input_value:9},{type:"button",text:"Y",id:"y",location:"right",top:40,bold:!0,input_value:1},{type:"button",text:"A",id:"a",location:"right",left:81,top:40,bold:!0,input_value:8},{type:"button",text:"B",id:"b",location:"right",left:40,top:80,bold:!0,input_value:0},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:60,fontSize:15,block:!0,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,fontSize:15,block:!0,input_value:2}]:[{type:"button",text:"Y",id:"y",location:"right",left:40,bold:!0,input_value:9},{type:"button",text:"X",id:"X",location:"right",top:40,bold:!0,input_value:1},{type:"button",text:"B",id:"b",location:"right",left:81,top:40,bold:!0,input_value:8},{type:"button",text:"A",id:"a",location:"right",left:40,top:80,bold:!0,input_value:0},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:60,fontSize:15,block:!0,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,fontSize:15,block:!0,input_value:2}],i=(i+='<div class="'+Y({"virtual-gamepad":!0})+'" style="display: block;">')+('<div class="'+Y({top:!0})+'">');for(let n=0;n<o.length;n++)if("top"===o[n].location&&"button"===o[n].type){let e={buttons:!0},t=(e["b_"+o[n].id.toLowerCase()]=!0,"");o[n].left&&(t+="left:"+o[n].left+"px;"),o[n].right&&(t+="right:"+o[n].right+"px;"),o[n].top&&(t+="top:"+o[n].top+"px;"),o[n].bold?o[n].bold&&(t+="font-weight:bold;"):t+="font-weight:normal;",o[n].fontSize=o[n].fontSize||30,t+="font-size:"+o[n].fontSize+"px;",o[n].block&&(t+=d),i+='<div class="'+Y(e)+'" style="'+t+'">'+o[n].text+"</div>"}i=(i+="</div>")+('<div class="'+Y({left:!0})+'">');for(let n=0;n<o.length;n++)if("left"===o[n].location&&"button"===o[n].type){let e={buttons:!0},t=(e["b_"+o[n].id.toLowerCase()]=!0,"");o[n].left&&(t+="left:"+o[n].left+"px;"),o[n].right&&(t+="right:"+o[n].right+"px;"),o[n].top&&(t+="top:"+o[n].top+"px;"),o[n].block&&(t+=d),o[n].bold?o[n].bold&&(t+="font-weight:bold;"):t+="font-weight:normal;",o[n].fontSize=o[n].fontSize||30,t+="font-size:"+o[n].fontSize+"px;",i+='<div class="'+Y(e)+'" style="'+t+'">'+o[n].text+"</div>"}i=(i+="</div>")+('<div class="'+Y({center:!0})+'">');for(let n=0;n<o.length;n++)if("center"===o[n].location&&"button"===o[n].type){let e={buttons:!0},t=(e["b_"+o[n].id.toLowerCase()]=!0,"");o[n].left&&(t+="left:"+o[n].left+"px;"),o[n].right&&(t+="right:"+o[n].right+"px;"),o[n].top&&(t+="top:"+o[n].top+"px;"),o[n].block&&(t+=d),o[n].bold?o[n].bold&&(t+="font-weight:bold;"):t+="font-weight:normal;",o[n].fontSize=o[n].fontSize||30,t+="font-size:"+o[n].fontSize+"px;",i+='<div class="'+Y(e)+'" style="'+t+'">'+o[n].text+"</div>"}i=(i+="</div>")+('<div class="'+Y({right:!0})+'">');for(let n=0;n<o.length;n++)if("right"===o[n].location&&"button"===o[n].type){let e={buttons:!0},t=(e["b_"+o[n].id.toLowerCase()]=!0,"");o[n].left&&(t+="left:"+o[n].left+"px;"),o[n].right&&(t+="right:"+o[n].right+"px;"),o[n].top&&(t+="top:"+o[n].top+"px;"),o[n].block&&(t+=d),o[n].bold?o[n].bold&&(t+="font-weight:bold;"):t+="font-weight:normal;",o[n].fontSize=o[n].fontSize||30,t+="font-size:"+o[n].fontSize+"px;",i+='<div class="'+Y(e)+'" style="'+t+'">'+o[n].text+"</div>"}i+="</div></div>",g.virtualGamepadContainer.innerHTML=i,U(g.virtualGamepadContainer,!r);let n=Y({"virtual-gamepad":!0}),a=Y({touch:!0});q.isIos||j.call(this,H.call(this,".".concat(n)),"touchmove",function(e){e.stopPropagation()});let s;for(let e=0;e<o.length;e++)if("zone"===o[e].type){s=o[e];break}if(s){let e={},t=(e[s.location.toLowerCase()]=!0,ye.a.create({zone:H.call(this,".".concat(Y({"ejs-virtual-gamepad":!0})," .").concat(Y(e))),mode:"static",position:{left:s.left,top:s.top},color:"red"}));function u(){if("n64"!==c.system)return{downVal:1,4:4,5:5,6:6,7:7};{let e;return"d-pad"===(e=ne&&"function"==typeof ne.getCoreOptionsValues?ne.getCoreOptionsValues()["joystick-input"]:e)?{downVal:1,4:4,5:5,6:6,7:7}:{downVal:32767,4:19,5:18,6:17,7:16}}}t.on("end",function(e,t){g.syncInput(0,u()[4],0),g.syncInput(0,u()[5],0),g.syncInput(0,u()[6],0),g.syncInput(0,u()[7],0)}),t.on("move",function(e,t){t=t.angle.degree;30<=t&&t<150?g.syncInput(0,u()[4],u().downVal):window.setTimeout(function(){g.syncInput(0,u()[4],0)},30),210<=t&&t<330?g.syncInput(0,u()[5],u().downVal):window.setTimeout(function(){g.syncInput(0,u()[5],0)},30),120<=t&&t<240?g.syncInput(0,u()[6],u().downVal):window.setTimeout(function(){g.syncInput(0,u()[6],0)},30),300<=t||0<=t&&t<60?g.syncInput(0,u()[7],u().downVal):window.setTimeout(function(){g.syncInput(0,u()[7],0)},30)})}let l=[];for(let n=0;n<o.length;n++)if("zone"!==o[n].type){let e={};e["b_"+o[n].id.toLowerCase()]=!0;let t;t=2===c.newCores&&o[n].input_new_cores?o[n].input_new_cores:o[n].input_value,l.push({id:e,number:t})}l.forEach(t=>{var e=H.call(c,".".concat(n," .").concat(Y(t.id)));e&&j.call(c,e,"touchstart touchend",function(e){"touchend"===e.type?(V(e.target,a,!1),window.setTimeout(function(){g.syncInput(0,t.number,0)},30)):(V(e.target,a,!0),g.syncInput(0,t.number,1)),e.stopPropagation()})});let e=F("div",{class:Y({ejs__widget:!0,ejs__widget_controls_toggle:!0})},"");e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>',H.call(this,".".concat(Y({ejs__widgets:!0}))).appendChild(e);let t;j.call(this,e,"mousedown touchstart",function(e){V(e.target,a,!0),clearTimeout(t),J.toggleControls.call(c,!0),t=setTimeout(function(){J.toggleControls.call(c,!1)},5e3)})}},setup:function(){let i=this;if(this.game){var e;if(g.playerName=i.config.playerName,V(this.elements.container,this.config.classNames.type,!0),this.elements.container.setAttribute("tabindex","0"),!this.color||(e=function(e){let n=e.toLowerCase();if(n&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(n)){if(4===n.length){for(let e="#",t=1;t<4;t+=1)e+=n.slice(t,t+1).concat(n.slice(t,t+1));n=s}for(let e=[],t=1;t<7;t+=2)e.push(parseInt("0x".concat(n.slice(t,t+2)),16));return _0x5ac4ff}return null}(this.color))&&this.elements.container.setAttribute("style","--ejs-primary-color: ".concat(e[0],", ").concat(e[1],", ").concat(e[2])),this.elements.wrapper=F("div",{class:this.config.classNames.video}),R(this.game,this.elements.wrapper),"video"!==i.game.tagName.toLocaleLowerCase()){let t=this.config.volume,n=(Object.defineProperty(i.game,"volume",{get:function(){return t},set:function(e){t=e,G.call(i,i.game,"volumechange")}}),i.storage.get("muted"));Object.defineProperty(i.game,"muted",{get:function(){return n},set:function(e){e=!!B.boolean(e)&&e;n=e,G.call(i,i.game,"volumechange")}})}window.addEventListener("beforeunload",function(e){i.started&&i.getStartName()&&(v.FS.syncfs(function(){}),g.saveSavFiles(),v.FS.syncfs(function(){}))},!0),window.saveSaveFiles=function(){i.getStartName()&&(console.log("saving save files"),g.saveSavFiles(),v.FS.syncfs(!1,function(){}))},setInterval(function(){i.started&&saveSaveFiles()},3e5)}else console.warn("No game element found!")},listeners:function(){let a=this;a.elements.buttons.restart&&j.call(a,a.elements.buttons.restart,"click",function(e){g.restartGame(),g.inputsData={},saveSaveFiles()}),a.elements.buttons.screenRecord&&j.call(a,a.elements.buttons.screenRecord,"click",function(e){if(a.recordData||(a.recordData={started:!1,data:[],stopped:!1}),a.recordData.started)a.recordData.started&&(a.recordData.recorder.stop(),a.recordData.stopped=!0);else{let n;n=MediaRecorder.isTypeSupported("video/webm; codecs=h264")?{mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/webm; codecs=H264")?{mimeType:"video/webm; codecs=H264"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?{mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8")?{mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm; codecs=avc1")?{mimeType:"video/webm; codecs=avc1"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9.0")?{mimeType:"video/webm; codecs=vp9.0"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8.0")?{mimeType:"video/webm; codecs=vp8.0"}:{},v.Module.pauseMainLoop(),a.playing=!1,alert('please check "share system audio" to have audio in the recording. We only need the audio stream so your entire screen will not be recorded');let i=v.Module.canvas.captureStream(30),o=setTimeout(function(){a.playing=!0,v.Module.resumeMainLoop()},2e4);navigator.mediaDevices.getDisplayMedia({audio:!0,video:{mediaSource:"screen"}}).then(function(e){try{clearTimeout(o)}catch(e){}var t=e.getAudioTracks();for(let e=0;e<t.length;e++)i.addTrack(t[e]);e=i,a.elements.buttons.screenRecord.querySelector(".".concat(Y({ejs__tooltip:!0}))).innerHTML=a.localization("Stop Screen Recording"),a.recordData.stream=e,a.recordData.recorder=new MediaRecorder(a.recordData.stream,n),a.recordData.recorder.ondataavailable=function(e){if(0<e.data.size&&a.recordData.data.push(e.data),a.recordData.stopped){let e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob(a.recordData.data,{type:"video/webm"}));let t;"string"==typeof a.gameName&&(t=a.gameName),e.download=t?"".concat(t,"-recording.webm"):"record.webm",e.click(),window.URL.revokeObjectURL(e.href),delete a.recordData,a.elements.buttons.screenRecord.querySelector(".".concat(Y({ejs__tooltip:!0}))).innerHTML=a.localization("Start Screen Recording")}},a.recordData.recorder.start(),a.recordData.started=!0,a.playing=!0,v.Module.resumeMainLoop()})}}),a.elements.buttons.play&&Array.from(a.elements.buttons.play).forEach(function(e){j.call(a,e,"click",function(e){a.playing?(a.playing=!1,v.Module.pauseMainLoop(),G.call(a,a.elements.container,"pause",!1,{pause:!0})):(a.playing=!0,v.Module.resumeMainLoop(),G.call(a,a.elements.container,"pause",!1,{pause:!1}))})}),a.elements.buttons.cheat&&j.call(a,a.elements.buttons.cheat,"click",function(e){U(a.elements.dialogs.cheat,!1)}),a.game.stateloadField=F("input"),a.game.stateloadField.type="file",a.game.stateloadField.onchange=function e(t){let n,i=t.target.files;0<i.length&&((n=new FileReader).file_name=i[0].name,n.onload=function(){EJS_loadState(new Uint8Array(n.result))},n.readAsArrayBuffer(i[0])),a.game.stateloadField=F("input"),a.game.stateloadField.type="file",a.game.stateloadField.onchange=e},j.call(a,a.elements.container,"loadstate",function(e){g.saveLoadDB.call(a,"load")||(B.function(a.config.onloadstate)?a.config.onloadstate.call(null,a.loadState):a.game.stateloadField.click(),a.elements.container.focus())}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?console.log("hidden"):console.log("active")})},bindFunction:function(){let a=this,i=a.system;if(v.Module&&v.Module._set_volume){let t=v.Module.cwrap("set_volume","null",["number"]);g.setVolume=function(){let e=0;a.volume<1&&(e=0===a.volume?-80:30*a.volume-30,t(e)),a.muted&&(e=-80),t(e)}}g.setVariable=v.Module.cwrap("set_variable","null",["string","string"]),g.simulateInputFn=v.Module.cwrap("simulate_input","null",["number","number","number"]),g.simulateInput=function(e,t,n){g.simulateInputFn(e,t,n)},g.syncInput=g.simulateInput,window.simulateInput=g.simulateInput;let t=v.Module.cwrap("shader_enable","null",["number"]),o=(g.toggleShader=function(e){return t(e)},2!==a.coreVer?g.getStateInfo=v.Module.cwrap("get_state_info","string",[]):(g.getInfoOfState=v.Module.cwrap("get_state_info","string",[]),g.getStateInfo1=v.Module.cwrap("save_state_info","null",[]),g.getStateInfo=function(){return g.getStateInfo1(),new Promise(function(t,e){let n=g.getInfoOfState();if(n)t(n);else{let e=setInterval(function(){(n=g.getInfoOfState())&&(clearInterval(e),t(n))},50)}})}),g.saveState=async function(){let n,i;var o=(i=(2!==a.coreVer?g.getStateInfo():await g.getStateInfo()).split("|"))[0]>>0;if(0<o){n=new Uint8Array(o);for(let e=i[1]>>0,t=0;t<o;t++)n[t]=v.Module.getValue(e+t)}return n},v.Module.cwrap("load_state","number",["string","number"])),e=(g.loadState=function(e,t){try{v.FS.unlink("game.state")}catch(e){}v.FS.createDataFile("/","game.state",e,!0,!0),null===t&&(t=0),"arcade"===i?setTimeout(function(){g.getStateInfo(),o("game.state",t),v.FS.unlink("game.state")},10):(o("game.state",t),setTimeout(function(){v.FS.unlink("game.state")},100)),a.elements.container.focus()},v.Module._set_cheat&&(g.setCheat=v.Module.cwrap("set_cheat","number",["number","number","string"])),v.Module._reset_cheat&&(g.resetCheat=v.Module._reset_cheat),g.quickSaveState=async function(){if(a.started){if(!1===a.statesSupported)return a.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY SAVE STATE",clearTimeout(g.saveMsgTransitions),void(g.saveMsgTransitions=setTimeout(function(){a.elements.widgets.stateInfoDiv.innerHTML=""},1500));let t;var e=(t=ne&&"function"==typeof ne.getCoreOptionsValues&&(t=ne.getCoreOptionsValues()["save-state-slot"])||1)+"-quick.state";try{v.FS.unlink(e)}catch(e){}try{var n=await g.saveState();v.FS.createDataFile("/",e,n,!0,!0),a.elements.widgets.stateInfoDiv.innerHTML="STATE SAVED TO SLOT "+t,clearTimeout(g.saveMsgTransitions),g.saveMsgTransitions=setTimeout(function(){a.elements.widgets.stateInfoDiv.innerHTML=""},1500)}catch(e){console.warn(e),a.elements.widgets.stateInfoDiv.innerHTML="FAILED TO SAVE STATE TO SLOT "+t,clearTimeout(g.saveMsgTransitions),g.saveMsgTransitions=setTimeout(function(){a.elements.widgets.stateInfoDiv.innerHTML=""},1500)}saveSaveFiles()}},g.saveMsgTransitions=null,g.quickLoadState=function(){if(a.started){if(!1===a.statesSupported)return a.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY LOAD STATE",clearTimeout(g.saveMsgTransitions),void(g.saveMsgTransitions=setTimeout(function(){a.elements.widgets.stateInfoDiv.innerHTML=""},1500));let e,t=(e=ne&&"function"==typeof ne.getCoreOptionsValues&&(e=ne.getCoreOptionsValues()["save-state-slot"])||1)+"-quick.state",n=!0;try{o(t,0),"arcade"===i&&setTimeout(function(){g.getStateInfo(),o(t,0)},10)}catch(e){n=!1}n?a.elements.widgets.stateInfoDiv.innerHTML="LOADED STATE FROM SLOT "+e:a.elements.widgets.stateInfoDiv.innerHTML="FAILED TO LOAD STATE FROM SLOT "+e,clearTimeout(g.saveMsgTransitions),g.saveMsgTransitions=setTimeout(function(){a.elements.widgets.stateInfoDiv.innerHTML=""},1500),saveSaveFiles()}},g.changeStateSlot=function(e){ne&&"function"==typeof ne.getCoreOptionsValues&&ne.getCoreOptionsValues()["save-state-slot"];let t;9<(t="number"!=typeof e?slot+1:e)&&(t=1),te.updateCoreOptions.call(a,"save-state-slot",t),a.elements.widgets.stateInfoDiv.innerHTML="SET SAVE STATE SLOT TO "+t,clearTimeout(g.saveMsgTransitions),g.saveMsgTransitions=setTimeout(function(){a.elements.widgets.stateInfoDiv.innerHTML=""},1500)},window.EJS_loadState=function(e){g.loadState(e,0)},v.Module.cwrap("cmd_take_screenshot","",[]));g.getScreenData=function(){return e(),v.FS.readFile("screenshot.png")},g.restartGame=v.Module.cwrap("system_restart","",[]),g.saveSavFiles=v.Module.cwrap("cmd_savefiles","",[]),v.Module._get_core_options&&(g.getGameCoreOptions=v.Module.cwrap("get_core_options","string",[])),g.controllers=ne.storage.get("controllers"),g.controllers||(g.controllers=JSON.parse(JSON.stringify(g.defaultControllers)))}};let ee=g;var e,u,te={storage:null,coreOptionsValues:{},contextMenu:null,normalOptions:{shader:{label:"Shader",options:{disabled:"Disabled","2xScaleHQ.glslp":"2xScaleHQ","4xScaleHQ.glslp":"4xScaleHQ","5xbrz.glslp":"5xbrz","6xbrz.glslp":"6xbrz","crt-easymode.glslp":"CRT easymode","crt-aperture.glslp":"CRT aperture","crt-geom.glslp":"CRT geom","crt-mattias.glslp":"CRT mattias"},default:"disabled"},"virtual-gamepad":{label:"Virtual Gamepad",options:{disabled:"Disabled",enabled:"Enabled"},default:"enabled"}},defaultCoreOptionsValues:function(){let e={};switch(this.system){case"pce":e={pce_nospritelimit:"enabled"};break;case"jaguar":e={virtualjaguar_doom_res_hack:"enabled"};break;case"psx":e={pcsx_rearmed_memcard2:"enabled"};break;case"nds":e={}}return e},getCoreOptionsValues:function(){let e=te.storage.get("core-options");return e=B.empty(e)?{}:e},getCoreOptions:function(){let o={};switch(this.system){case"nes":o.fceumm_palette={label:this.localization("Color Palette"),options:{default:this.localization("Default"),asqrealc:"asqrealc","nintendo-vc":"nintendo-vc",rgb:"rgb","yuv-v3":"yuv-v3","unsaturated-final":"unsaturated-final","sony-cxa2025as-us":"sony-cxa2025as-us",pal:"pal","bmf-final2":"bmf-final2","bmf-final3":"bmf-final3","smooth-fbx":"smooth-fbx","composite-direct-fbx":"composite-direct-fbx","pvm-style-d93-fbx":"pvm-style-d93-fbx",nescap:"nescap","ntsc-hardware-fbx":"ntsc-hardware-fbx","nes-classic-fbx-fs":"nes-classic-fbx-fs",wavebeam:"wavebeam"},default:"default"},o.fceumm_nospritelimit={label:this.localization("No Sprite Limit"),options:{enabled:this.localization("Enabled"),disabled:this.localization("Disabled")},default:"disabled"},o.fceumm_sndquality={label:this.localization("Sound Quality"),options:{Low:this.localization("Low"),High:this.localization("High"),"Very High":this.localization("Very High")},default:"Low"},this.lightgun||(o.system_type={label:this.localization("4 Players Support"),options:{nes:"NES",famicom:"Famicom"},default:"nes",netplay:!0}),o.fceumm_turbo_enable={label:this.localization("Turbo Enable"),options:{None:this.localization("None"),"Player 1":this.localization("Player 1"),"Player 2":this.localization("Player 2"),Both:this.localization("Both")},default:"None",netplay:!0},o.fceumm_region={label:this.localization("Region"),options:{Auto:this.localization("Auto"),NTSC:"NTSC",PAL:"PAL",Dendy:"Dendy"},default:"Auto",netplay:!0};break;case"snes":o={snes9x_next_overclock:{label:this.localization("SuperFX Overclock"),options:{disabled:this.localization("Disabled")+"(10MHz)","40MHz":"40MHz","60MHz":"60MHz","80MHz":"80MHz","100MHz":"100MHz"},default:"disabled",netplay:!0}};break;case"snes2002":case"snes2005":case"snes2010":o={};break;case"gb":o={gambatte_gb_colorization:{label:this.localization("GB Colorization"),options:{disabled:this.localization("Disabled"),auto:this.localization("auto"),internal:this.localization("internal")},default:"disabled"},gambatte_gb_internal_palette:{label:this.localization("Internal Palette"),options:{"GBC - Blue":this.localization("GBC - Blue"),"GBC - Brown":this.localization("GBC - Brown"),"GBC - Dark Blue":this.localization("GBC - Dark Blue"),"GBC - Dark Brown":this.localization("GBC - Dark Brown"),"GBC - Dark Green":this.localization("GBC - Dark Green"),"GBC - Grayscale":this.localization("GBC - Grayscale"),"GBC - Green":this.localization("GBC - Green"),"GBC - Inverted":this.localization("GBC - Inverted"),"GBC - Orange":this.localization("GBC - Orange"),"GBC - Pastel Mix":this.localization("GBC - Pastel Mix"),"GBC - Red":this.localization("GBC - Red"),"GBC - Yellow":this.localization("GBC - Yellow")},default:"GBC - Blue"}};break;case"gba":o={mgba_solar_sensor_level:{label:this.localization("Solar sensor level"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"},mgba_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"}};break;case"vbanext":o={vbanext_turboenable:{label:this.localization("Enable Turbo Buttons"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},vbanext_turbodelay:{label:this.localization("Turbo Delay in frames"),options:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],default:"2"}};break;case"n64":o={"glupen64-aspect":{label:this.localization("Aspect Ratio (Need to refresh page)"),options:["4:3","16:9"],default:"4:3"},"glupen64-43screensize":{label:this.localization("4:3 Resolution"),options:["320x240","640x480","960x720","1280x960"],default:"320x240"},"glupen64-169screensize":{label:this.localization("16:9 Resolution"),options:["640x360","960x540","1280x720"],default:"640x360"},"glupen64-pak1":{label:this.localization("Player 1 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak2":{label:this.localization("Player 2 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak3":{label:this.localization("Player 3 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak4":{label:this.localization("Player 4 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0}},!ee||"undefined"==ee.virtualGamepadContainer&&null===ee.virtualGamepadContainer||(o["joystick-input"]={label:this.localization("Joystick input keys"),options:{"d-pad":this.localization("d-pad"),"analog-stick":this.localization("Analog Stick")},default:"analog-stick",netplay:!0});break;case"nds":o={desmume_screens_layout:{label:this.localization("Screen layout"),options:{"top/bottom":this.localization("top/bottom"),"bottom/top":this.localization("bottom/top"),"left/right":this.localization("left/right"),"right/left":this.localization("right/left"),"top only":this.localization("top only"),"bottom only":this.localization("bottom only"),"quick switch":this.localization("quick switch"),"hybrid/top":this.localization("hybrid/top"),"hybrid/bottom":this.localization("hybrid/bottom")},default:"top/bottom"},screen_rotation:{label:this.localization("Screen Rotation"),options:{0:"0°",90:"90°",180:"180°",270:"270°"},default:0},desmume_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9"],default:"0"}},X.wasm||delete o.screen_rotation;break;case"vb":case"pce":o={};break;case"segaMS":case"segaGG":case"segaMD":case"segaCD":o={genesis_plus_gx_no_sprite_limit:{label:this.localization("No Sprite Limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},genesis_plus_gx_overclock:{label:this.localization("CPU speed"),options:["100%","125%","150%","175%","200%"],default:"100%",netplay:!0},genesis_plus_gx_sound_output:{label:this.localization("Sound output"),options:{stereo:this.localization("stereo"),mono:this.localization("mono")},default:"stereo"}};break;case"sega32x":o={picodrive_sprlim:{label:this.localization("No sprite limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"segaSaturn":o={yabause_frameskip:{label:this.localization("Frameskip"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"msx":o={bluemsx_nospritelimits:{label:this.localization("No Sprite Limit"),options:{OFF:this.localization("OFF"),ON:this.localization("ON")},default:"OFF"}};break;case"ws":case"ngp":o={};break;case"jaguar":o={virtualjaguar_usefastblitter:{label:this.localization("Fast Blitter"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},virtualjaguar_bios:{label:this.localization("Bios"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"psx":o={pcsx_rearmed_frameskip:{label:this.localization("Frameskip"),options:[0,1,2,3],default:0,netplay:!0},pcsx_rearmed_memcard2:{label:this.localization("Enable second memory card"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_pad1type:{label:this.localization("Pad 1 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad2type:{label:this.localization("Pad 2 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad3type:{label:this.localization("Pad 3 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad4type:{label:this.localization("Pad 4 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_vibration:{label:this.localization("Enable Vibration"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_neon_interlace_enable:{label:this.localization("Enable interlacing mode(s)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_enable:{label:this.localization("Enhanced resolution (slow)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_no_main:{label:this.localization("Enhanced resolution speed hack"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0}};break;case"arcade":case"fba0.2.97.29":o={"fba-aspect":{label:this.localization("Aspect ratio"),options:["DAR","PAR"],default:"DAR"},"fba-frameskip":{label:this.localization("Frameskip"),options:["0","1","2","3","4","5"],default:"0",netplay:!0},"fba-cpu-speed-adjust":{label:this.localization("CPU overclock"),options:["100","110","120","130","140","150","160","170","180","190","200"],default:"100",netplay:!0},"fba-diagnostic-input":{label:this.localization("Diagnostic Input"),options:["None","Hold Start","Start + A + B","Hold Start + A + B","Start + L + R","Hold Start + L + R","Hold Select","Select + A + B","Hold Select + A + B","Select + L + R","Hold Select + L + R"],default:"None",netplay:!0},"fba-neogeo-mode":{label:this.localization("Force Neo Geo mode"),options:["MVS","AES","UNIBIOS","DIPSWITCH"],default:"MVS",netplay:!0}};break;default:o={}}2===this.coreVer&&((o={}).fps={label:this.localization("FPS"),options:["show","hide"],default:"hide"}),!0===this.statesSupported&&(o["save-state-slot"]={label:this.localization("Save State Slot"),options:[1,2,3,4,5,6,7,8,9],default:1}),!0===this.statesSupported&&window.indexedDB&&this.getStartName()&&(o["save-state-location"]={label:this.localization("Save State Location"),options:{download:this.localization("download"),"keep in browser":this.localization("keep in browser")},default:"download"});let a=this;return ee.getGameCoreOptions&&ee.getGameCoreOptions().split("\n").forEach(function(e,t){let n=e.split("; "),i=n[0];if(0===i.indexOf("fba-dipswitch-")||2===a.coreVer){let e=n[1].split("|"),t=i.split("|")[0].replace(/_/g," ").replace(/.+\-(.+)/,"$1");e.slice(1,-1),1!==e.length&&(o[i.split("|")[0]]={label:t,options:e,default:1<i.split("|").length?i.split("|")[1]:e[0].replace("(Default) ",""),netplay:!0})}}),o},findElements:function(){try{return this.elements.controls=H.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:c.call(this,this.config.selectors.buttons.play),pause:H.call(this,this.config.selectors.buttons.pause),restart:H.call(this,this.config.selectors.buttons.restart),mute:H.call(this,this.config.selectors.buttons.mute),settings:H.call(this,this.config.selectors.buttons.settings),fullscreen:H.call(this,this.config.selectors.buttons.fullscreen),saveState:H.call(this,this.config.selectors.buttons.saveState),screenRecord:H.call(this,this.config.selectors.buttons.screenRecord),loadState:H.call(this,this.config.selectors.buttons.loadState),gamepad:H.call(this,this.config.selectors.buttons.gamepad),cheat:H.call(this,this.config.selectors.buttons.cheat)},this.elements.inputs={volume:H.call(this,this.config.selectors.inputs.volume)},!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),!1}},createIcon:function(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=(N(n,W(t,{role:"presentation",focusable:"false"})),document.createElement("div"));i.innerHTML="<svg>".concat(this.icons[e],"</svg>");for(let e=i.childNodes[0].childNodes,t=0;t<e.length;t+=1)n.appendChild(e[t]);return n},createLabel:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=pe.get(e,this.config),i={};return i[t.class]=!0,i[this.config.classNames.hidden]=!0,F("span",Object.assign({},t,{class:[t.class,this.config.classNames.tooltip].filter(Boolean).join(" ")}),n)},createBadge:function(e){if(B.empty(e))return null;let t=F("span",{class:this.config.classNames.menu.value});return t.appendChild(F("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(e,t){let n,i,o,a,s=F("button"),l=Object.assign({},t),r=function(e){let t=(0<arguments.length&&void 0!==e?e:"").toString();return(t=function(e){e=fe((0<arguments.length&&void 0!==e?e:"").toString(),"-"," ");return e=fe(e,"_"," "),fe(function(e){return(0<arguments.length&&void 0!==e?e:"").toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}(e)," ","")}(t)).charAt(0).toLowerCase()+t.slice(1)}(e),c=!1;"type"in l||(l.type="button");t=Y({ejs__control:!0});switch("class"in l?l.class.includes(t)||(l.class+=" ".concat(t)):l.class=t,e){case"play":c=!0,n="play",o="pause",i="play",a="pause";break;case"mute":c=!0,n="mute",o="unmute",i="volume",a="muted";break;case"fullscreen":c=!0,n="enterFullscreen",o="exitFullscreen",i="enter-fullscreen",a="exit-fullscreen";break;default:n=r,i=e}return c?(s.appendChild(te.createIcon.call(this,a,{class:Y({"icon--pressed":!0})})),s.appendChild(te.createIcon.call(this,i,{class:Y({"icon--not-pressed":!0})})),s.appendChild(te.createLabel.call(this,o,{class:Y({"icon--pressed":!0})})),s.appendChild(te.createLabel.call(this,n,{class:Y({"icon--not-pressed":!0})}))):(s.appendChild(te.createIcon.call(this,i)),s.appendChild(te.createLabel.call(this,n))),W(l,h(this.config.selectors.buttons[r],l)),N(s,l),"play"===r?(B.array(this.elements.buttons[r])||(this.elements.buttons[r]=[]),this.elements.buttons[r].push(s)):this.elements.buttons[r]=s,s},createRange:function(e,t){t=F("input",W(h(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.1,value:0,autocomplete:"off",role:"slider","aria-label":pe.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=t,te.updateRangeFill.call(this,t),t},bindMenuItemShortcuts:function(i,o){let a=this;j(i,"keydown keyup",function(n){if([32,38,39,40].includes(n.which)&&(n.preventDefault(),n.stopPropagation(),"keydown"!==n.type)){let e,t=D(i,'[role="menuitemradio"]');!t&&[32,39].includes(n.which)?te.showMenuPanel.call(a,o,!0):32!==n.which&&(40===n.which||t&&39===n.which?(e=i.nextElementSibling,B.element(e)||(e=i.parentNode.firstElementChild)):(e=i.previousElementSibling,B.element(e)||(e=i.parentNode.lastElementChild)),oe.call(a,e,!0))}},!1),j(i,"keyup",function(e){13===e.which&&te.focusFirstMenuItem.call(a,null,!0)})},createMenuItem:function(e){let t=this,n=e.value,i=e.list,o=e.type,a=e.title,s=e.badge,l=void 0===s?null:s,r=e.checked,c=void 0!==r&&r,d=h(this.config.selectors.inputs[o]),u=F("button",W(d,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(d.class||"").trim(),"aria-checked":c,value:n})),f=F("span"),p=(f.innerHTML=a,B.element(l)&&f.appendChild(l),u.appendChild(f),Object.defineProperty(u,"checked",{enumerable:!0,get:function(){return"true"===u.getAttribute("aria-checked")},set:function(e){e&&Array.from(u.parentNode.children).filter(function(e){return D(e,'[role="menuitemradio"]')}).forEach(function(e){return e.setAttribute("aria-checked","false")}),u.setAttribute("aria-checked",e?"true":"false")}}),te.getCoreOptions.call(this));this.listeners.bind(u,"click keyup",function(e){B.keyboardEvent(e)&&32!==e.which||(e.preventDefault(),e.stopPropagation(),u.checked=!0,Object.keys(te.normalOptions).includes(o)&&te.updateNormalOptions.call(t,o,n),Object.keys(p).includes(o)&&te.updateCoreOptions.call(t,o,n)),te.showMenuPanel.call(t,"home",B.keyboardEvent(e))},o,!1),te.bindMenuItemShortcuts.call(this,u,o),i.appendChild(u)},updateVolume:function(){B.element(this.elements.inputs.volume)&&te.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),B.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume)},setRange:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;B.element(e)&&(e.value=t,te.updateRangeFill.call(this,e))},updateRangeFill:function(e){let t=B.event(e)?e.target:e;if(B.element(t)&&"range"===t.getAttribute("type")){if(D(t,this.config.selectors.inputs.volume)){let e=100*t.value;t.setAttribute("aria-valuenow",e),t.setAttribute("aria-valuetext","".concat(e.toFixed(1),"%"))}else t.setAttribute("aria-valuenow",t.value);q.isWebkit&&t.style.setProperty("--value","".concat(t.value/t.max*100,"%"))}},toggleMenuButton:function(e,t){U(this.elements.settings.buttons[e],!t)},updateNormalOptions:function(e,t){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=te.normalOptions[e].options[t];let n={};n[e]=t,te.storage.set(n),"shader"===e&&ee.setShader(t),"virtual-gamepad"===e&&ee.toggleVirtualGamepad.call(this,"enabled"===t)},updateCoreOptions:function(t,n){if("nds"==this.system&&!X.wasm)return!0;if(te.coreOptionsValues[t]=n,"psx"===this.system&&v.Module.pauseMainLoop(),ee.setVariable(t,n),"psx"===this.system&&(setTimeout(function(){v.Module.resumeMainLoop()},100),setTimeout(function(){v.Module.resumeMainLoop()},200)),"nds"===this.system&&X.wasm){let e=this.elements.wrapper.querySelector("canvas");if("screen_rotation"===t)switch(e.style.transform="rotate("+n+"deg)",n){case"0":ee.setVariable("desmume_input_rotation","0");break;case"90":ee.setVariable("desmume_input_rotation","270");break;case"180":ee.setVariable("desmume_input_rotation","180");break;case"270":ee.setVariable("desmume_input_rotation","90")}}if("arcade"===this.system||"fba0.2.97.29"===this.system){let e=this.elements.wrapper.querySelector("canvas");e.height="fba-aspect"===t&&"PAR"===n?e.width/16*9:e.width/4*3}let i=te.getCoreOptions.call(this),e=te.storage.get("core-options");if((e=B.empty(e)?{}:e)[t]=n,te.storage.set({"core-options":e}),this.elements.settings.buttons[t]){let e=this.elements.settings.buttons[t].querySelector(".".concat(this.config.classNames.menu.value));B.object(i[t].options)?e.innerHTML=i[t].options[n]:e.innerHTML=n}},setOptionMenuItem:function(d,u){let f=this,p=this.elements.settings.panels.home.querySelector('[role="menu"]'),m=this.elements.settings.popup.children[0];Object.keys(d).forEach(function(t){let n=t,e=F("button",W(h(f.config.selectors.buttons.settings),{type:"button",class:Y({ejs__control:!0,"ejs__control--forward":!0}),role:"menuitem",item:t,"aria-haspopup":!0}));j(e,"click",function(){te.showMenuPanel.call(f,n,!1)});let i,o=F("span",null,d[t].label),a=F("span",{class:f.config.classNames.menu.value}),s=(B.object(u)&&(i=u[n]),B.empty(i)&&(i=d[n].default),B.object(d[n].options)?a.innerHTML=d[n].options[i]:a.innerHTML=i,o.appendChild(a),e.appendChild(o),p.appendChild(e),F("div",{"data-pane":escape(n),hidden:""})),l=F("button",{type:"button",class:Y({ejs__control:!0,"ejs__control--back":!0})}),r=(l.appendChild(F("span",{"aria-hidden":!0},d[t].label)),l.appendChild(F("span",{class:Y({"ejs__sr-only":!0})},pe.get("menuBack",f.config))),j(s,"keydown",function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),te.showMenuPanel.call(f,"home",!0))},!1),j(l,"click",function(){te.showMenuPanel.call(f,"home",!1)}),s.appendChild(l),s.appendChild(F("div",{role:"menu"})),m.appendChild(s),f.elements.settings.buttons[n]=e,(f.elements.settings.panels[n]=s).querySelector('[role="menu"]'));var c=r;if(B.element(c))for(let e=c.childNodes.length;0<e;)c.removeChild(c.lastChild),--e;B.object(d[t].options)?Object.keys(d[t].options).forEach(function(e){te.createMenuItem.call(f,{value:e,list:r,type:n,title:d[t].options[e],badge:null,checked:Boolean(i===e)})}):B.array(d[t].options)&&d[t].options.forEach(function(e){te.createMenuItem.call(f,{value:e,list:r,type:n,title:e,badge:null,checked:Boolean(i===e)})})})},setNormalOptionsMenu:function(){let t=this,a=this,e={};e.orientation=te.storage.get("orientation"),e.shader=te.storage.get("shader"),a.touch?(e["virtual-gamepad"]=te.storage.get("virtual-gamepad"),j.call(a,a.elements.container,"start-game",function(){"enabled"!==e["virtual-gamepad"]&&!B.empty(e["virtual-gamepad"])||ee.toggleVirtualGamepad.call(a,!0)})):delete te.normalOptions["virtual-gamepad"],te.setOptionMenuItem.call(this,te.normalOptions,e),j.call(a,a.elements.container,"start-game",function(){var e=te.storage.get("shader");"disabled"!==e&&ee.setShader(e);let n=t,o={};ee.getGameCoreOptions&&ee.getGameCoreOptions().split("\n").forEach(function(e,t){let n=e.split("; "),i=n[0];if(0===i.indexOf("fba-dipswitch-")||2===a.coreVer){let e=n[1].split("|"),t=i.split("|")[0].replace(/_/g," ").replace(/.+\-(.+)/,"$1");e.slice(1,-1),1!==e.length&&(o[i.split("|")[0]]={label:t,options:e,default:1<i.split("|").length?i.split("|")[1]:e[0].replace("(Default) ",""),netplay:!0})}});e=te.storage.get("core-options");te.coreOptionsValues=e||{},te.setOptionMenuItem.call(a,o,te.coreOptionsValues),Object.keys(te.coreOptionsValues).forEach(function(e,t){te.updateCoreOptions.call(n,e,te.coreOptionsValues[e])}),"nds"==a.system&&(v.Module._fast_forward_2?v.Module._fast_forward_2(1):v.Module._fast_forward&&v.Module._fast_forward(1))})},updateCoreOptionMenuItems:function(){let t=this.elements.settings.panels.home.querySelector('[role="menu"]'),e=te.getCoreOptions.call(this);Object.keys(e).forEach(function(e){t.querySelector('[item="'.concat(e,'"]')).removeAttribute("disabled")})},setCoreOptionsMenu:function(){this.elements.settings.panels.home.querySelector('[role="menu"]'),this.elements.settings.popup.children[0];var e=te.getCoreOptions.call(this),t=te.storage.get("core-options");te.coreOptionsValues=t||{},te.setOptionMenuItem.call(this,e,t)},checkMenu:function(){var e=this.elements.settings.buttons;B.empty(e)||Object.values(e).some(function(e){return!e.hidden}),U(this.elements.settings.menu,!1)},focusFirstMenuItem:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!this.elements.settings.popup.hidden){let e=t;t=(e=B.element(e)?e:Object.values(this.elements.settings.panels).find(function(e){return!e.hidden})).querySelector('[role^="menuitem"]');oe.call(this,t,n)}},toggleMenu:function(n){let i=this.elements.settings.popup,o=this.elements.buttons.settings;if(B.element(i)&&B.element(o)){let e=i.hidden,t=e;if(B.boolean(n))t=n;else if(B.keyboardEvent(n)&&27===n.which)t=!1;else if(B.event(n)){var a=i.contains(n.target);if(a||!a&&n.target!==o&&t)return}o.setAttribute("aria-expanded",t),U(i,!t),V(this.elements.container,this.config.classNames.menu.open,t),t&&B.keyboardEvent(n)?te.focusFirstMenuItem.call(this,null,!0):t||e||oe.call(this,o,B.keyboardEvent(n))}},getMenuSize:function(e){let t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);var e=t.scrollWidth,n=t.scrollHeight;return L(t),{width:e,height:n}},showLoadStatePanel:function(){},showMenuPanel:function(){let i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=H.call(this,'[data-pane="'.concat(escape(e),'"]'));if(B.element(o)){let n=o.parentNode,e=Array.from(n.children).find(function(e){return!e.hidden});var a,s;X.transitions&&!X.reducedMotion&&(n.style.width="".concat(e.scrollWidth,"px"),n.style.height="".concat(e.scrollHeight,"px"),a=te.getMenuSize.call(this,o),s=function e(t){t.target===n&&["width","height"].includes(t.propertyName)&&(n.style.width="",n.style.height="",M.call(i,n,re,e))},j.call(this,n,re,s),n.style.width="".concat(a.width,"px"),n.style.height="".concat(a.height,"px")),U(e,!0),U(o,!1),te.focusFirstMenuItem.call(this,o,t)}},setLoadState:function(e,t){e.appendChild(te.createButton.call(this,"load-state",{"aria-haspopup":!0,"aria-expanded":!1}));let n=F("div",{class:Y({ejs__dialog:!0,"ejs__load-state__container":!0}),hidden:""}),i=F("div");n.appendChild(i),H.call(this,".".concat(Y({ejs__dialogs:!0}))).appendChild(n),this.elements.dialogs.loadState=n},setScreenRecord:function(n,e){if(window.MediaRecorder){var i=te.createButton.call(this,"screen-record",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});n.appendChild(i);let e=F("div",{class:Y({ejs__dialog:!0,ejs__screenRecord__container:!0}),hidden:""}),t=F("div");e.appendChild(t),H.call(this,".".concat(Y({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.screenRecord=e}},setGamepad:function(e,t){var n=te.createButton.call(this,"gamepad",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let i=F("div",{class:Y({ejs__dialog:!0,ejs__gamepad__container:!0}),hidden:""}),o=F("div");i.appendChild(o),H.call(this,".".concat(Y({ejs__dialogs:!0}))).appendChild(i),this.elements.dialogs.gamepad=i},setCheat:function(e,t){var n=te.createButton.call(this,"cheat",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let i=F("div",{class:Y({ejs__dialog:!0,ejs__cheat__container:!0}),hidden:""}),o=F("div");i.appendChild(o),H.call(this,".".concat(Y({ejs__dialogs:!0}))).appendChild(i),this.elements.dialogs.cheat=i},setStateInfoBarWidget:function(){let e=F("div",{class:Y({ejs__widget:!0})}),t=F("div");t.style="color: red;font-size: 17px;padding:10px;text-align:left;text-shadow:1px 1px 1px #000",e.appendChild(t),H.call(this,".".concat(Y({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.stateInfo=e,this.elements.widgets.stateInfoDiv=t},toggleContextMenu:function(n,i){if(z(n.target,Y({ejs__dialogs:!0}))){let e=te.contextMenu.timer;if(this.started){let t=H.call(this,".".concat(Y({ejs__contextmenu:!0})," ul"));if(i){te.contextMenu.style.display="block",te.contextMenu.style.left="".concat(n.layerX,"px"),te.contextMenu.style.top="".concat(n.layerY,"px");c.call(this,".".concat(Y({ejs__contextmenu:!0})," ul li"));if(null===t.getAttribute("menu")){let e=F("li",{});e.appendChild(F("a",{target:"_blank",href:"https://github.com/ethanaobrien/emulatorjs"},"EmulatorJS v".concat(this.version))),t.appendChild(e),t.setAttribute("menu","")}e&&clearTimeout(e),e=setTimeout(function(){},4e3),te.contextMenu.timer=e}else te.contextMenu.style.display="none"}}},create:function(e){let s=this,t=(te.storage=new he(this,"ejs_".concat(this.system,"_settings")),F("div",h(this.config.selectors.controls.wrapper))),i=(te.contextMenu=F("div",{class:Y({ejs__contextmenu:!0}),style:"position: absolute; display:none;z-index:9"}),["<ul>","</ul>"]),o=[];function n(e,t,n){"function"==typeof n?o.push(n):o.push(function(){});n=i.length-1;t?i.splice(n,0,'<li hidden><a href="#" onclick="return false">'+e+"</a></li>"):i.splice(n,0,'<li><a href="#" onclick="return false">'+e+"</a></li>")}n(s.localization("Take Screenshot"),!1,function(e){var t=g.getScreenData();let n;var i=(n="string"==typeof s.gameName?s.gameName:n)?"".concat(n,"-screenshot.png"):"game.png";let o=document.createElement("a");return o.href=URL.createObjectURL(new Blob([t])),o.download=i,o.click(),setTimeout(function(){URL.revokeObjectURL(o.src)}),!1}),n(s.localization("Cache Manage"),!0,function(e){if(v.romdb){U(s.elements.dialogs.cache,!1);let n=s.elements.dialogs.cache.querySelector(".".concat(g.classNames["dialog-content"]));n.innerHTML="<div>"+s.localization("Loading")+"</div>",v.romdb.getAll(function(t){if(t){let e=F("table",{style:"width:100%;padding-left:10px;text-align:left"}),a=F("tbody");0<t.length?(n.innerHTML="",t.forEach(function(o,e){if(o.key&&!/-part-\d+$/.test(o.key)){for(let e=Math.ceil(o.filesize/104857600),t=[o.key],n=1;n<e;n+=1)t.push("".concat(o.key,"-part-").concat(n));let t=F("tr"),e=F("td"),n=F("td"),i=F("td");e.innerHTML=o.filename,n.innerHTML=function(e){let t=-1;for(;e/=1024,t++,1024<e;);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}(o.filesize),i.innerHTML='<a href="#" onclick="return false">Remove</a>',t.appendChild(e),t.appendChild(n),t.appendChild(i),a.appendChild(t),i.querySelector("a").onclick=function(e){v.romdb.removeBatch(_0x277c67);try{a.removeChild(t)}catch(e){}return e.stopPropagation(),!1}}}),e.appendChild(a),n.appendChild(e)):n.innerHTML='<div style="text-align:center">'+s.localization("Empty")+"</div>"}else n.innerHTML='<div style="text-align:center">'+s.localization("Empty")+"</div>"},function(){})}return!1}),n(s.localization("Quick Save")+" (F2)",!1,function(e){g.quickSaveState(),ne.contextMenu.style.display="none"}),n(s.localization("Quick Load")+" (F4)",!1,function(e){g.quickLoadState(),ne.contextMenu.style.display="none"}),te.contextMenu.innerHTML=i.join("");var a=te.contextMenu.getElementsByTagName("li");for(let e=0;e<a.length;e++)j.call(s,a[e],"click",o[e]);this.elements.container.appendChild(te.contextMenu);var l=F("div",{class:Y({ejs__dialog:!0,ejs__cache__container:!0}),hidden:""}),l=(H.call(this,".".concat(Y({ejs__dialogs:!0}))).appendChild(l),this.elements.dialogs.cache=l,F("div",{class:Y({ejs__dialog:!0,ejs__loading__container:!0}),hidden:""}));H.call(this,".".concat(Y({ejs__dialogs:!0}))).appendChild(l),this.elements.dialogs.loading=l,t.appendChild(te.createButton.call(this,"restart")),t.appendChild(te.createButton.call(this,"play")),t.appendChild(te.createButton.call(this,"save-state",{"aria-expanded":!1})),te.setLoadState.call(this,t,e),te.setScreenRecord.call(this,t,e),te.setGamepad.call(this,t,e),te.setStateInfoBarWidget.call(this,t,e),te.setCheat.call(this,t,e),t.appendChild(F("span",{style:"flex:1"}));let r=F("div",{class:Y({ejs__volume:!0})});r.appendChild(te.createButton.call(this,"mute"));l={max:1,step:.01,value:this.config.volume};r.appendChild(te.createRange.call(this,"volume",W(l,{}))),this.elements.volume=r,t.appendChild(r);let c=F("div",{class:Y({ejs__menu:!0})}),d=(c.appendChild(te.createButton.call(this,"settings",{"aria-haspopup":!0,"aria-expanded":!1})),F("div",{class:Y({ejs__menu__container:!0}),hidden:""})),u=F("div"),f=F("div",{"data-pane":"home"}),p=F("div",{role:"menu"}),m=(f.appendChild(p),u.appendChild(f),this.elements.settings.panels.home=f,d.appendChild(u),c.appendChild(d),t.appendChild(c),this.elements.settings.popup=d,this.elements.settings.menu=c,t.appendChild(te.createButton.call(this,"fullscreen")),this);return t.addEventListener("mousedown",function(){m.onButtonDiv=!0}),this.elements.controls=t,te.setNormalOptionsMenu.call(this),te.setCoreOptionsMenu.call(this),t},inject:function(){let e=this,t=(this.icons={"enter-fullscreen":'<path d="M10 3h3.6l-4 4L11 8.4l4-4V8h2V1h-7zM7 9.6l-4 4V10H1v7h7v-2H4.4l4-4z"/>',"exit-fullscreen":'<path d="M1 12h3.6l-4 4L2 17.4l4-4V17h2v-7H1zM16 .6l-4 4V1h-2v7h7V6h-3.6l4-4z"/>',gamepad:'<svg viewBox="0 0 640 512"><path fill="currentColor" d="M480 96H160C71.6 96 0 167.6 0 256s71.6 160 160 160c44.8 0 85.2-18.4 114.2-48h91.5c29 29.6 69.5 48 114.2 48 88.4 0 160-71.6 160-160S568.4 96 480 96zM256 276c0 6.6-5.4 12-12 12h-52v52c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-52H76c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h52v-52c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h52c6.6 0 12 5.4 12 12v40zm184 68c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-80c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>',"load-state":'<svg viewBox="0 0 576 512"><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"/></svg>',muted:'<path d="M12.4 12.5l2.1-2.1 2.1 2.1 1.4-1.4L15.9 9 18 6.9l-1.4-1.4-2.1 2.1-2.1-2.1L11 6.9 13.1 9 11 11.1zM3.786 6.008H.714C.286 6.008 0 6.31 0 6.76v4.512c0 .452.286.752.714.752h3.072l4.071 3.858c.5.3 1.143 0 1.143-.602V2.752c0-.601-.643-.977-1.143-.601L3.786 6.008z"/>',pause:'<path d="M6 1H3c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1zM12 1c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1h-3z"/>',play:'<path d="M15.562 8.1L3.87.225C3.052-.337 2 .225 2 1.125v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"/>',restart:'<path d="M9.7 1.2l.7 6.4 2.1-2.1c1.9 1.9 1.9 5.1 0 7-.9 1-2.2 1.5-3.5 1.5-1.3 0-2.6-.5-3.5-1.5-1.9-1.9-1.9-5.1 0-7 .6-.6 1.4-1.1 2.3-1.3l-.6-1.9C6 2.6 4.9 3.2 4 4.1 1.3 6.8 1.3 11.2 4 14c1.3 1.3 3.1 2 4.9 2 1.9 0 3.6-.7 4.9-2 2.7-2.7 2.7-7.1 0-9.9L16 1.9l-6.3-.7z"/>',"save-state":'<svg viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>',"screen-record":'<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px",viewBox="0 0 39.989 39.989" style="enable-background:new 0 0 39.989 39.989;" xml:space="preserve"><path id="XMLID_155_" d="M19.994,0C8.952,0,0,8.952,0,19.995c0,11.043,8.952,19.994,19.994,19.994s19.995-8.952,19.995-19.994,C39.989,8.952,31.037,0,19.994,0z M19.994,27.745c-4.28,0-7.75-3.47-7.75-7.75s3.47-7.75,7.75-7.75s7.75,3.47,7.75,7.75,S24.275,27.745,19.994,27.745z"/></svg>',settings:'<path d="M16.135 7.784a2 2 0 0 1-1.23-2.969c.322-.536.225-.998-.094-1.316l-.31-.31c-.318-.318-.78-.415-1.316-.094a2 2 0 0 1-2.969-1.23C10.065 1.258 9.669 1 9.219 1h-.438c-.45 0-.845.258-.997.865a2 2 0 0 1-2.969 1.23c-.536-.322-.999-.225-1.317.093l-.31.31c-.318.318-.415.781-.093 1.317a2 2 0 0 1-1.23 2.969C1.26 7.935 1 8.33 1 8.781v.438c0 .45.258.845.865.997a2 2 0 0 1 1.23 2.969c-.322.536-.225.998.094 1.316l.31.31c.319.319.782.415 1.316.094a2 2 0 0 1 2.969 1.23c.151.607.547.865.997.865h.438c.45 0 .845-.258.997-.865a2 2 0 0 1 2.969-1.23c.535.321.997.225 1.316-.094l.31-.31c.318-.318.415-.781.094-1.316a2 2 0 0 1 1.23-2.969c.607-.151.865-.547.865-.997v-.438c0-.451-.26-.846-.865-.997zM9 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>',volume:'<path d="M15.5999996,3.3 C15.1999996,2.9 14.5999996,2.9 14.1999996,3.3 C13.7999996,3.7 13.7999996,4.3 14.1999996,4.7 C15.3999996,5.9 15.9999996,7.4 15.9999996,9 C15.9999996,10.6 15.3999996,12.1 14.1999996,13.3 C13.7999996,13.7 13.7999996,14.3 14.1999996,14.7 C14.3999996,14.9 14.6999996,15 14.8999996,15 C15.1999996,15 15.3999996,14.9 15.5999996,14.7 C17.0999996,13.2 17.9999996,11.2 17.9999996,9 C17.9999996,6.8 17.0999996,4.8 15.5999996,3.3 L15.5999996,3.3 Z"></path>\n            <path d="M11.2819745,5.28197449 C10.9060085,5.65794047 10.9060085,6.22188944 11.2819745,6.59785542 C12.0171538,7.33303477 12.2772954,8.05605449 12.2772954,9.00000021 C12.2772954,9.93588462 11.851678,10.9172014 11.2819745,11.4869049 C10.9060085,11.8628709 10.9060085,12.4268199 11.2819745,12.8027859 C11.4271642,12.9479755 11.9176724,13.0649528 12.2998149,12.9592565 C12.4124479,12.9281035 12.5156669,12.8776063 12.5978555,12.8027859 C13.773371,11.732654 14.1311161,10.1597914 14.1312523,9.00000021 C14.1312723,8.8299555 14.1286311,8.66015647 14.119665,8.4897429 C14.0674781,7.49784946 13.8010171,6.48513613 12.5978554,5.28197449 C12.2218894,4.9060085 11.6579405,4.9060085 11.2819745,5.28197449 Z"></path>\n            <path d="M3.78571429,6.00820648 L0.714285714,6.00820648 C0.285714286,6.00820648 0,6.30901277 0,6.76022222 L0,11.2723167 C0,11.7235261 0.285714286,12.0243324 0.714285714,12.0243324 L3.78571429,12.0243324 L7.85714286,15.8819922 C8.35714286,16.1827985 9,15.8819922 9,15.2803796 L9,2.75215925 C9,2.15054666 8.35714286,1.77453879 7.85714286,2.15054666 L3.78571429,6.00820648 Z"></path>',cheat:'<svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z" class=""></path></svg>'},this.id=Math.floor(1e4*Math.random()),null),i=(this.elements.controls=null,{id:this.id}),n=!0;B.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this.props)),this.config.controls||(this.config.controls=[]),B.element(this.config.controls)||B.string(this.config.controls)?t=this.config.controls:(t=te.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality}),n=!1);function o(e){let n=e;return Object.entries(i).forEach(function(e){t=2;var e=function(e){if(Array.isArray(e))return e}(e=e)||function(n,i){let o=[],a=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(a=(e=t.next()).done)&&(o.push(e.value),!i||o.length!==i);a=!0);}catch(e){t=!0,s=e}finally{try{a||null==_0x4d9086.return||_0x4d9086.return()}finally{if(t)throw s}}return o}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),t=e[0],e=e[1];n=fe(n,"{".concat(t,"}"),e)}),n}let a;if(n&&(B.string(this.config.controls)?t=o(t):B.element(t)&&(t.innerHTML=o(t.innerHTML))),B.string(this.config.selectors.controls.container)&&(a=document.querySelector(this.config.selectors.controls.container)),(a=B.element(a)?a:this.elements.container)[B.element(t)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",t),B.element(this.elements.controls)||te.findElements.call(this),!B.empty(this.elements.buttons)){let t=function(t){let n=e.config.classNames.controlPressed;Object.defineProperty(t,"pressed",{enumerable:!0,get:function(){return z(t,n)},set:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];V(t,n,e)}})};Object.values(this.elements.buttons).filter(Boolean).forEach(function(e){B.array(e)||B.nodeList(e)?Array.from(e).filter(Boolean).forEach(t):t(e)})}window.navigator.userAgent.includes("Edge")&&ce(a)}},ne=te;function Xe(n,i){for(let t=0;t<i.length;t++){let e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function We(){if(this.enabled){let e=this.player.elements.buttons.fullscreen;B.element(e)&&(e.pressed=this.active),G.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0),q.isIos||function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(B.element(e)){let e=c.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]"),n=e[0],i=e[e.length-1];r.call(this,this.elements.container,"keydown",function(e){var t;"Tab"===e.key&&9===e.keyCode&&((t=document.activeElement)!==i||e.shiftKey?t===n&&e.shiftKey&&(i.focus(),e.preventDefault()):(n.focus(),e.preventDefault()))},t,!1)}}.call(this.player,this.target,this.active)}}function Ke(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];e?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",V(this.target,this.player.config.classNames.fullscreen.fallback,e),We.call(this)}e=[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(B.function(document.exitFullscreen))return"";let t="";return["webkit","moz","ms"].some(function(e){return!(!B.function(document["".concat(e,"ExitFullscreen")])&&!B.function(document["".concat(e,"CancelFullScreen")])||(t=e,0))}),t}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}],Xe((u=f).prototype,[{key:"update",value:function(){this.enabled,V(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function(){this.enabled&&(f.native?this.prefix?B.empty(this.prefix)||this.target["".concat(this.prefix,"Request").concat(this.property)]():this.target.requestFullscreen():Ke.call(this,!0))}},{key:"exit",value:function(){var e;this.enabled&&(f.native?this.prefix?B.empty(this.prefix)||(e="moz"===this.prefix?"Cancel":"Exit",document["".concat(this.prefix).concat(e).concat(this.property)]()):(document.cancelFullScreen||document.exitFullscreen).call(document):Ke.call(this,!1))}},{key:"toggle",value:function(){this.active?this.exit():this.enter()}},{key:"enabled",get:function(){return f.native}},{key:"active",get:function(){return!!this.enabled&&(f.native?(this.prefix?document["".concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement)===this.target:z(this.target,this.player.config.classNames.fullscreen.fallback))}},{key:"target",get:function(){return q.isEdge?this.player.game:this.player.elements.container}}]),Xe(u,e);let Je=f;function f(e){let t=this;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.player=e,this.prefix=f.prefix,this.property=f.property,this.scrollPosition={x:0,y:0},j.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),function(){We.call(t)}),this.update()}Ze.prototype={toggleMenu:function(e){ne.toggleMenu.call(this.emulator,e)},firstTouch:function(){let e=this.emulator,t=e.elements;e.touch=!0,V(t.container,e.config.classNames.isTouch,!0)},setTabFocus:function(e){let t=this.emulator,n=t.elements,i=t;var o;clearTimeout(this.focusTimer),"keydown"===e.type&&9!==e.which||("keydown"===e.type&&(this.lastKeyDown=e.timeStamp),o=e.timeStamp-this.lastKeyDown<=20,"focus"===e.type&&!o||(e=i.config.classNames.tabFocus,V(c.call(i,".".concat(e)),e,!1),this.focusTimer=setTimeout(function(){var e=document.activeElement;n.container.contains(e)&&V(document.activeElement,i.config.classNames.tabFocus,!0)},10)))},global:function(){let e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.emulator,n=t;r.call(n,document.body,"click",this.toggleMenu,e),ie.call(n,document.body,"touchstart",this.firstTouch),r.call(n,document.body,"keydown focus blur",this.setTabFocus,e,!1,!0),j.call(n,document.body,"keyup",function(e){n.started&&(113===e.which&&(e.shiftKey?null===n.elements.buttons.saveState.getAttribute("hidden")&&G.call(n,n.elements.buttons.saveState,"click"):ee.quickSaveState()),115===e.which&&(e.shiftKey?null===n.elements.buttons.loadState.getAttribute("hidden")&&G.call(n,n.elements.buttons.loadState,"click"):ee.quickLoadState()),120===e.which&&G.call(n,n.elements.buttons.mute,"click"))})},container:function(){let n,i=this.emulator,o=i.elements,a=i,t=null;j.call(a,o.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen start-game",function(e){let t=o.controls;t&&"enterfullscreen"===e.type&&(t.pressed=!1,t.hover=!1);if(["touchstart","touchmove","mousemove","start-game"].includes(e.type)){if("nds"==i.system&&"mousemove"==e.type&&v&&v.Module&&v.Module.canvas&&(document.pointerLockElement===v.Module.canvas||document.mozPointerLockElement===v.Module.canvas))return void J.toggleControls.call(a,!1);!ee||"undefined"!=ee.virtualGamepadContainer&&null!==ee.virtualGamepadContainer||(J.toggleControls.call(a,!0),e=a.touch?3e3:2e3,clearTimeout(n),n=setTimeout(function(){return J.toggleControls.call(a,!1)},e),o.controls.setAttribute("data-timer",n))}}),j.call(a,window,"resize",function(e){let t=a.elements.container.clientHeight,n=c.call(a,".".concat(Y({ejs__menu__container:!0}),' [role="menu"]'));Array.from(n).forEach(function(e){e.style.maxHeight="".concat(t-95,"px"),e.style.overflow="auto"}),v.Module&&v.Module.canvas,a.elements.container.clientWidth/a.elements.container.clientHeight<1.3?V(a.elements.container,Y({portrait:!0}),!0):V(a.elements.container,Y({portrait:!0}),!1)}),G.call(a,window,"resize"),j.call(a,a.elements.container,"enterfullscreen",function(e){if(v.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.lock)try{screen.orientation.lock("landscape")}catch(e){}else if(v.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.lock)try{ScreenOrientation.lock("landscape")}catch(e){}if(2===a.coreVer&&v.Module){let e=50;clearInterval(t),t=setInterval(function(){v.Module.setCanvasSize(window.innerWidth,window.innerHeight),e<0&&clearInterval(t),e--},100)}setTimeout(function(){G.call(a,window,"resize")},300)}),j.call(a,a.elements.container,"exitfullscreen",function(e){if(v.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.unlock)try{screen.orientation.unlock()}catch(e){}else if(v.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.unlock)try{ScreenOrientation.unlock()}catch(e){}2===a.coreVer&&v.Module&&(clearInterval(t),v.Module.setCanvasSize(800,600)),setTimeout(function(){G.call(a,window,"resize")},300)}),j.call(a,a.elements.container,"start-game",function(e){let t=window.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t),V(a.elements.container,Y({"game-started":!0}),!0)}),j.call(a,a.elements.container,"blur",function(e){let t=e.currentTarget;setTimeout(function(){t.contains(document.activeElement)||G.call(a,a.elements,"blurgame")},0)}),j.call(a,a.elements.container,"focus",function(e){let t=e.currentTarget;setTimeout(function(){t.contains(document.activeElement)&&G.call(a,a.elements,"focusgame")},0)})},media:function(){let t=this.emulator,i=t.elements,o=t;j.call(o,o.game,"volumechange",function(e){return ne.updateVolume.call(o,e)}),j.call(o,i.container,"contextmenu",function(e){o.touch||o.lightgun||ne.toggleContextMenu.call(o,e,!0),e.preventDefault()},!1),j.call(o,i.container,"mousewheel",function(e){e.stopPropagation()},!1),j.call(o,i.container,"mousedown",function(e){"nds"==t.system&&v&&v.Module&&v.Module.canvas&&!v.isMobileDevice&&document.pointerLockElement!==v.Module.canvas&&document.mozPointerLockElement!==v.Module.canvas&&t.started&&!t.connected&&setTimeout(function(){!0!==t.onButtonDiv&&(v.Module.canvas.requestPointerLock=v.Module.canvas.requestPointerLock||v.Module.canvas.mozRequestPointerLock,v.Module.canvas.requestPointerLock()),t.onButtonDiv=!1},100),o.touch||ne.toggleContextMenu.call(o,e,!1)},!1),j.call(o,o.game,"volumechange",function(){o.storage.set({volume:o.volume,muted:o.muted}),ee.setVolume&&ee.setVolume()});var e=o.config.events.concat(["keyup","keydown"]).join(" ");j.call(o,o.game,e,function(e){let t=e.detail,n=void 0===t?{}:t;"error"===e.type&&(n=o.game.error),G.call(o,i.container,e.type,!0,n)})},proxy:function(e,t,n){let i=this.emulator,o=i.config.listeners[n],a=!0;(a=B.function(o)?o.call(i,e):a)&&B.function(t)&&t.call(i,e)},bind:function(e,t,n,i){let o=this,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],s=this.emulator,l=s,r=l.config.listeners[i],c=B.function(r);j.call(l,e,t,function(e){return o.proxy(e,n,i)},a&&!c)},controls:function(){let a=this,l=this.emulator,t=l.elements,n=q.isIE?"change":"input";var e;this.bind(t.buttons.mute,"click",function(){l.muted=!l.muted},"mute"),this.bind(t.buttons.fullscreen,"click",function(){l.fullscreen.toggle()},"fullscreen"),this.bind(t.buttons.gamepad,"click",function(){J.toggleControls.call(l,!1),U(t.dialogs.gamepad,!1)},"mute"),this.bind(t.buttons.saveState,"click",function(){saveSaveFiles(),async function(){G.call(l,l.elements.container,"savestate-start",!1,{});var n=await ee.saveState(),i=ee.getScreenData();if(!g.saveLoadDB.call(l,"save")){if(B.function(l.config.onsavestate))l.config.onsavestate.call(null,{screenshot:i,state:n});else{let e=l.getStartName(!0).split("/").pop();i=new Blob([n]),n=(e.includes(".")&&(e=e.substring(0,e.length-e.split(".").pop().length-1)),(e="string"==typeof l.gameName?l.gameName:e)?"".concat(e,".state"):"game.state");let t=document.createElement("a");t.download=n,t.href=URL.createObjectURL(i),t.click(),setTimeout(function(){URL.revokeObjectURL(t.href)},2e3)}l.elements.container.focus()}}()},"mute"),this.bind(t.buttons.loadState,"click",function(){G.call(l,l.elements.container,"loadstate",!1,{})},"mute"),this.bind(t.buttons.settings,"click",function(e){e.stopPropagation(),ne.toggleMenu.call(l,e)}),this.bind(t.buttons.settings,"keyup",function(e){var t=e.which;[13,32].includes(t)&&(13!==t?(e.preventDefault(),e.stopPropagation(),ne.toggleMenu.call(l,e)):ne.focusFirstMenuItem.call(l,null,!0))},null,!1),this.bind(t.settings.menu,"keydown",function(e){27===e.which&&ne.toggleMenu.call(l,e)}),q.isIos&&(e=c.call(l,'input[type="range"]'),Array.from(e).forEach(function(e){return a.bind(e,n,function(e){return ce(e.target)})})),q.isWebkit&&Array.from(c.call(l,'input[type="range"]')).forEach(function(e){a.bind(e,"input",function(e){return ne.updateRangeFill.call(l,e.target)})}),this.bind(t.inputs.volume,n,function(e){l.volume=e.target.value},"volume"),this.bind(t.controls,"mouseenter mouseleave",function(e){"mouseleave"===e.type&&null===e.toElement?t.controls.hover=!0:t.controls.hover=!l.touch&&"mouseenter"===e.type}),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){["mousedown","touchstart"].includes(e.type)?(t.controls.pressed=!0,e=t.controls.getAttribute("data-timer2"),clearTimeout(e)):(e=setTimeout(function(){t.controls.pressed=!1},4e3),t.controls.setAttribute("data-timer2",e))}),this.bind(t.controls,"focusin focusout",function(e){let t=l.config,n=l.elements,i="focusin"===e.type,o=n.controls.getAttribute("data-timer");V(n.controls,t.classNames.noTransition,i),J.toggleControls.call(l,i),i&&(setTimeout(function(){V(n.controls,t.classNames.noTransition,!1)},0),e=a.touch?3e3:4e3,clearTimeout(o),o=setTimeout(function(){return J.toggleControls.call(l,!1)},e),n.controls.setAttribute("data-timer",o))}),this.bind(t.inputs.volume,"wheel",function(e){let t=e.webkitDirectionInvertedFromDevice,n=function(n,i){if(Array.isArray(n))return n;let o=[],a=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(a=(e=t.next()).done)&&(o.push(e.value),!i||o.length!==i);a=!0);}catch(e){t=!0,s=e}finally{try{a||null==_0x1bb8de.return||_0x1bb8de.return()}finally{if(t)throw s}}return o}([e.deltaX,-e.deltaY].map(function(e){return t?-e:e}),2),i=n[0],o=n[1],a=Math.sign(Math.abs(i)>Math.abs(o)?i:o);l.increaseVolume(a/50);var s=l.game.volume;(1===a&&s<1||-1===a&&0<s)&&e.preventDefault()},"volume",!1),this.bind(t.controls,"contextmenu",function(e){e.stopPropagation()}),this.bind(t.contextMenu,"contextmenu",function(e){e.stopPropagation()})}};let Qe=Ze;function Ze(e){if(!(this instanceof Ze))throw new TypeError("Cannot call a class as a function");this.emulator=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}function $e(n,i){for(let t=0;t<i.length;t++){let e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}u=[{key:"setup",value:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=null;return B.string(e)?n=Array.from(document.querySelectorAll(e)):B.nodeList(e)?n=Array.from(e):B.array(e)&&(n=e.filter(B.element)),B.empty(n)?null:n.map(function(e){return new tt(e,t)})}}],$e((e=tt).prototype,[{key:"restart",value:function(){this.currentTime=0}},{key:"increaseVolume",value:function(e){var t=this.game.muted?0:this.volume;this.volume=t+(B.number(e)?e:0)}},{key:"decreaseVolume",value:function(e){this.increaseVolume(-e)}},{key:"toggleControls",value:function(e){return!!this.started&&((e=V(this.elements.container,this.config.classNames.hideControls,void 0===e?void 0:!e))&&ne.toggleMenu.call(this,!1),!e)}},{key:"getStartName",value:function(e){let t;var n=/[#<$+%>!`&*'|{}/\\?"=@:^\r\n]/gi;if(!this.startName||!0!==e&&"rom"===this.startName){if(B.string(this.config.gameUrl)&&!this.config.gameUrl.startsWith("blob:"))t=this.config.gameUrl.split("/").pop().split("?")[0].replace(n,"");else if(this.gameName)t=this.gameName.replace(n,"")+"."+this.system;else if(this.config.gameId)t=this.config.gameId+"."+this.system;else if(B.string(this.config.gameUrl)&&!0===e)t=this.config.gameUrl.split("/").pop().split("?")[0].replace(n,"");else if(!0===e)return"rom"}else t=this.startName;return t}},{key:"loadState",value:function(e){ee.loadState(e,0)}},{key:"on",value:function(e,t){j.call(this,this.elements.container,e,t)}},{key:"once",value:function(e,t){ie.call(this,this.elements.container,e,t)}},{key:"off",value:function(e,t){M(this.elements.container,e,t)}},{key:"playing",set:function(){let t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Array.from(this.elements.buttons.play||[]).forEach(function(e){e.pressed=t}),this.paused=!t},get:function(){return Boolean(this.ready&&!this.paused)}},{key:"volume",set:function(e){let t=e;B.string(t)&&(t=Number(t)),B.number(t)||(t=this.storage.get("volume")),(t=1<(t=B.number(t)?t:this.config.volume)?1:t)<0&&(t=0),this.config.volume=t,this.game.volume=t,!B.empty(e)&&this.muted&&0<t&&(this.muted=!1)},get:function(){return Number(this.game.volume)}},{key:"muted",set:function(e){let t=e;B.boolean(t)||(t=this.storage.get("muted")),B.boolean(t)||(t=this.config.muted),this.config.muted=t,this.game.muted=t},get:function(){return Boolean(this.game.muted)}}]),$e(e,u);let et=tt;function tt(a,s){return new Promise(async function(e,t){function o(e,t){var n=window.location.pathname.split("/").pop();let i=window.location.pathname.substring(0,window.location.pathname.length-n.length);var o,a=i.split("/"),s=e.split("/");let l=[];for(let e=0;e<a.length;e++)""!=a[e]&&l.push(a[e]);if(!(e.startsWith("/")||e.includes("://")||e.includes("http:")||e.includes("https:")||e.includes("file:")||e.includes("blob:"))){for(let e=0;e<s.length;e++)if(""!=s[e]&&"."!=s[e])if(".."==s[e]){if(0<l.length){let e=("/"===(o=e.join("/"))?"/":o.substring(0,o.length-o.split("/").pop().length)).split("/")}}else l.push(s[e]);(e=l.join("/")).startsWith("/")||(e="/"+e),e=window.location.protocol+"//"+window.location.host+e}return!(e=e.startsWith("/")?window.location.protocol+"//"+window.location.host+e:e).endsWith("/")&&t&&(e+="/"),e}let i=this;this.version="2.3.7",this.system="",this.adUrl=null,this.gameName=null,this.loadStateOnStart=!1,this.statesSupported=!0,this.mameCore=null,this.startOnLoad=!1,this.dataPath="",this.customPaths=null,this.hash="",this.lightgun=!1,this.mouse=!1,this.multitap=!1,this.ready=!1,this.paused=!0,this.started=!1,this.touch=X.touch,this.game=a,B.string(this.game)&&(this.game=document.querySelectorAll(this.game)),(window.jQuery&&this.game instanceof jQuery||B.nodeList(this.game)||B.array(this.game))&&(this.game=this.game[0]),this.game=this.game,this.game.innerHTML="",this.config=W({},E,tt.defaults,s||{}),this.config.settings&&this.config.settings.volume&&(E.volume=this.config.settings.volume),this.config.settings&&this.config.settings.defaultControllers&&(g.defaultControllers=this.config.settings.defaultControllers),this.coreVer=1,this.lightgun=this.config.lightgun,this.loadStateOnStart=this.config.loadStateOnStart||!1,this.adUrl=this.config.adUrl||null,B.string(this.config.gameName)&&(this.gameName=this.config.gameName||null),this.mouse=this.config.mouse,this.multitap=this.config.multitap,this.cheats=this.config.cheats,this.cheats||(this.cheats=[]),this.mameCore=this.config.mameCore||null,this.color=this.config.color,this.startOnLoad=this.config.startOnLoad||!1,this.statesSupported=this.config.statesSupported||!0,this.customPaths=function(e){if(!e)return{};let t={};for(var n in e)"string"==typeof e[n]&&(t[n]=o(e[n]));return t}(this.config.paths),this.dataPath=function(n){if("string"==typeof n)return o(n,!0);{n=window.location.href;let e=n;var i=e.split("/").pop();let t=e.substring(0,e.length-i.length);return"/"==n?window.location.protocol+"//"+window.location.host+"/":((t=t.startsWith("/")?window.location.protocol+"//"+window.location.host+t:t).endsWith("/")||(t+="/"),t)}}(this.config.dataPath),this.localization=await async function(e,t,n){let i={};if(n&&"string"==typeof n&&"en-US"!==n){t=t&&"string"==typeof t[n+".json"]?t[n+".json"]:e+"localization/"+n+".json";try{let e=await fetch(t);var o=await e.text(),a=JSON.parse(o);E.i18n=a.i18n}catch(e){console.warn("error setting localization",e)}}return function(e){return"string"==typeof i[e]?i[e]:(n&&"en-US"!==n&&"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&console.warn('Missing translation for "'+e+'". Language is set to "'+n+'"'),e)}}(this.dataPath,this.customPaths,this.config.lang),this.config=W({},E,tt.defaults,s||{}),Object.keys(this.config.classNames).forEach(function(n){var e=i;if(B.object(e.config.classNames[n]))Object.keys(e.config.classNames[n]).forEach(function(e){let t={};t[i.config.classNames[n][e]]=!0,i.config.classNames[n][e]=Y(t)});else{let e={};e[i.config.classNames[n]]=!0,i.config.classNames[n]=Y(e)}}),this.config.selectors.controls.wrapper=".".concat(Y({ejs__controls:!0})),this.config.selectors.container=".".concat(Y({ejs:!0})),this.system=this.config.system,this.elements={container:null,buttons:{},display:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}},dialogs:{gamepad:null,loading:null,netplay:null},widgets:{}},this.fullscreen={active:!1},this.config.mute=!0,this.eventListeners=[],this.listeners=new Qe(this),this.storage=new he(this,"ejs_settings"),this.game.emulator=this,B.element(this.elements.container)||(this.elements.container=F("div"),R(this.game,this.elements.container));var n=F("div",{class:Y({ejs__widgets:!0})}),n=(this.elements.container.appendChild(n),F("div",{class:Y({ejs__dialogs:!0})}));this.elements.container.appendChild(n),J.addStyleHook.call(this),ee.setup.call(this),J.build.call(this),this.listeners.container(),this.listeners.global(),this.fullscreen=new Je(this),v.create.call(this),e(this)}.bind(this))}et.defaults={},o.default=et}]).default;